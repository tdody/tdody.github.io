<footer id="attribution" style="float:right; color:#999; background:#fff;">
Created by Thibault Dody, 02/02/2020.
</footer>

<h1 id="titanic-disaster-study">Titanic Disaster Study</h1>

<figure>
<img src="https://tdody.github.io/assets/img/2020-02-02-Titanic/Titanic1.jpg" style="width:642px;height:=288px;" />
</figure>

<h2 id="table-of-content">Table of Content</h2>

<p><a href="#Section_1"><strong>1. Introduction</strong></a> <br />
<a href="#Section_2"><strong>2. Data Import</strong></a><br />
    <a href="#Section_21">2.1 Import Libraries</a><br />
    <a href="#Section_22">2.2 Load specific tools</a><br />
    <a href="#Section_23">2.3 Data Import</a><br />
    <a href="#Section_24">2.4 Data Inspection</a><br />
<a href="#Section_3"><strong>3. Data Exploration and Data Cleaning</strong></a><br />
    <a href="#Section_31">3.1 Pivoting Features</a><br />
    <a href="#Section_32">3.2 Embarked Feature</a><br />
    <a href="#Section_33">3.3 Fare Feature</a><br />
    <a href="#Section_34">3.4 Cabin Feature</a><br />
    <a href="#Section_35">3.5 Age Feature</a><br />
<a href="#Section_4"><strong>4. Data Visualization and Feature Exploration</strong></a><br />
    <a href="#Section_41">4.1 Gender</a><br />
    <a href="#Section_42">4.2 Age</a><br />
    <a href="#Section_43">4.3 Pclass and Fare</a><br />
    <a href="#Section_44">4.4 SibSp &amp; Parch</a><br />
    <a href="#Section_45">4.5 Embarked</a><br />
<a href="#Section_5"><strong>5. Statistical Study</strong></a><br />
    <a href="#Section_51">5.1 Main Features</a><br />
    <a href="#Section_52">5.2 Correlation Study</a><br />
<a href="#Section_6"><strong>6. Feature Preparation</strong></a><br />
    <a href="#Section_61">6.1 Passenger Title</a><br />
    <a href="#Section_62">6.2 Family Size</a><br />
    <a href="#Section_63">6.3 Tickets</a><br />
    <a href="#Section_64">6.4 Family Survival Rate</a><br />
    <a href="#Section_65">6.4 Fare Binning</a><br />
    <a href="#Section_66">6.4 Age Binning</a><br />
    <a href="#Section_67">6.4 Encoding</a> <br />
<a href="#Section_7"><strong>7. Model Preparation</strong></a><br />
<a href="#Section_8"><strong>8. Models</strong></a><br />
<a href="#Section_9"><strong>9. Best Models</strong></a><br />
<a href="#Section_10"><strong>10. Create Submission</strong></a></p>

<hr />
<p><a id="Section_1"></a></p>
<h2 id="1-introduction">1. Introduction</h2>

<p>On April 15, 1912, the Titanic sunk after colliding with an iceberg, 1502 out of 2224 passengers and crew members died. The dataset containing passenger information has been made available. The purpose of this Notebook is to perform a comparison study of different models aimed at predicting survival rate. The data is obtained from <a href="https://www.kaggle.com/">Kaggle</a>.</p>

<hr />
<p><a id="Section_2"></a></p>
<h2 id="2-data-import">2. Data Import</h2>
<p><a id="Section_21"></a></p>
<h3 id="21-import-libraries">2.1 Import Libraries</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Load libraries
</span><span class="kn">import</span> <span class="n">sys</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Python version:</span><span class="se">\t\t</span><span class="s">{}</span><span class="sh">"</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">version</span><span class="p">))</span>
<span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">pandas version:</span><span class="se">\t\t</span><span class="s">{}</span><span class="sh">"</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">pd</span><span class="p">.</span><span class="n">__version__</span><span class="p">))</span>
<span class="kn">import</span> <span class="n">matplotlib</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">matplotlib version:</span><span class="se">\t</span><span class="s">{}</span><span class="sh">"</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">matplotlib</span><span class="p">.</span><span class="n">__version__</span><span class="p">))</span>
<span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">numpy version:</span><span class="se">\t\t</span><span class="s">{}</span><span class="sh">"</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">__version__</span><span class="p">))</span>
<span class="kn">import</span> <span class="n">scipy</span> <span class="k">as</span> <span class="n">sp</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">scipy version:</span><span class="se">\t\t</span><span class="s">{}</span><span class="sh">"</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">sp</span><span class="p">.</span><span class="n">__version__</span><span class="p">))</span>
<span class="kn">import</span> <span class="n">sklearn</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">sklearn version:</span><span class="se">\t</span><span class="s">{}</span><span class="sh">"</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">sklearn</span><span class="p">.</span><span class="n">__version__</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Python version:		3.7.6 (default, Jan  8 2020, 20:23:39) [MSC v.1916 64 bit (AMD64)]
pandas version:		0.25.3
matplotlib version:	3.1.1
numpy version:		1.18.1
scipy version:		1.3.2
sklearn version:	0.22.1
</code></pre></div></div>

<p><a id="Section_22"></a></p>
<h3 id="22-load-specific-tools">2.2 Load specific tools</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Visualization
</span><span class="kn">import</span> <span class="n">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="n">seaborn</span> <span class="k">as</span> <span class="n">sns</span>
<span class="n">sns</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="sh">'</span><span class="s">whitegrid</span><span class="sh">'</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="sh">'</span><span class="s">notebook</span><span class="sh">'</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="sh">'</span><span class="s">deep</span><span class="sh">'</span><span class="p">)</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>

<span class="c1"># Models
</span><span class="kn">from</span> <span class="n">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_val_score</span><span class="p">,</span><span class="n">GridSearchCV</span><span class="p">,</span> <span class="n">StratifiedKFold</span><span class="p">,</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="n">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">LabelEncoder</span><span class="p">,</span> <span class="n">OneHotEncoder</span>

<span class="kn">from</span> <span class="n">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeClassifier</span><span class="p">,</span> <span class="n">DecisionTreeRegressor</span><span class="p">,</span> <span class="n">ExtraTreeClassifier</span>
<span class="kn">from</span> <span class="n">sklearn.naive_bayes</span> <span class="kn">import</span> <span class="n">GaussianNB</span><span class="p">,</span> <span class="n">BernoulliNB</span>
<span class="kn">from</span> <span class="n">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeClassifier</span>
<span class="kn">from</span> <span class="n">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVC</span><span class="p">,</span> <span class="n">NuSVC</span><span class="p">,</span> <span class="n">LinearSVC</span>
<span class="kn">from</span> <span class="n">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span><span class="p">,</span> <span class="n">PassiveAggressiveClassifier</span><span class="p">,</span> <span class="n">RidgeClassifier</span><span class="p">,</span> <span class="n">SGDClassifier</span><span class="p">,</span> <span class="n">Perceptron</span>
<span class="kn">from</span> <span class="n">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsClassifier</span>
<span class="kn">from</span> <span class="n">sklearn.discriminant_analysis</span> <span class="kn">import</span> <span class="n">LinearDiscriminantAnalysis</span><span class="p">,</span> <span class="n">QuadraticDiscriminantAnalysis</span>
<span class="kn">from</span> <span class="n">sklearn.neural_network</span> <span class="kn">import</span> <span class="n">MLPClassifier</span>
<span class="kn">from</span> <span class="n">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">AdaBoostClassifier</span><span class="p">,</span> <span class="n">VotingClassifier</span><span class="p">,</span> <span class="n">ExtraTreesClassifier</span><span class="p">,</span> <span class="n">RandomForestClassifier</span><span class="p">,</span> <span class="n">GradientBoostingClassifier</span><span class="p">,</span> <span class="n">BaggingClassifier</span>
<span class="kn">from</span> <span class="n">sklearn.gaussian_process</span> <span class="kn">import</span> <span class="n">GaussianProcessClassifier</span>
<span class="kn">from</span> <span class="n">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>

<span class="kn">from</span> <span class="n">xgboost</span> <span class="kn">import</span> <span class="n">XGBClassifier</span>

<span class="c1"># Tools
</span><span class="kn">from</span> <span class="n">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">roc_auc_score</span><span class="p">,</span> <span class="n">roc_curve</span><span class="p">,</span> <span class="n">auc</span>
<span class="kn">from</span> <span class="n">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span><span class="p">,</span><span class="n">classification_report</span><span class="p">,</span> <span class="n">precision_recall_curve</span><span class="p">,</span> <span class="n">confusion_matrix</span>
<span class="kn">from</span> <span class="n">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_val_score</span><span class="p">,</span> <span class="n">GridSearchCV</span><span class="p">,</span> <span class="n">learning_curve</span>

<span class="kn">from</span> <span class="n">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
<span class="kn">from</span> <span class="n">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">import</span> <span class="n">string</span>


<span class="c1"># Do not show warnings (added after Notebook was finalized)
</span><span class="kn">import</span> <span class="n">warnings</span>
<span class="n">warnings</span><span class="p">.</span><span class="nf">filterwarnings</span><span class="p">(</span><span class="sh">'</span><span class="s">ignore</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div>

<p><a id="Section_23"></a></p>
<h3 id="23-data-import">2.3 Data Import</h3>

<p>We import both the training and test sets, we then combine them to compute statistics on the entire population of passengers.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Import training and testing csv datasets
</span><span class="n">train</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_csv</span><span class="p">(</span><span class="sh">'</span><span class="s">./Data/train.csv</span><span class="sh">'</span><span class="p">)</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_csv</span><span class="p">(</span><span class="sh">'</span><span class="s">./Data/test.csv</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Inspect data
</span><span class="n">train</span><span class="p">.</span><span class="nf">head</span><span class="p">()</span>
</code></pre></div></div>

<div style="overflow-x:auto;">
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>PassengerId</th>
      <th>Survived</th>
      <th>Pclass</th>
      <th>Name</th>
      <th>Sex</th>
      <th>Age</th>
      <th>SibSp</th>
      <th>Parch</th>
      <th>Ticket</th>
      <th>Fare</th>
      <th>Cabin</th>
      <th>Embarked</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>0</td>
      <td>3</td>
      <td>Braund, Mr. Owen Harris</td>
      <td>male</td>
      <td>22.0</td>
      <td>1</td>
      <td>0</td>
      <td>A/5 21171</td>
      <td>7.2500</td>
      <td>NaN</td>
      <td>S</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>1</td>
      <td>1</td>
      <td>Cumings, Mrs. John Bradley (Florence Briggs Th...</td>
      <td>female</td>
      <td>38.0</td>
      <td>1</td>
      <td>0</td>
      <td>PC 17599</td>
      <td>71.2833</td>
      <td>C85</td>
      <td>C</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>1</td>
      <td>3</td>
      <td>Heikkinen, Miss. Laina</td>
      <td>female</td>
      <td>26.0</td>
      <td>0</td>
      <td>0</td>
      <td>STON/O2. 3101282</td>
      <td>7.9250</td>
      <td>NaN</td>
      <td>S</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>1</td>
      <td>1</td>
      <td>Futrelle, Mrs. Jacques Heath (Lily May Peel)</td>
      <td>female</td>
      <td>35.0</td>
      <td>1</td>
      <td>0</td>
      <td>113803</td>
      <td>53.1000</td>
      <td>C123</td>
      <td>S</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>0</td>
      <td>3</td>
      <td>Allen, Mr. William Henry</td>
      <td>male</td>
      <td>35.0</td>
      <td>0</td>
      <td>0</td>
      <td>373450</td>
      <td>8.0500</td>
      <td>NaN</td>
      <td>S</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Inspect data
</span><span class="n">test</span><span class="p">.</span><span class="nf">head</span><span class="p">()</span>
</code></pre></div></div>

<div style="overflow-x:auto;">
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>PassengerId</th>
      <th>Pclass</th>
      <th>Name</th>
      <th>Sex</th>
      <th>Age</th>
      <th>SibSp</th>
      <th>Parch</th>
      <th>Ticket</th>
      <th>Fare</th>
      <th>Cabin</th>
      <th>Embarked</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>892</td>
      <td>3</td>
      <td>Kelly, Mr. James</td>
      <td>male</td>
      <td>34.5</td>
      <td>0</td>
      <td>0</td>
      <td>330911</td>
      <td>7.8292</td>
      <td>NaN</td>
      <td>Q</td>
    </tr>
    <tr>
      <th>1</th>
      <td>893</td>
      <td>3</td>
      <td>Wilkes, Mrs. James (Ellen Needs)</td>
      <td>female</td>
      <td>47.0</td>
      <td>1</td>
      <td>0</td>
      <td>363272</td>
      <td>7.0000</td>
      <td>NaN</td>
      <td>S</td>
    </tr>
    <tr>
      <th>2</th>
      <td>894</td>
      <td>2</td>
      <td>Myles, Mr. Thomas Francis</td>
      <td>male</td>
      <td>62.0</td>
      <td>0</td>
      <td>0</td>
      <td>240276</td>
      <td>9.6875</td>
      <td>NaN</td>
      <td>Q</td>
    </tr>
    <tr>
      <th>3</th>
      <td>895</td>
      <td>3</td>
      <td>Wirz, Mr. Albert</td>
      <td>male</td>
      <td>27.0</td>
      <td>0</td>
      <td>0</td>
      <td>315154</td>
      <td>8.6625</td>
      <td>NaN</td>
      <td>S</td>
    </tr>
    <tr>
      <th>4</th>
      <td>896</td>
      <td>3</td>
      <td>Hirvonen, Mrs. Alexander (Helga E Lindqvist)</td>
      <td>female</td>
      <td>22.0</td>
      <td>1</td>
      <td>1</td>
      <td>3101298</td>
      <td>12.2875</td>
      <td>NaN</td>
      <td>S</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># tools functions: concat and divide
</span><span class="k">def</span> <span class="nf">concat_df</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">test</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">pd</span><span class="p">.</span><span class="nf">concat</span><span class="p">([</span><span class="n">train</span><span class="p">,</span> <span class="n">test</span><span class="p">],</span> <span class="n">sort</span><span class="o">=</span><span class="bp">True</span><span class="p">).</span><span class="nf">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">divide_df</span><span class="p">(</span><span class="n">full_df</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">full_df</span><span class="p">.</span><span class="n">loc</span><span class="p">[:</span><span class="mi">890</span><span class="p">],</span> <span class="n">full_df</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">891</span><span class="p">:].</span><span class="nf">drop</span><span class="p">([</span><span class="sh">'</span><span class="s">Survived</span><span class="sh">'</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>


<span class="n">df_all</span> <span class="o">=</span> <span class="nf">concat_df</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">test</span><span class="p">)</span>
<span class="c1"># create a clone to test different transformations
</span><span class="n">df_exp</span> <span class="o">=</span> <span class="n">df_all</span><span class="p">.</span><span class="nf">copy</span><span class="p">()</span>
</code></pre></div></div>

<p><a id="Section_24"></a></p>
<h3 id="24-data-inspection">2.4 Data Inspection</h3>

<p>The data is divided into two separate datasets:</p>
<ul>
  <li>a training set containing a set of features and out target variable (whether or not a passenger survived)</li>
  <li>a test set containing only the set of features</li>
</ul>

<p><strong>Data  Features</strong><br />
<strong>. Pclass</strong>: Categorical feature used to describe the passenger class (1=Upper, 2=Middle, 3=Lower). <br />
<strong>. Name</strong>: String Containing a passenger name and title. <br />
<strong>. Sex</strong>: Categorical variable describing the passenger’s gender. <br />
<strong>. Age</strong>: Numerical feature standing for the passenger’s age. <br />
<strong>. SibSp</strong>: Number of siblings/spouses aboard. <br />
<strong>. Parch</strong>: Number of parents/children aboard. <br />
<strong>. Ticket</strong>: Ticket number. <br />
<strong>. Fare</strong>: Price of the ticket. <br />
<strong>. Cabin</strong>: Cabin id. <br />
<strong>. Embarked</strong>: Categorical feature, port of embarkation.</p>

<p>Target:<br />
<strong>. Survived</strong>: Target feature (1=Survived, 0=Died)</p>

<hr />
<p><a id="Section_3"></a></p>
<h2 id="3-data-exploration-and-data-cleaning">3. Data Exploration and Data Cleaning</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Remove the Passengerid from the set as it does not need to be included in the models
</span><span class="n">passengerId</span> <span class="o">=</span> <span class="n">test</span><span class="p">.</span><span class="n">PassengerId</span>

<span class="n">train</span> <span class="o">=</span> <span class="n">train</span><span class="p">.</span><span class="nf">drop</span><span class="p">([</span><span class="sh">'</span><span class="s">PassengerId</span><span class="sh">'</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">test</span><span class="p">.</span><span class="nf">drop</span><span class="p">([</span><span class="sh">'</span><span class="s">PassengerId</span><span class="sh">'</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># list information for each feature (type, number of nun-null records)
</span><span class="n">train</span><span class="p">.</span><span class="nf">info</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 891 entries, 0 to 890
Data columns (total 11 columns):
Survived    891 non-null int64
Pclass      891 non-null int64
Name        891 non-null object
Sex         891 non-null object
Age         714 non-null float64
SibSp       891 non-null int64
Parch       891 non-null int64
Ticket      891 non-null object
Fare        891 non-null float64
Cabin       204 non-null object
Embarked    889 non-null object
dtypes: float64(2), int64(4), object(5)
memory usage: 76.7+ KB
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># list information for each feature (type, number of nun-null records)
</span><span class="n">test</span><span class="p">.</span><span class="nf">info</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 418 entries, 0 to 417
Data columns (total 10 columns):
Pclass      418 non-null int64
Name        418 non-null object
Sex         418 non-null object
Age         332 non-null float64
SibSp       418 non-null int64
Parch       418 non-null int64
Ticket      418 non-null object
Fare        417 non-null float64
Cabin       91 non-null object
Embarked    418 non-null object
dtypes: float64(2), int64(3), object(5)
memory usage: 32.8+ KB
</code></pre></div></div>

<p><strong>Comment</strong>: <br />
Several of the features in the <strong>training</strong> set appear to be incomplete (Age, Cabin, and Embarked). <br />
Several of the features in the <strong>test</strong> set appear to be incomplete (Age, Cabin, and Fare).</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># compute percentage of missing values
</span>
<span class="c1"># compute number of missing records
</span><span class="n">missing_total</span> <span class="o">=</span> <span class="n">train</span><span class="p">.</span><span class="nf">isnull</span><span class="p">().</span><span class="nf">sum</span><span class="p">().</span><span class="nf">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="c1"># convert to percentages
</span><span class="n">missing_percentage</span> <span class="o">=</span> <span class="n">missing_total</span><span class="o">/</span><span class="n">train</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span>

<span class="c1"># display missing record %
</span><span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">Missing values in training set:</span><span class="sh">'</span><span class="p">)</span>
<span class="n">pd</span><span class="p">.</span><span class="nf">concat</span><span class="p">([</span><span class="n">missing_total</span><span class="p">,</span><span class="n">missing_percentage</span><span class="p">],</span><span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">Count</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Percentage</span><span class="sh">'</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Missing values in training set:
</code></pre></div></div>

<div style="overflow-x:auto;">
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Count</th>
      <th>Percentage</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Cabin</th>
      <td>687</td>
      <td>77.104377</td>
    </tr>
    <tr>
      <th>Age</th>
      <td>177</td>
      <td>19.865320</td>
    </tr>
    <tr>
      <th>Embarked</th>
      <td>2</td>
      <td>0.224467</td>
    </tr>
    <tr>
      <th>Fare</th>
      <td>0</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>Ticket</th>
      <td>0</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>Parch</th>
      <td>0</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>SibSp</th>
      <td>0</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>Sex</th>
      <td>0</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>Name</th>
      <td>0</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>Pclass</th>
      <td>0</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>Survived</th>
      <td>0</td>
      <td>0.000000</td>
    </tr>
  </tbody>
</table>
</div>

<p><strong>Comment</strong>:<br />
Based on the above table, the following observations can be made:</p>
<ol>
  <li>The cabin feature is mostly empty, this will be hard to use.</li>
  <li>The age feature contains a large number of missing values. This will require a smarter approach rather than just filling the null with a median.</li>
  <li>The embarked feature only has 2 missing values. We can come up with estimates for these two by taking a quick look at the data and using the most probable values as replacements.</li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># compute percentage of missing values
</span>
<span class="c1"># compute number of missing records
</span><span class="n">missing_total</span> <span class="o">=</span> <span class="n">test</span><span class="p">.</span><span class="nf">isnull</span><span class="p">().</span><span class="nf">sum</span><span class="p">().</span><span class="nf">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="c1"># convert to percentages
</span><span class="n">missing_percentage</span> <span class="o">=</span> <span class="n">missing_total</span><span class="o">/</span><span class="n">train</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span>

<span class="c1"># display missing record %
</span><span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">Missing values in test set:</span><span class="sh">'</span><span class="p">)</span>
<span class="n">pd</span><span class="p">.</span><span class="nf">concat</span><span class="p">([</span><span class="n">missing_total</span><span class="p">,</span><span class="n">missing_percentage</span><span class="p">],</span><span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">Count</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Percentage</span><span class="sh">'</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Missing values in test set:
</code></pre></div></div>

<div style="overflow-x:auto;">
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Count</th>
      <th>Percentage</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Cabin</th>
      <td>327</td>
      <td>36.700337</td>
    </tr>
    <tr>
      <th>Age</th>
      <td>86</td>
      <td>9.652076</td>
    </tr>
    <tr>
      <th>Fare</th>
      <td>1</td>
      <td>0.112233</td>
    </tr>
    <tr>
      <th>Embarked</th>
      <td>0</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>Ticket</th>
      <td>0</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>Parch</th>
      <td>0</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>SibSp</th>
      <td>0</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>Sex</th>
      <td>0</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>Name</th>
      <td>0</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>Pclass</th>
      <td>0</td>
      <td>0.000000</td>
    </tr>
  </tbody>
</table>
</div>

<p><strong>Comment</strong>:<br />
Based on the above table, the following observations can be made:</p>
<ol>
  <li>The cabin feature is also mostly empty, this will be hard to use.</li>
  <li>The age feature contains a large number of missing values. This will require a smarter approach rather than just filling the null with a median.</li>
  <li>The fare feature only has 1 missing values. We can come up with an estimate for this by taking a quick look at the data and using the most probable values as a replacement.</li>
</ol>

<p><a id="Section_31"></a></p>
<h3 id="31-pivoting-features">3.1 Pivoting features</h3>

<p>Before diving in the data, it is interesting to get a quick overview of what is waiting for us. To do so, we can pivot several of the features with the target data and quickly identify which features seem important.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">train</span><span class="p">[[</span><span class="sh">'</span><span class="s">Sex</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Survived</span><span class="sh">'</span><span class="p">]].</span><span class="nf">groupby</span><span class="p">([</span><span class="sh">'</span><span class="s">Sex</span><span class="sh">'</span><span class="p">],</span><span class="n">as_index</span><span class="o">=</span><span class="bp">False</span><span class="p">).</span><span class="nf">agg</span><span class="p">([</span><span class="sh">'</span><span class="s">mean</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">count</span><span class="sh">'</span><span class="p">])</span>
</code></pre></div></div>

<div style="overflow-x:auto;">
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="2" halign="left">Survived</th>
    </tr>
    <tr>
      <th></th>
      <th>mean</th>
      <th>count</th>
    </tr>
    <tr>
      <th>Sex</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>female</th>
      <td>0.742038</td>
      <td>314</td>
    </tr>
    <tr>
      <th>male</th>
      <td>0.188908</td>
      <td>577</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">train</span><span class="p">[[</span><span class="sh">'</span><span class="s">Pclass</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Survived</span><span class="sh">'</span><span class="p">]].</span><span class="nf">groupby</span><span class="p">([</span><span class="sh">'</span><span class="s">Pclass</span><span class="sh">'</span><span class="p">],</span><span class="n">as_index</span><span class="o">=</span><span class="bp">False</span><span class="p">).</span><span class="nf">agg</span><span class="p">([</span><span class="sh">'</span><span class="s">mean</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">count</span><span class="sh">'</span><span class="p">])</span>
</code></pre></div></div>

<div style="overflow-x:auto;">
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="2" halign="left">Survived</th>
    </tr>
    <tr>
      <th></th>
      <th>mean</th>
      <th>count</th>
    </tr>
    <tr>
      <th>Pclass</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>0.629630</td>
      <td>216</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.472826</td>
      <td>184</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.242363</td>
      <td>491</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">train</span><span class="p">[[</span><span class="sh">'</span><span class="s">SibSp</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Survived</span><span class="sh">'</span><span class="p">]].</span><span class="nf">groupby</span><span class="p">([</span><span class="sh">'</span><span class="s">SibSp</span><span class="sh">'</span><span class="p">],</span><span class="n">as_index</span><span class="o">=</span><span class="bp">False</span><span class="p">).</span><span class="nf">agg</span><span class="p">([</span><span class="sh">'</span><span class="s">mean</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">count</span><span class="sh">'</span><span class="p">])</span>
</code></pre></div></div>

<div style="overflow-x:auto;">
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="2" halign="left">Survived</th>
    </tr>
    <tr>
      <th></th>
      <th>mean</th>
      <th>count</th>
    </tr>
    <tr>
      <th>SibSp</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.345395</td>
      <td>608</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.535885</td>
      <td>209</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.464286</td>
      <td>28</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.250000</td>
      <td>16</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.166667</td>
      <td>18</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.000000</td>
      <td>5</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0.000000</td>
      <td>7</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">train</span><span class="p">[[</span><span class="sh">'</span><span class="s">Parch</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Survived</span><span class="sh">'</span><span class="p">]].</span><span class="nf">groupby</span><span class="p">([</span><span class="sh">'</span><span class="s">Parch</span><span class="sh">'</span><span class="p">],</span><span class="n">as_index</span><span class="o">=</span><span class="bp">False</span><span class="p">).</span><span class="nf">agg</span><span class="p">([</span><span class="sh">'</span><span class="s">mean</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">count</span><span class="sh">'</span><span class="p">])</span>
</code></pre></div></div>

<div style="overflow-x:auto;">
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="2" halign="left">Survived</th>
    </tr>
    <tr>
      <th></th>
      <th>mean</th>
      <th>count</th>
    </tr>
    <tr>
      <th>Parch</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.343658</td>
      <td>678</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.550847</td>
      <td>118</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.500000</td>
      <td>80</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.600000</td>
      <td>5</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.000000</td>
      <td>4</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.200000</td>
      <td>5</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.000000</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>

<p>In conclusion:</p>

<ul>
  <li>Gender, Females have a higher change of survival over men (74% vs. 19%)</li>
  <li>Pclass, the survival rate is strongly correlated with the passenger class</li>
  <li>SibSp, Parch, smaller family tends to have a higher survival rate</li>
</ul>

<p><a id="Section_32"></a></p>
<h3 id="32-age">3.2 Age</h3>
<p>The age feature is likely important for the predictions, however, it contains a large number of missing values. We need to come up with a strategy to fill the missing values. Let’s start by computing the feature correlations to determine which feature is highly correlated to the age of the passengers.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># compute all correlations
</span><span class="n">df_all_corr</span> <span class="o">=</span> <span class="n">df_all</span><span class="p">.</span><span class="nf">corr</span><span class="p">().</span><span class="nf">abs</span><span class="p">()</span>

<span class="c1"># display correlations with age
</span><span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Correlation with Age feature</span><span class="sh">"</span><span class="p">)</span>
<span class="n">df_all_corr</span><span class="p">[</span><span class="sh">'</span><span class="s">Age</span><span class="sh">'</span><span class="p">].</span><span class="nf">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Correlation with Age feature

Pclass         0.408106
SibSp          0.243699
Fare           0.178740
Parch          0.150917
Survived       0.077221
PassengerId    0.028814
Name: Age, dtype: float64
</code></pre></div></div>

<p>As listed above, the Class feature is fairly well correlated to the Age of the passenger. <strong>However</strong>, the listed correlation do not include the effects of binary features such as the gender. We can breakdown the correlations to include sub-divisions.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df_exp</span><span class="p">[</span><span class="sh">'</span><span class="s">Cat</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_exp</span><span class="p">[</span><span class="sh">'</span><span class="s">Sex</span><span class="sh">'</span><span class="p">].</span><span class="nf">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> <span class="n">df_exp</span><span class="p">[</span><span class="sh">'</span><span class="s">Pclass</span><span class="sh">'</span><span class="p">].</span><span class="nf">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
<span class="n">df_exp</span><span class="p">.</span><span class="nf">groupby</span><span class="p">([</span><span class="sh">'</span><span class="s">Cat</span><span class="sh">'</span><span class="p">]).</span><span class="nf">median</span><span class="p">()[</span><span class="sh">'</span><span class="s">Age</span><span class="sh">'</span><span class="p">]</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Cat
female1    36.0
female2    28.0
female3    22.0
male1      42.0
male2      29.5
male3      25.0
Name: Age, dtype: float64
</code></pre></div></div>

<p>From the above, we can see that for each class women seem to be younger than men. In addition, we can see that older passengers travels in higher class.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># fill missing age with groups Sex + PClass
</span><span class="n">df_all</span><span class="p">[</span><span class="sh">'</span><span class="s">Age</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_all</span><span class="p">.</span><span class="nf">groupby</span><span class="p">([</span><span class="sh">'</span><span class="s">Sex</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Pclass</span><span class="sh">'</span>
                               <span class="p">])[</span><span class="sh">'</span><span class="s">Age</span><span class="sh">'</span><span class="p">].</span><span class="nf">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">.</span><span class="nf">fillna</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="nf">median</span><span class="p">()))</span>

<span class="k">assert</span> <span class="n">df_all</span><span class="p">[</span><span class="sh">'</span><span class="s">Age</span><span class="sh">'</span><span class="p">].</span><span class="nf">isnull</span><span class="p">().</span><span class="nf">sum</span><span class="p">()</span><span class="o">==</span><span class="mi">0</span>
</code></pre></div></div>

<p>The age feature is now complete.</p>

<p><a id="Section_33"></a></p>
<h3 id="33-embarked-feature">3.3 Embarked Feature</h3>
<p>The embarked feature has missing values in the training set.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Distribution of the data
</span><span class="n">train</span><span class="p">[</span><span class="sh">'</span><span class="s">Embarked</span><span class="sh">'</span><span class="p">].</span><span class="nf">value_counts</span><span class="p">(</span><span class="n">dropna</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>S      644
C      168
Q       77
NaN      2
Name: Embarked, dtype: int64
</code></pre></div></div>

<p>We now inspect the rest of the records for these two missing values:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">train</span><span class="p">[</span><span class="n">train</span><span class="p">[</span><span class="sh">'</span><span class="s">Embarked</span><span class="sh">'</span><span class="p">].</span><span class="nf">isnull</span><span class="p">()]</span>
</code></pre></div></div>

<div style="overflow-x:auto;">
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Survived</th>
      <th>Pclass</th>
      <th>Name</th>
      <th>Sex</th>
      <th>Age</th>
      <th>SibSp</th>
      <th>Parch</th>
      <th>Ticket</th>
      <th>Fare</th>
      <th>Cabin</th>
      <th>Embarked</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>61</th>
      <td>1</td>
      <td>1</td>
      <td>Icard, Miss. Amelie</td>
      <td>female</td>
      <td>38.0</td>
      <td>0</td>
      <td>0</td>
      <td>113572</td>
      <td>80.0</td>
      <td>B28</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>829</th>
      <td>1</td>
      <td>1</td>
      <td>Stone, Mrs. George Nelson (Martha Evelyn)</td>
      <td>female</td>
      <td>62.0</td>
      <td>0</td>
      <td>0</td>
      <td>113572</td>
      <td>80.0</td>
      <td>B28</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>

<p>Let’s group the passenger with similar features:</p>
<ul>
  <li>Female</li>
  <li>1st Class</li>
  <li>Fare between 50 and 100</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df_all</span><span class="p">[(</span><span class="n">df_all</span><span class="p">[</span><span class="sh">'</span><span class="s">Pclass</span><span class="sh">'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_all</span><span class="p">[</span><span class="sh">'</span><span class="s">Sex</span><span class="sh">'</span><span class="p">]</span> <span class="o">==</span> <span class="sh">'</span><span class="s">female</span><span class="sh">'</span><span class="p">)</span> <span class="o">&amp;</span>
       <span class="p">(</span><span class="n">df_all</span><span class="p">[</span><span class="sh">'</span><span class="s">Fare</span><span class="sh">'</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">50</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_all</span><span class="p">[</span><span class="sh">'</span><span class="s">Fare</span><span class="sh">'</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">100</span><span class="p">)].</span><span class="nf">groupby</span><span class="p">(</span>
           <span class="p">[</span><span class="sh">'</span><span class="s">Embarked</span><span class="sh">'</span><span class="p">]).</span><span class="nf">count</span><span class="p">()[</span><span class="sh">'</span><span class="s">Age</span><span class="sh">'</span><span class="p">]</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Embarked
C    30
Q     2
S    35
Name: Age, dtype: int64
</code></pre></div></div>

<p>From the above, the most common embarked location is “S”. We will replace the missing values with this.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Fill missing values
</span><span class="n">df_all</span><span class="p">[</span><span class="sh">'</span><span class="s">Embarked</span><span class="sh">'</span><span class="p">].</span><span class="nf">fillna</span><span class="p">(</span><span class="sh">'</span><span class="s">S</span><span class="sh">'</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div>

<p><a id="Section_34"></a></p>
<h3 id="34-fare-feature">3.4 Fare Feature</h3>
<p>The test set has a missing value for the Fare feature.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Display record corresponding to missing value
</span><span class="n">df_all</span><span class="p">[</span><span class="n">df_all</span><span class="p">.</span><span class="n">Fare</span><span class="p">.</span><span class="nf">isnull</span><span class="p">()]</span>
</code></pre></div></div>

<div style="overflow-x:auto;">
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Age</th>
      <th>Cabin</th>
      <th>Embarked</th>
      <th>Fare</th>
      <th>Name</th>
      <th>Parch</th>
      <th>PassengerId</th>
      <th>Pclass</th>
      <th>Sex</th>
      <th>SibSp</th>
      <th>Survived</th>
      <th>Ticket</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1043</th>
      <td>60.5</td>
      <td>NaN</td>
      <td>S</td>
      <td>NaN</td>
      <td>Storey, Mr. Thomas</td>
      <td>0</td>
      <td>1044</td>
      <td>3</td>
      <td>male</td>
      <td>0</td>
      <td>NaN</td>
      <td>3701</td>
    </tr>
  </tbody>
</table>
</div>

<p>We will use the median Fare of the subset corresponding to Pclass=3, Embarked=’S’, Sex=’male’, Age&gt;=21 (for adult).</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Extract median
</span><span class="n">subset_med</span> <span class="o">=</span> <span class="n">df_all</span><span class="p">[(</span><span class="n">df_all</span><span class="p">[</span><span class="sh">'</span><span class="s">Pclass</span><span class="sh">'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_all</span><span class="p">[</span><span class="sh">'</span><span class="s">SibSp</span><span class="sh">'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span>
                  <span class="p">(</span><span class="n">df_all</span><span class="p">[</span><span class="sh">'</span><span class="s">Parch</span><span class="sh">'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)][</span><span class="sh">'</span><span class="s">Fare</span><span class="sh">'</span><span class="p">].</span><span class="nf">median</span><span class="p">()</span>

<span class="c1"># Replace missing value
</span><span class="n">df_all</span><span class="p">[</span><span class="sh">'</span><span class="s">Fare</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_all</span><span class="p">[</span><span class="sh">'</span><span class="s">Fare</span><span class="sh">'</span><span class="p">].</span><span class="nf">fillna</span><span class="p">(</span><span class="n">subset_med</span><span class="p">)</span>
</code></pre></div></div>

<p><a id="Section_35"></a></p>
<h3 id="35-cabin-feature">3.5 Cabin Feature</h3>

<p>The cabin feature is missing for 77% of the training set and 78% of the test set. With such a high percentage, the feature can either be dropped or feature engineering can be used to understand how the cabin id is defined. We opt for the second option.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Feature inspection
</span><span class="n">df_all</span><span class="p">[</span><span class="sh">'</span><span class="s">Cabin</span><span class="sh">'</span><span class="p">].</span><span class="nf">sort_values</span><span class="p">().</span><span class="nf">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>583     A10
1099    A11
475     A14
556     A16
1222    A18
Name: Cabin, dtype: object
</code></pre></div></div>

<p>By doing some research on the ship, the Cabin value contains the following information:</p>
<ol>
  <li>One letter standing for the boat deck</li>
  <li>One number standing for the cabin number</li>
</ol>

<figure>
<img src="https://tdody.github.io/assets/img/2020-02-02-Titanic/Titanic_cutaway_diagram.png" style="width: 400px;" />  
</figure>
<p>source: <a href="https://en.wikipedia.org/wiki/First_class_facilities_of_the_RMS_Titanic?oldformat=true">Wikipedia</a></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Extract deck name from cabine feature (replace with "M" (missing) if Cabin is null)
</span><span class="n">df_all</span><span class="p">[</span><span class="sh">'</span><span class="s">Deck</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_all</span><span class="p">[</span><span class="sh">'</span><span class="s">Cabin</span><span class="sh">'</span><span class="p">].</span><span class="nf">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">pd</span><span class="p">.</span><span class="nf">notnull</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">else</span> <span class="sh">"</span><span class="s">M</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df_plot</span> <span class="o">=</span> <span class="n">df_all</span><span class="p">.</span><span class="nf">groupby</span><span class="p">([</span><span class="sh">'</span><span class="s">Deck</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Pclass</span><span class="sh">'</span><span class="p">]).</span><span class="nf">size</span><span class="p">().</span><span class="nf">reset_index</span><span class="p">().</span><span class="nf">pivot</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="sh">'</span><span class="s">Pclass</span><span class="sh">'</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="sh">'</span><span class="s">Deck</span><span class="sh">'</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">df_plot</span><span class="p">.</span><span class="nf">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div></div>

<div style="overflow-x:auto;">
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Pclass</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
    </tr>
    <tr>
      <th>Deck</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>A</th>
      <td>22.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>B</th>
      <td>65.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>C</th>
      <td>94.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>D</th>
      <td>40.0</td>
      <td>6.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>E</th>
      <td>34.0</td>
      <td>4.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>F</th>
      <td>0.0</td>
      <td>13.0</td>
      <td>8.0</td>
    </tr>
    <tr>
      <th>G</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>M</th>
      <td>67.0</td>
      <td>254.0</td>
      <td>693.0</td>
    </tr>
    <tr>
      <th>T</th>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df_plot</span> <span class="o">=</span> <span class="n">df_plot</span><span class="p">.</span><span class="nf">div</span><span class="p">(</span><span class="n">df_plot</span><span class="p">.</span><span class="nf">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="c1">#ax = sns.countplot(x='Deck', data=df_all, hue='Pclass')
</span><span class="n">df_plot</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="sh">'</span><span class="s">bar</span><span class="sh">'</span><span class="p">,</span> <span class="n">stacked</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">set_title</span><span class="p">(</span><span class="sh">'</span><span class="s">Class Distribution per Decks</span><span class="sh">'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">set_ylabel</span><span class="p">(</span><span class="sh">"</span><span class="s">Fraction of deck</span><span class="sh">"</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2020-02-02-Titanic/output_60_0.png" />
</figure>

<p>The following observations can be made from the above plot:</p>
<ol>
  <li>Decks A, B, C are dedicated to the 1st class</li>
  <li>Decks D and E are mostly assigned to the 1st class</li>
  <li>Deck F is split for class 2 and 3</li>
  <li>Deck G is for the first class only</li>
  <li>Only one passenger is assigned to Deck T, this must be a mistake.</li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># move T Deck passenger to Deck A
</span><span class="n">idx</span> <span class="o">=</span> <span class="n">df_all</span><span class="p">[</span><span class="n">df_all</span><span class="p">[</span><span class="sh">'</span><span class="s">Deck</span><span class="sh">'</span><span class="p">]</span> <span class="o">==</span> <span class="sh">'</span><span class="s">T</span><span class="sh">'</span><span class="p">].</span><span class="n">index</span>
<span class="n">df_all</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="sh">'</span><span class="s">Deck</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="sh">'</span><span class="s">A</span><span class="sh">'</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df_plot</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="nf">divide_df</span><span class="p">(</span><span class="n">df_all</span><span class="p">)</span>
<span class="n">df_plot</span> <span class="o">=</span> <span class="n">df_plot</span><span class="p">.</span><span class="nf">groupby</span><span class="p">([</span><span class="sh">'</span><span class="s">Deck</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Survived</span><span class="sh">'</span><span class="p">]).</span><span class="nf">size</span><span class="p">().</span><span class="nf">reset_index</span><span class="p">().</span><span class="nf">pivot</span><span class="p">(</span>
    <span class="n">columns</span><span class="o">=</span><span class="sh">'</span><span class="s">Survived</span><span class="sh">'</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="sh">'</span><span class="s">Deck</span><span class="sh">'</span><span class="p">).</span><span class="nf">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nf">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df_plot</span> <span class="o">=</span> <span class="n">df_plot</span><span class="p">.</span><span class="nf">div</span><span class="p">(</span><span class="n">df_plot</span><span class="p">.</span><span class="nf">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="c1">#ax = sns.countplot(x='Deck', data=df_all, hue='Pclass')
</span><span class="n">df_plot</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="sh">'</span><span class="s">bar</span><span class="sh">'</span><span class="p">,</span> <span class="n">stacked</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">r</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">b</span><span class="sh">'</span><span class="p">])</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">set_title</span><span class="p">(</span><span class="sh">'</span><span class="s">Survival Rate per Decks</span><span class="sh">'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">set_ylabel</span><span class="p">(</span><span class="sh">"</span><span class="s">Survival Rate</span><span class="sh">"</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2020-02-02-Titanic/output_64_0.png" />
</figure>

<p>We can now group decks based on the survival rate and the class distribution.</p>

<p>We group:</p>
<ul>
  <li>A, B, C since they exclusively contain 1st class passengers.</li>
  <li>D and E as they mostly contain 1st class passengers.</li>
  <li>F and G as they contain 2nd and 3rd class while having as similar survival rate.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df_all</span><span class="p">[</span><span class="sh">'</span><span class="s">Deck</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_all</span><span class="p">[</span><span class="sh">'</span><span class="s">Deck</span><span class="sh">'</span><span class="p">].</span><span class="nf">replace</span><span class="p">([</span><span class="sh">'</span><span class="s">A</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">B</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">C</span><span class="sh">'</span><span class="p">],</span> <span class="sh">'</span><span class="s">ABC</span><span class="sh">'</span><span class="p">)</span>
<span class="n">df_all</span><span class="p">[</span><span class="sh">'</span><span class="s">Deck</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_all</span><span class="p">[</span><span class="sh">'</span><span class="s">Deck</span><span class="sh">'</span><span class="p">].</span><span class="nf">replace</span><span class="p">([</span><span class="sh">'</span><span class="s">D</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">E</span><span class="sh">'</span><span class="p">],</span> <span class="sh">'</span><span class="s">DE</span><span class="sh">'</span><span class="p">)</span>
<span class="n">df_all</span><span class="p">[</span><span class="sh">'</span><span class="s">Deck</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_all</span><span class="p">[</span><span class="sh">'</span><span class="s">Deck</span><span class="sh">'</span><span class="p">].</span><span class="nf">replace</span><span class="p">([</span><span class="sh">'</span><span class="s">F</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">G</span><span class="sh">'</span><span class="p">],</span> <span class="sh">'</span><span class="s">FG</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># drop cabin
</span><span class="n">df_all</span> <span class="o">=</span> <span class="n">df_all</span><span class="p">.</span><span class="nf">drop</span><span class="p">([</span><span class="sh">'</span><span class="s">Cabin</span><span class="sh">'</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<p>At this point, we have filled all the missing values.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">train</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="nf">divide_df</span><span class="p">(</span><span class="n">df_all</span><span class="p">)</span>
</code></pre></div></div>

<hr />
<p><a id="Section_4"></a></p>
<h2 id="4-data-visualization-and-feature-exploration">4. Data Visualization and Feature Exploration</h2>

<p>Before we implement the full model, it is important to inspect the data and answers a few basic questions. This will help understanding how the data is distributed but also will provide useful input used in our models.</p>

<p>Based on the famous rule <em>“Women and children first”</em>, we expect the gender and age to be strongly correlated with the survival rate.</p>

<p>Questions:</p>

<ol>
  <li>Gender: Is the survival rate higher for females?</li>
  <li>Age: Is the survival rate higher for young passengers?</li>
  <li>Pclass &amp; Fare: Is the survival rate higher amongst wealthy passengers?</li>
  <li>SibSp &amp; Parch: Is the survival rate for family is higher than the one for single passenger?</li>
</ol>

<h3 id="41-gender">4.1 Gender</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Plot the box plot
</span><span class="n">pal</span> <span class="o">=</span> <span class="p">{</span><span class="sh">'</span><span class="s">female</span><span class="sh">'</span><span class="p">:</span><span class="sh">"</span><span class="s">salmon</span><span class="sh">"</span><span class="p">,</span><span class="sh">'</span><span class="s">male</span><span class="sh">'</span><span class="p">:</span><span class="sh">"</span><span class="s">skyblue</span><span class="sh">"</span><span class="p">}</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="p">.</span><span class="nf">barplot</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="sh">"</span><span class="s">Sex</span><span class="sh">"</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="sh">"</span><span class="s">Survived</span><span class="sh">"</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">train</span><span class="p">,</span> <span class="n">palette</span> <span class="o">=</span> <span class="n">pal</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">title</span><span class="p">(</span><span class="sh">"</span><span class="s">Impact of gender on the survival rate</span><span class="sh">"</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">ylabel</span><span class="p">(</span><span class="sh">"</span><span class="s">Survival rate</span><span class="sh">"</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">xlabel</span><span class="p">(</span><span class="sh">"</span><span class="s">Sex</span><span class="sh">"</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">);</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2020-02-02-Titanic/output_72_0.png" />
</figure>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Male mean survival rate = </span><span class="se">\t</span><span class="s"> {:.2f}%</span><span class="sh">"</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="n">train</span><span class="p">[</span><span class="sh">'</span><span class="s">Sex</span><span class="sh">'</span><span class="p">]</span> <span class="o">==</span><span class="sh">'</span><span class="s">male</span><span class="sh">'</span><span class="p">][</span><span class="sh">'</span><span class="s">Survived</span><span class="sh">'</span><span class="p">].</span><span class="nf">mean</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span><span class="p">))</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Female mean survival rate = </span><span class="se">\t</span><span class="s"> {:.2f}%</span><span class="sh">"</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="n">train</span><span class="p">[</span><span class="sh">'</span><span class="s">Sex</span><span class="sh">'</span><span class="p">]</span> <span class="o">!=</span> <span class="sh">'</span><span class="s">male</span><span class="sh">'</span><span class="p">][</span><span class="sh">'</span><span class="s">Survived</span><span class="sh">'</span><span class="p">].</span><span class="nf">mean</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Male mean survival rate = 	 18.89%
Female mean survival rate = 	 74.20%
</code></pre></div></div>

<p><strong>Comment</strong> <br />
Based on the boxplot, the gender appears to be a critical feature when it comes to determining the faith of a passenger. Indeed, females seem to have on average a much higher survival rate.</p>

<p><a id="Section_42"></a></p>
<h3 id="42-age">4.2 Age</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Plot kernel density plot
</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="p">.</span><span class="nf">kdeplot</span><span class="p">(</span><span class="n">train</span><span class="p">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">train</span><span class="p">[</span><span class="sh">'</span><span class="s">Survived</span><span class="sh">'</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">),</span><span class="sh">'</span><span class="s">Age</span><span class="sh">'</span><span class="p">],</span><span class="n">shade</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="sh">'</span><span class="s">blue</span><span class="sh">'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sh">'</span><span class="s">Survived</span><span class="sh">'</span><span class="p">);</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="p">.</span><span class="nf">kdeplot</span><span class="p">(</span><span class="n">train</span><span class="p">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">train</span><span class="p">[</span><span class="sh">'</span><span class="s">Survived</span><span class="sh">'</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">),</span><span class="sh">'</span><span class="s">Age</span><span class="sh">'</span><span class="p">],</span><span class="n">shade</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="sh">'</span><span class="s">red</span><span class="sh">'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sh">'</span><span class="s">Not Survived</span><span class="sh">'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">set_ylabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Frequency</span><span class="sh">'</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">set_xlabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Age</span><span class="sh">'</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">);</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2020-02-02-Titanic/output_76_0.png" />
</figure>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Toddler survival rate = </span><span class="se">\t</span><span class="s">{:.2f}%</span><span class="sh">"</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="n">train</span><span class="p">[</span><span class="sh">'</span><span class="s">Age</span><span class="sh">'</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">][</span><span class="sh">'</span><span class="s">Survived</span><span class="sh">'</span><span class="p">].</span><span class="nf">mean</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Children survival rate = </span><span class="se">\t</span><span class="s">{:.2f}%</span><span class="sh">"</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">train</span><span class="p">[(</span><span class="n">train</span><span class="p">[</span><span class="sh">'</span><span class="s">Age</span><span class="sh">'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="sh">'</span><span class="s">Age</span><span class="sh">'</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">12</span><span class="p">)][</span><span class="sh">'</span><span class="s">Survived</span><span class="sh">'</span><span class="p">].</span><span class="nf">mean</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Teenager survival rate = </span><span class="se">\t</span><span class="s">{:.2f}%</span><span class="sh">"</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">train</span><span class="p">[(</span><span class="n">train</span><span class="p">[</span><span class="sh">'</span><span class="s">Age</span><span class="sh">'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">12</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="sh">'</span><span class="s">Age</span><span class="sh">'</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">18</span><span class="p">)][</span><span class="sh">'</span><span class="s">Survived</span><span class="sh">'</span><span class="p">].</span><span class="nf">mean</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Young Adult survival rate = </span><span class="se">\t</span><span class="s">{:.2f}%</span><span class="sh">"</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">train</span><span class="p">[(</span><span class="n">train</span><span class="p">[</span><span class="sh">'</span><span class="s">Age</span><span class="sh">'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">18</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="sh">'</span><span class="s">Age</span><span class="sh">'</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">34</span><span class="p">)][</span><span class="sh">'</span><span class="s">Survived</span><span class="sh">'</span><span class="p">].</span><span class="nf">mean</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Adult survival rate = </span><span class="se">\t\t</span><span class="s">{:.2f}%</span><span class="sh">"</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">train</span><span class="p">[(</span><span class="n">train</span><span class="p">[</span><span class="sh">'</span><span class="s">Age</span><span class="sh">'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">34</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="sh">'</span><span class="s">Age</span><span class="sh">'</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">50</span><span class="p">)][</span><span class="sh">'</span><span class="s">Survived</span><span class="sh">'</span><span class="p">].</span><span class="nf">mean</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">pre-senior survival rate = </span><span class="se">\t</span><span class="s">{:.2f}%</span><span class="sh">"</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">train</span><span class="p">[(</span><span class="n">train</span><span class="p">[</span><span class="sh">'</span><span class="s">Age</span><span class="sh">'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="sh">'</span><span class="s">Age</span><span class="sh">'</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">70</span><span class="p">)][</span><span class="sh">'</span><span class="s">Survived</span><span class="sh">'</span><span class="p">].</span><span class="nf">mean</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">senior survival rate = </span><span class="se">\t\t</span><span class="s">{:.2f}%</span><span class="sh">"</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="n">train</span><span class="p">[</span><span class="sh">'</span><span class="s">Age</span><span class="sh">'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">70</span><span class="p">][</span><span class="sh">'</span><span class="s">Survived</span><span class="sh">'</span><span class="p">].</span><span class="nf">mean</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Toddler survival rate = 	62.50%
Children survival rate = 	55.56%
Teenager survival rate = 	42.86%
Young Adult survival rate = 	33.74%
Adult survival rate = 		42.57%
pre-senior survival rate = 	35.59%
senior survival rate = 		20.00%
</code></pre></div></div>

<p><strong>Comment</strong> <br />
Based on the distribution plot, the age also appears to be a critical feature. Young children have a much higher survival rate on average than the rest of the passenger. The survival rate tends to decrease with the age.</p>

<p><a id="Section_43"></a></p>
<h3 id="43-pclass-and-fare">4.3 Pclass and Fare</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Plot the survival rate per class
</span><span class="n">pal</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span><span class="sh">"</span><span class="s">gold</span><span class="sh">"</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="sh">"</span><span class="s">silver</span><span class="sh">"</span><span class="p">,</span><span class="mi">3</span><span class="p">:</span><span class="sh">'</span><span class="s">sandybrown</span><span class="sh">'</span><span class="p">}</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="p">.</span><span class="nf">barplot</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="sh">"</span><span class="s">Pclass</span><span class="sh">"</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="sh">"</span><span class="s">Survived</span><span class="sh">"</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">train</span><span class="p">,</span> <span class="n">palette</span> <span class="o">=</span> <span class="n">pal</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">title</span><span class="p">(</span><span class="sh">"</span><span class="s">Impact of class on the survival rate</span><span class="sh">"</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">ylabel</span><span class="p">(</span><span class="sh">"</span><span class="s">Survival rate</span><span class="sh">"</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">xlabel</span><span class="p">(</span><span class="sh">"</span><span class="s">Class</span><span class="sh">"</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">);</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2020-02-02-Titanic/output_80_0.png" />
</figure>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Upper class survival rate =</span><span class="se">\t</span><span class="s">{:.2f}%</span><span class="sh">"</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="n">train</span><span class="p">[</span><span class="sh">'</span><span class="s">Pclass</span><span class="sh">'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">][</span><span class="sh">'</span><span class="s">Survived</span><span class="sh">'</span><span class="p">].</span><span class="nf">mean</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span><span class="p">))</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Middle class survival rate =</span><span class="se">\t</span><span class="s">{:.2f}%</span><span class="sh">"</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="n">train</span><span class="p">[</span><span class="sh">'</span><span class="s">Pclass</span><span class="sh">'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">][</span><span class="sh">'</span><span class="s">Survived</span><span class="sh">'</span><span class="p">].</span><span class="nf">mean</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span><span class="p">))</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Lower class survival rate =</span><span class="se">\t</span><span class="s">{:.2f}%</span><span class="sh">"</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="n">train</span><span class="p">[</span><span class="sh">'</span><span class="s">Pclass</span><span class="sh">'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">][</span><span class="sh">'</span><span class="s">Survived</span><span class="sh">'</span><span class="p">].</span><span class="nf">mean</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Upper class survival rate =	62.96%
Middle class survival rate =	47.28%
Lower class survival rate =	24.24%
</code></pre></div></div>

<p><strong>Comment</strong> <br />
The above plot confirms our assumption: upper class passengers had a much higher survival rate.</p>

<p>Before we look at the impact of the fare on the survival rate, we need to verify how the class is correlated to the fare.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Plot the survival rate per class
</span><span class="n">pal</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span><span class="sh">"</span><span class="s">gold</span><span class="sh">"</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="sh">"</span><span class="s">silver</span><span class="sh">"</span><span class="p">,</span><span class="mi">3</span><span class="p">:</span><span class="sh">'</span><span class="s">sandybrown</span><span class="sh">'</span><span class="p">}</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="p">.</span><span class="nf">barplot</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="sh">"</span><span class="s">Pclass</span><span class="sh">"</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="sh">"</span><span class="s">Fare</span><span class="sh">"</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">train</span><span class="p">,</span> <span class="n">palette</span> <span class="o">=</span> <span class="n">pal</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">title</span><span class="p">(</span><span class="sh">"</span><span class="s">Impact of the passenger class on the fare</span><span class="sh">"</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">ylabel</span><span class="p">(</span><span class="sh">"</span><span class="s">Fare</span><span class="sh">"</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">xlabel</span><span class="p">(</span><span class="sh">"</span><span class="s">Pclass</span><span class="sh">"</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">);</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2020-02-02-Titanic/output_83_0.png" />
</figure>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">Median fare:</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">1st class =</span><span class="se">\t</span><span class="s">$${:.2f}</span><span class="sh">"</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="n">train</span><span class="p">[</span><span class="sh">'</span><span class="s">Pclass</span><span class="sh">'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">][</span><span class="sh">'</span><span class="s">Fare</span><span class="sh">'</span><span class="p">].</span><span class="nf">median</span><span class="p">()))</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">2nd class =</span><span class="se">\t</span><span class="s">$${:.2f}</span><span class="sh">"</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="n">train</span><span class="p">[</span><span class="sh">'</span><span class="s">Pclass</span><span class="sh">'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">][</span><span class="sh">'</span><span class="s">Fare</span><span class="sh">'</span><span class="p">].</span><span class="nf">median</span><span class="p">()))</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">3nd class =</span><span class="se">\t</span><span class="s">$${:.2f}</span><span class="sh">"</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="n">train</span><span class="p">[</span><span class="sh">'</span><span class="s">Pclass</span><span class="sh">'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">][</span><span class="sh">'</span><span class="s">Fare</span><span class="sh">'</span><span class="p">].</span><span class="nf">median</span><span class="p">()))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Median fare:
1st class =	$$60.29
2nd class =	$$14.25
3nd class =	$$8.05
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Box plot
</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="p">.</span><span class="nf">boxplot</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="sh">'</span><span class="s">Pclass</span><span class="sh">'</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="sh">'</span><span class="s">Fare</span><span class="sh">'</span><span class="p">,</span> <span class="n">hue</span> <span class="o">=</span> <span class="sh">'</span><span class="s">Survived</span><span class="sh">'</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">train</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">set_title</span><span class="p">(</span><span class="sh">'</span><span class="s">Pclass vs Fare Survival Comparison</span><span class="sh">'</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">300</span><span class="p">);</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2020-02-02-Titanic/output_85_0.png" />
</figure>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">6</span><span class="p">),)</span>
<span class="n">ax</span><span class="o">=</span><span class="n">sns</span><span class="p">.</span><span class="nf">distplot</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="sh">'</span><span class="s">Fare</span><span class="sh">'</span><span class="p">]</span> <span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="sh">'</span><span class="s">blue</span><span class="sh">'</span><span class="p">,</span><span class="n">kde</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">set_ylabel</span><span class="p">(</span><span class="sh">"</span><span class="s">Count</span><span class="sh">"</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">set_title</span><span class="p">(</span><span class="sh">'</span><span class="s">Fare distribution</span><span class="sh">'</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">set_xticks</span><span class="p">(</span><span class="nf">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">600</span><span class="p">,</span><span class="mi">25</span><span class="p">));</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2020-02-02-Titanic/output_86_0.png" />
</figure>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Kernel Density Plot
</span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span><span class="o">=</span><span class="n">sns</span><span class="p">.</span><span class="nf">distplot</span><span class="p">(</span><span class="n">train</span><span class="p">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">train</span><span class="p">[</span><span class="sh">'</span><span class="s">Survived</span><span class="sh">'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">),</span><span class="sh">'</span><span class="s">Fare</span><span class="sh">'</span><span class="p">]</span> <span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="sh">'</span><span class="s">red</span><span class="sh">'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sh">'</span><span class="s">Not Survived</span><span class="sh">'</span><span class="p">,</span><span class="n">kde</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="mi">21</span><span class="p">)</span>
<span class="n">ax</span><span class="o">=</span><span class="n">sns</span><span class="p">.</span><span class="nf">distplot</span><span class="p">(</span><span class="n">train</span><span class="p">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">train</span><span class="p">[</span><span class="sh">'</span><span class="s">Survived</span><span class="sh">'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">),</span><span class="sh">'</span><span class="s">Fare</span><span class="sh">'</span><span class="p">]</span> <span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="sh">'</span><span class="s">blue</span><span class="sh">'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sh">'</span><span class="s">Survived</span><span class="sh">'</span><span class="p">,</span><span class="n">kde</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="mi">41</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">legend</span><span class="p">([</span><span class="sh">'</span><span class="s">Not Survived</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Survived</span><span class="sh">'</span><span class="p">])</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">xlabel</span><span class="p">(</span><span class="sh">"</span><span class="s">Fare</span><span class="sh">"</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">ylabel</span><span class="p">(</span><span class="sh">"</span><span class="s">Frequency of Passenger Survived</span><span class="sh">"</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">title</span><span class="p">(</span><span class="sh">'</span><span class="s">Fare Distribution Survived vs Non Survived</span><span class="sh">'</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">);</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2020-02-02-Titanic/output_87_0.png" />
</figure>

<p><strong>Comment</strong> <br />
As expected. the survival rate increases with the fare price. Based on the above plot, it appears that the survival rate is larger than 50% for fares higher that $$150.</p>

<p><a id="Section_44"></a></p>
<h3 id="44-sibsp--parch">4.4 SibSp &amp; Parch</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">train</span><span class="p">[[</span><span class="sh">'</span><span class="s">SibSp</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Survived</span><span class="sh">'</span><span class="p">]].</span><span class="nf">groupby</span><span class="p">([</span><span class="sh">'</span><span class="s">SibSp</span><span class="sh">'</span><span class="p">],</span><span class="n">as_index</span><span class="o">=</span><span class="bp">False</span><span class="p">).</span><span class="nf">mean</span><span class="p">().</span><span class="nf">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="sh">'</span><span class="s">Survived</span><span class="sh">'</span><span class="p">,</span><span class="n">ascending</span> <span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</code></pre></div></div>

<div style="overflow-x:auto;">
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>SibSp</th>
      <th>Survived</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>0.535885</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>0.464286</td>
    </tr>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>0.345395</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>0.250000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>0.166667</td>
    </tr>
    <tr>
      <th>5</th>
      <td>5</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>6</th>
      <td>8</td>
      <td>0.000000</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="p">.</span><span class="nf">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="sh">"</span><span class="s">SibSp</span><span class="sh">"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="sh">"</span><span class="s">Survived</span><span class="sh">"</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="sh">'</span><span class="s">r</span><span class="sh">'</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">train</span><span class="p">);</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2020-02-02-Titanic/output_91_0.png" />
</figure>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">train</span><span class="p">[[</span><span class="sh">'</span><span class="s">Parch</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Survived</span><span class="sh">'</span><span class="p">]].</span><span class="nf">groupby</span><span class="p">([</span><span class="sh">'</span><span class="s">Parch</span><span class="sh">'</span><span class="p">],</span><span class="n">as_index</span><span class="o">=</span><span class="bp">False</span><span class="p">).</span><span class="nf">mean</span><span class="p">().</span><span class="nf">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="sh">'</span><span class="s">Survived</span><span class="sh">'</span><span class="p">,</span><span class="n">ascending</span> <span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</code></pre></div></div>

<div style="overflow-x:auto;">
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Parch</th>
      <th>Survived</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>0.600000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>0.550847</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>0.500000</td>
    </tr>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>0.343658</td>
    </tr>
    <tr>
      <th>5</th>
      <td>5</td>
      <td>0.200000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>6</th>
      <td>6</td>
      <td>0.000000</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="p">.</span><span class="nf">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="sh">"</span><span class="s">Parch</span><span class="sh">"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="sh">"</span><span class="s">Survived</span><span class="sh">"</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="sh">'</span><span class="s">b</span><span class="sh">'</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">train</span><span class="p">);</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2020-02-02-Titanic/output_93_0.png" />
</figure>

<p><strong>Comment</strong> <br />
Passenger traveling with large family decreased the survival rate.</p>

<p><a id="Section_45"></a></p>
<h3 id="45-embarked">4.5 Embarked</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">train</span><span class="p">[[</span><span class="sh">'</span><span class="s">Embarked</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Survived</span><span class="sh">'</span><span class="p">]].</span><span class="nf">groupby</span><span class="p">([</span><span class="sh">'</span><span class="s">Embarked</span><span class="sh">'</span><span class="p">],</span><span class="n">as_index</span><span class="o">=</span><span class="bp">False</span><span class="p">).</span><span class="nf">mean</span><span class="p">().</span><span class="nf">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="sh">'</span><span class="s">Survived</span><span class="sh">'</span><span class="p">,</span><span class="n">ascending</span> <span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</code></pre></div></div>

<div style="overflow-x:auto;">
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Embarked</th>
      <th>Survived</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>C</td>
      <td>0.553571</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Q</td>
      <td>0.389610</td>
    </tr>
    <tr>
      <th>2</th>
      <td>S</td>
      <td>0.339009</td>
    </tr>
  </tbody>
</table>
</div>

<hr />
<p><a id="Section_5"></a></p>
<h2 id="5-statistical-study">5. Statistical Study</h2>

<p>In this section, we will inspect the data and quantify the observations that result from the data visualization.</p>

<p><a id="Section_51"></a></p>
<h3 id="51-main-features">5.1 Main Features</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Turning the Sex feature into a boolean classifier
</span><span class="n">train</span><span class="p">[</span><span class="sh">'</span><span class="s">Sex</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="sh">'</span><span class="s">Sex</span><span class="sh">'</span><span class="p">].</span><span class="nf">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="sh">"</span><span class="s">female</span><span class="sh">"</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">test</span><span class="p">[</span><span class="sh">'</span><span class="s">Sex</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="sh">'</span><span class="s">Sex</span><span class="sh">'</span><span class="p">].</span><span class="nf">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="sh">"</span><span class="s">female</span><span class="sh">"</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">train</span><span class="p">.</span><span class="nf">describe</span><span class="p">()</span>
</code></pre></div></div>

<div style="overflow-x:auto;">
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Age</th>
      <th>Fare</th>
      <th>Parch</th>
      <th>PassengerId</th>
      <th>Pclass</th>
      <th>Sex</th>
      <th>SibSp</th>
      <th>Survived</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>891.000000</td>
      <td>891.000000</td>
      <td>891.000000</td>
      <td>891.000000</td>
      <td>891.000000</td>
      <td>891.000000</td>
      <td>891.000000</td>
      <td>891.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>29.188182</td>
      <td>32.204208</td>
      <td>0.381594</td>
      <td>446.000000</td>
      <td>2.308642</td>
      <td>0.647587</td>
      <td>0.523008</td>
      <td>0.383838</td>
    </tr>
    <tr>
      <th>std</th>
      <td>13.337887</td>
      <td>49.693429</td>
      <td>0.806057</td>
      <td>257.353842</td>
      <td>0.836071</td>
      <td>0.477990</td>
      <td>1.102743</td>
      <td>0.486592</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.420000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>22.000000</td>
      <td>7.910400</td>
      <td>0.000000</td>
      <td>223.500000</td>
      <td>2.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>26.000000</td>
      <td>14.454200</td>
      <td>0.000000</td>
      <td>446.000000</td>
      <td>3.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>36.000000</td>
      <td>31.000000</td>
      <td>0.000000</td>
      <td>668.500000</td>
      <td>3.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>80.000000</td>
      <td>512.329200</td>
      <td>6.000000</td>
      <td>891.000000</td>
      <td>3.000000</td>
      <td>1.000000</td>
      <td>8.000000</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
</div>

<p><strong>Comment</strong> <br />
From the statistical data above, it appears that only 38% of the passengers survived.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">train</span><span class="p">[[</span><span class="sh">'</span><span class="s">Sex</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Survived</span><span class="sh">'</span><span class="p">]].</span><span class="nf">groupby</span><span class="p">(</span><span class="sh">"</span><span class="s">Sex</span><span class="sh">"</span><span class="p">).</span><span class="nf">mean</span><span class="p">()</span>
</code></pre></div></div>

<div style="overflow-x:auto;">
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Survived</th>
    </tr>
    <tr>
      <th>Sex</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.742038</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.188908</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">train</span><span class="p">[[</span><span class="sh">'</span><span class="s">Pclass</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Survived</span><span class="sh">'</span><span class="p">]].</span><span class="nf">groupby</span><span class="p">(</span><span class="sh">"</span><span class="s">Pclass</span><span class="sh">"</span><span class="p">).</span><span class="nf">mean</span><span class="p">()</span>
</code></pre></div></div>

<div style="overflow-x:auto;">
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Survived</th>
    </tr>
    <tr>
      <th>Pclass</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>0.629630</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.472826</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.242363</td>
    </tr>
  </tbody>
</table>
</div>

<p><a id="Section_52"></a></p>
<h3 id="52-correlation-study">5.2 Correlation Study</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Feature correlation
</span><span class="n">train</span><span class="p">.</span><span class="nf">corr</span><span class="p">()[</span><span class="sh">'</span><span class="s">Survived</span><span class="sh">'</span><span class="p">].</span><span class="nf">sort_values</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Sex           -0.543351
Pclass        -0.338481
Age           -0.058635
SibSp         -0.035322
PassengerId   -0.005007
Parch          0.081629
Fare           0.257307
Survived       1.000000
Name: Survived, dtype: float64
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Compute the correlation matrix
</span><span class="n">corr</span> <span class="o">=</span> <span class="n">train</span><span class="p">.</span><span class="nf">corr</span><span class="p">()</span>

<span class="c1"># Generate a mask for the upper triangle
</span><span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros_like</span><span class="p">(</span><span class="n">corr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="nb">bool</span><span class="p">)</span>
<span class="n">mask</span><span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="nf">triu_indices_from</span><span class="p">(</span><span class="n">mask</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">True</span>

<span class="c1"># Set up the matplotlib figure
</span><span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>

<span class="c1"># Generate a custom diverging colormap
</span><span class="n">cmap</span> <span class="o">=</span> <span class="n">sns</span><span class="p">.</span><span class="nf">diverging_palette</span><span class="p">(</span><span class="mi">220</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">as_cmap</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1"># Draw the heatmap with the mask and correct aspect ratio
</span><span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="p">.</span><span class="nf">heatmap</span><span class="p">(</span><span class="n">corr</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">vmin</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">annot</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
            <span class="n">square</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="n">cbar_kws</span><span class="o">=</span><span class="p">{</span><span class="sh">"</span><span class="s">shrink</span><span class="sh">"</span><span class="p">:</span> <span class="p">.</span><span class="mi">5</span><span class="p">})</span>

<span class="n">ylabels</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">.</span><span class="nf">get_text</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">.</span><span class="nf">get_yticklabels</span><span class="p">()]</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">yticks</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">ylabels</span><span class="p">))</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span><span class="n">ylabels</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="sh">"</span><span class="s">10</span><span class="sh">"</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="sh">"</span><span class="s">center</span><span class="sh">"</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">set_ylim</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mf">0.5</span><span class="p">);</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2020-02-02-Titanic/output_107_0.png" />
</figure>

<p><strong>Comment</strong></p>

<p>Strong positive correlations:</p>
<ul>
  <li>Parch and SibSp (0.41)</li>
  <li>Fare and Survived (0.26)</li>
  <li>Parch and Fare (0.22)</li>
</ul>

<p>Strong negative correlation</p>
<ul>
  <li>Fare and Pclass (-0.42)</li>
  <li>Pclass and Age (-0.42)</li>
  <li>Pclass and Survived (-0.34)</li>
</ul>

<hr />
<p><a id="Section_6"></a></p>
<h2 id="6-feature-preparation">6. Feature Preparation</h2>

<p>Based on the knowledge gathered, we can now create new features that will help improve the model accuracy.</p>

<p><a id="Section_61"></a></p>
<h3 id="61-passenger-title">6.1 Passenger Title</h3>

<p>Upon inspection of the Name feature, it appear that a title is assigned to each passenger. We extract this feature and store it in the dataset.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># extrace new feature using regular expression
</span><span class="n">df_all</span><span class="p">[</span><span class="sh">'</span><span class="s">Title</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_all</span><span class="p">[</span><span class="sh">'</span><span class="s">Name</span><span class="sh">'</span><span class="p">].</span><span class="nb">str</span><span class="p">.</span><span class="nf">extract</span><span class="p">(</span><span class="sa">r</span><span class="sh">'</span><span class="s"> ([A-Za-z]+)\.</span><span class="sh">'</span><span class="p">,</span><span class="n">expand</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">df_all</span><span class="p">[</span><span class="sh">'</span><span class="s">Is_Married</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">df_all</span><span class="p">[</span><span class="sh">'</span><span class="s">Is_Married</span><span class="sh">'</span><span class="p">].</span><span class="n">loc</span><span class="p">[</span><span class="n">df_all</span><span class="p">[</span><span class="sh">'</span><span class="s">Title</span><span class="sh">'</span><span class="p">]</span><span class="o">==</span><span class="sh">'</span><span class="s">Mrs</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="p">.</span><span class="nf">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">df_all</span><span class="p">[</span><span class="sh">'</span><span class="s">Title</span><span class="sh">'</span><span class="p">].</span><span class="nf">value_counts</span><span class="p">().</span><span class="n">index</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">df_all</span><span class="p">[</span><span class="sh">'</span><span class="s">Title</span><span class="sh">'</span><span class="p">].</span><span class="nf">value_counts</span><span class="p">().</span><span class="n">values</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">set_title</span><span class="p">(</span><span class="sh">"</span><span class="s">Title Distribution</span><span class="sh">"</span><span class="p">);</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2020-02-02-Titanic/output_113_0.png" />
</figure>

<p>There are four principle titles. The rest consists of mostly single values. We can see if the survival rate varies between titles.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df_plot</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="nf">divide_df</span><span class="p">(</span><span class="n">df_all</span><span class="p">)</span>
<span class="n">df_plot</span> <span class="o">=</span> <span class="n">df_plot</span><span class="p">.</span><span class="nf">groupby</span><span class="p">([</span><span class="sh">'</span><span class="s">Title</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Survived</span><span class="sh">'</span><span class="p">]).</span><span class="nf">size</span><span class="p">().</span><span class="nf">reset_index</span><span class="p">().</span><span class="nf">pivot</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="sh">'</span><span class="s">Survived</span><span class="sh">'</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="sh">'</span><span class="s">Title</span><span class="sh">'</span><span class="p">).</span><span class="nf">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nf">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df_plot</span> <span class="o">=</span> <span class="n">df_plot</span><span class="p">.</span><span class="nf">div</span><span class="p">(</span><span class="n">df_plot</span><span class="p">.</span><span class="nf">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="c1">#ax = sns.countplot(x='Deck', data=df_all, hue='Pclass')
</span><span class="n">df_plot</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="sh">'</span><span class="s">bar</span><span class="sh">'</span><span class="p">,</span> <span class="n">stacked</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">r</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">b</span><span class="sh">'</span><span class="p">])</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">set_title</span><span class="p">(</span><span class="sh">'</span><span class="s">Survival Rate per Decks</span><span class="sh">'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">set_ylabel</span><span class="p">(</span><span class="sh">"</span><span class="s">Survival Rate</span><span class="sh">"</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">legend</span><span class="p">([</span><span class="sh">'</span><span class="s">Not Survived</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Survived</span><span class="sh">'</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="sh">"</span><span class="s">upper right</span><span class="sh">"</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2020-02-02-Titanic/output_116_0.png" />
</figure>

<p>Based on the results shown above, it appears that different title are used to describe the same status. For instance Miss, Mlle, and Ms are used to describe Miss. We standardize the titles using a custom function.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df_all</span><span class="p">[</span><span class="sh">'</span><span class="s">Title</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_all</span><span class="p">[</span><span class="sh">'</span><span class="s">Title</span><span class="sh">'</span><span class="p">].</span><span class="nf">replace</span><span class="p">(</span>
    <span class="p">[</span><span class="sh">'</span><span class="s">Miss</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Mrs</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Ms</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Mlle</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Lady</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Mme</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Countess</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Dona</span><span class="sh">'</span><span class="p">],</span><span class="sh">'</span><span class="s">Miss/Mrs/Ms</span><span class="sh">'</span><span class="p">)</span>
<span class="n">df_all</span><span class="p">[</span><span class="sh">'</span><span class="s">Title</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_all</span><span class="p">[</span><span class="sh">'</span><span class="s">Title</span><span class="sh">'</span><span class="p">].</span><span class="nf">replace</span><span class="p">(</span>
    <span class="p">[</span><span class="sh">'</span><span class="s">Dr</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Col</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Major</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Jonkheer</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Capt</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Sir</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Don</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Rev</span><span class="sh">'</span><span class="p">],</span> <span class="sh">'</span><span class="s">Rare</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df_plot</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="nf">divide_df</span><span class="p">(</span><span class="n">df_all</span><span class="p">)</span>
<span class="n">df_plot</span> <span class="o">=</span> <span class="n">df_plot</span><span class="p">.</span><span class="nf">groupby</span><span class="p">([</span><span class="sh">'</span><span class="s">Title</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Survived</span><span class="sh">'</span><span class="p">]).</span><span class="nf">size</span><span class="p">().</span><span class="nf">reset_index</span><span class="p">().</span><span class="nf">pivot</span><span class="p">(</span>
    <span class="n">columns</span><span class="o">=</span><span class="sh">'</span><span class="s">Survived</span><span class="sh">'</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="sh">'</span><span class="s">Title</span><span class="sh">'</span><span class="p">).</span><span class="nf">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nf">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df_plot</span> <span class="o">=</span> <span class="n">df_plot</span><span class="p">.</span><span class="nf">div</span><span class="p">(</span><span class="n">df_plot</span><span class="p">.</span><span class="nf">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">df_plot</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="sh">'</span><span class="s">bar</span><span class="sh">'</span><span class="p">,</span> <span class="n">stacked</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">r</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">b</span><span class="sh">'</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">set_title</span><span class="p">(</span><span class="sh">'</span><span class="s">Survival Rate per Decks</span><span class="sh">'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">set_ylabel</span><span class="p">(</span><span class="sh">"</span><span class="s">Survival Rate</span><span class="sh">"</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">legend</span><span class="p">([</span><span class="sh">'</span><span class="s">Not Survived</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Survived</span><span class="sh">'</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="sh">"</span><span class="s">upper right</span><span class="sh">"</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

<span class="n">sns</span><span class="p">.</span><span class="nf">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">df_all</span><span class="p">[</span><span class="sh">'</span><span class="s">Title</span><span class="sh">'</span><span class="p">].</span><span class="nf">value_counts</span><span class="p">().</span><span class="n">index</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">df_all</span><span class="p">[</span><span class="sh">'</span><span class="s">Title</span><span class="sh">'</span><span class="p">].</span><span class="nf">value_counts</span><span class="p">().</span><span class="n">values</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nf">set_title</span><span class="p">(</span><span class="sh">"</span><span class="s">Title Distribution</span><span class="sh">"</span><span class="p">);</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2020-02-02-Titanic/output_120_0.png" />
</figure>

<p>As displayed above the passenger title influences the survival rate.</p>

<p><a id="Section_62"></a></p>
<h3 id="62-family-size">6.2 Family Size</h3>

<p>We can create a new feature used to calculate the size of the family:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df_all</span><span class="p">[</span><span class="sh">'</span><span class="s">Family_Size</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_all</span><span class="p">[</span><span class="sh">'</span><span class="s">Parch</span><span class="sh">'</span><span class="p">]</span> <span class="o">+</span> <span class="n">df_all</span><span class="p">[</span><span class="sh">'</span><span class="s">SibSp</span><span class="sh">'</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">sns</span><span class="p">.</span><span class="nf">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">df_all</span><span class="p">[</span><span class="sh">'</span><span class="s">Family_Size</span><span class="sh">'</span><span class="p">].</span><span class="nf">value_counts</span><span class="p">().</span><span class="n">index</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="n">df_all</span><span class="p">[</span><span class="sh">'</span><span class="s">Family_Size</span><span class="sh">'</span><span class="p">].</span><span class="nf">value_counts</span><span class="p">(),</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">set_title</span><span class="p">(</span><span class="sh">"</span><span class="s">Family Size Distribution</span><span class="sh">"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">sns</span><span class="p">.</span><span class="nf">countplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="sh">'</span><span class="s">Family_Size</span><span class="sh">'</span><span class="p">,</span>
              <span class="n">hue</span><span class="o">=</span><span class="sh">'</span><span class="s">Survived</span><span class="sh">'</span><span class="p">,</span>
              <span class="n">data</span><span class="o">=</span><span class="n">df_all</span><span class="p">,</span>
              <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
              <span class="n">palette</span><span class="o">=</span><span class="n">sns</span><span class="p">.</span><span class="nf">diverging_palette</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nf">legend</span><span class="p">([</span><span class="sh">'</span><span class="s">Not Survived</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Survived</span><span class="sh">'</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="sh">'</span><span class="s">upper right</span><span class="sh">'</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nf">set_title</span><span class="p">(</span><span class="sh">"</span><span class="s">Survival Rate based on Family Size</span><span class="sh">"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Text(0.5, 1.0, 'Survival Rate based on Family Size')
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2020-02-02-Titanic/output_125_1.png" />
</figure>

<p>As shown above, single individual tend to die more than families of 2, 3, and 4 individuals. However, larger families suffer more casualties.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># group family sizes
</span><span class="n">family_map</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">1</span><span class="p">:</span> <span class="sh">'</span><span class="s">Alone</span><span class="sh">'</span><span class="p">,</span>
    <span class="mi">2</span><span class="p">:</span> <span class="sh">'</span><span class="s">Small</span><span class="sh">'</span><span class="p">,</span>
    <span class="mi">3</span><span class="p">:</span> <span class="sh">'</span><span class="s">Small</span><span class="sh">'</span><span class="p">,</span>
    <span class="mi">4</span><span class="p">:</span> <span class="sh">'</span><span class="s">Small</span><span class="sh">'</span><span class="p">,</span>
    <span class="mi">5</span><span class="p">:</span> <span class="sh">'</span><span class="s">Medium</span><span class="sh">'</span><span class="p">,</span>
    <span class="mi">6</span><span class="p">:</span> <span class="sh">'</span><span class="s">Medium</span><span class="sh">'</span><span class="p">,</span>
    <span class="mi">7</span><span class="p">:</span> <span class="sh">'</span><span class="s">Large</span><span class="sh">'</span><span class="p">,</span>
    <span class="mi">8</span><span class="p">:</span> <span class="sh">'</span><span class="s">Large</span><span class="sh">'</span><span class="p">,</span>
    <span class="mi">11</span><span class="p">:</span> <span class="sh">'</span><span class="s">Large</span><span class="sh">'</span>
<span class="p">}</span>

<span class="n">df_all</span><span class="p">[</span><span class="sh">'</span><span class="s">Family_Size_Grp</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_all</span><span class="p">[</span><span class="sh">'</span><span class="s">Family_Size</span><span class="sh">'</span><span class="p">].</span><span class="nf">map</span><span class="p">(</span><span class="n">family_map</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">sns</span><span class="p">.</span><span class="nf">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">df_all</span><span class="p">[</span><span class="sh">'</span><span class="s">Family_Size_Grp</span><span class="sh">'</span><span class="p">].</span><span class="nf">value_counts</span><span class="p">().</span><span class="n">index</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="n">df_all</span><span class="p">[</span><span class="sh">'</span><span class="s">Family_Size_Grp</span><span class="sh">'</span><span class="p">].</span><span class="nf">value_counts</span><span class="p">(),</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">set_title</span><span class="p">(</span><span class="sh">"</span><span class="s">Family Size Distribution</span><span class="sh">"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">sns</span><span class="p">.</span><span class="nf">countplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="sh">'</span><span class="s">Family_Size_Grp</span><span class="sh">'</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="sh">'</span><span class="s">Survived</span><span class="sh">'</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_all</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">palette</span><span class="o">=</span><span class="n">sns</span><span class="p">.</span><span class="nf">diverging_palette</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nf">legend</span><span class="p">([</span><span class="sh">'</span><span class="s">Not Survived</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Survived</span><span class="sh">'</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="sh">'</span><span class="s">upper right</span><span class="sh">'</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nf">set_title</span><span class="p">(</span><span class="sh">"</span><span class="s">Survival Rate based on Family Size</span><span class="sh">"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">);</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2020-02-02-Titanic/output_128_0.png" />
</figure>

<p>Based on our observations, we have grouped the family sizes into four groups. However, this new feature does not account for people not related but traveling in groups.</p>

<p><a id="Section_63"></a></p>
<h3 id="63-tickets">6.3 Tickets</h3>

<p>We have not used the ticket id yet, If we simply try to group them, maybe we can obtain something interesting.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df_all</span><span class="p">.</span><span class="nf">groupby</span><span class="p">(</span><span class="sh">'</span><span class="s">Ticket</span><span class="sh">'</span><span class="p">).</span><span class="nf">size</span><span class="p">().</span><span class="nf">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Ticket
CA. 2343        11
1601             8
CA 2144          8
S.O.C. 14879     7
PC 17608         7
                ..
349248           1
349247           1
349246           1
349245           1
345769           1
Length: 929, dtype: int64
</code></pre></div></div>

<p>Indeed, the ticket seemed to have been assigned to groups of people rather than being unique. Let’s replace the actual tickets id as they do not see to contain a pattern.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df_all</span><span class="p">[</span><span class="sh">'</span><span class="s">Ticket_Frequency</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_all</span><span class="p">.</span><span class="nf">groupby</span><span class="p">(</span><span class="sh">'</span><span class="s">Ticket</span><span class="sh">'</span><span class="p">)[</span><span class="sh">'</span><span class="s">Ticket</span><span class="sh">'</span><span class="p">].</span><span class="nf">transform</span><span class="p">(</span><span class="sh">'</span><span class="s">count</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">sns</span><span class="p">.</span><span class="nf">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">df_all</span><span class="p">[</span><span class="sh">'</span><span class="s">Ticket_Frequency</span><span class="sh">'</span><span class="p">].</span><span class="nf">value_counts</span><span class="p">().</span><span class="n">index</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="n">df_all</span><span class="p">[</span><span class="sh">'</span><span class="s">Ticket_Frequency</span><span class="sh">'</span><span class="p">].</span><span class="nf">value_counts</span><span class="p">(),</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">set_title</span><span class="p">(</span><span class="sh">"</span><span class="s">Ticket Frequency Distribution</span><span class="sh">"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">sns</span><span class="p">.</span><span class="nf">countplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="sh">'</span><span class="s">Ticket_Frequency</span><span class="sh">'</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="sh">'</span><span class="s">Survived</span><span class="sh">'</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_all</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">palette</span><span class="o">=</span><span class="n">sns</span><span class="p">.</span><span class="nf">diverging_palette</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nf">legend</span><span class="p">([</span><span class="sh">'</span><span class="s">Not Survived</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Survived</span><span class="sh">'</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="sh">'</span><span class="s">upper right</span><span class="sh">'</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nf">set_title</span><span class="p">(</span><span class="sh">"</span><span class="s">Survival Rate based on  Ticket Frequency</span><span class="sh">"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">);</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2020-02-02-Titanic/output_135_0.png" />
</figure>

<p>Similar to the family size, single individual tend to die more than families of 2, 3, and 4 individuals. However, larger families suffer more casualties.</p>

<p><a id="Section_64"></a></p>
<h3 id="64-family-survival-rates">6.4 Family Survival Rates</h3>

<p>Based on the passenger last names, we can construct statistics related to individual families.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df_all</span><span class="p">[</span><span class="sh">'</span><span class="s">Last_Name</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_all</span><span class="p">[</span><span class="sh">'</span><span class="s">Name</span><span class="sh">'</span><span class="p">].</span><span class="nb">str</span><span class="p">.</span><span class="nf">extract</span><span class="p">(</span><span class="sa">r</span><span class="sh">'</span><span class="s">^([a-zA-Z\s\-\']+)\,*</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div>

<p>If we want to compute the survival rate per family, we need to restrain our dataset to the training set since the test set does not contained the target feature.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df_train</span><span class="p">,</span> <span class="n">df_test</span> <span class="o">=</span> <span class="nf">divide_df</span><span class="p">(</span><span class="n">df_all</span><span class="p">)</span>
</code></pre></div></div>

<p>In order to generate our new features, we need to perform the following steps:</p>
<ol>
  <li>Find last names present in both the training and test sets.</li>
  <li>Compute median survival rate for each ticket and family.</li>
  <li>Save survival rates for families present in both test with more that one member. Same for tickets.</li>
  <li>Combine ticket and family survival rates</li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 1. families and tickets occuring in both sets
</span><span class="n">non_unique_families</span> <span class="o">=</span> <span class="n">df_train</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_train</span><span class="p">[</span><span class="sh">'</span><span class="s">Last_Name</span><span class="sh">'</span><span class="p">].</span><span class="nf">isin</span><span class="p">(</span><span class="n">df_test</span><span class="p">[</span><span class="sh">'</span><span class="s">Last_Name</span><span class="sh">'</span><span class="p">].</span><span class="nf">unique</span><span class="p">()),</span> <span class="sh">'</span><span class="s">Last_Name</span><span class="sh">'</span><span class="p">]</span>
<span class="n">non_unique_tickets</span> <span class="o">=</span> <span class="n">df_train</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_train</span><span class="p">[</span><span class="sh">'</span><span class="s">Ticket</span><span class="sh">'</span><span class="p">].</span><span class="nf">isin</span><span class="p">(</span><span class="n">df_test</span><span class="p">[</span><span class="sh">'</span><span class="s">Ticket</span><span class="sh">'</span><span class="p">].</span><span class="nf">unique</span><span class="p">()),</span> <span class="sh">'</span><span class="s">Ticket</span><span class="sh">'</span><span class="p">]</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 2. compute median survival rate and size for each ticket and family
</span><span class="n">df_family</span> <span class="o">=</span> <span class="n">df_train</span><span class="p">.</span><span class="nf">groupby</span><span class="p">(</span><span class="sh">'</span><span class="s">Last_Name</span><span class="sh">'</span><span class="p">).</span><span class="nf">median</span><span class="p">()[[</span><span class="sh">'</span><span class="s">Survived</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Family_Size</span><span class="sh">'</span><span class="p">]]</span>
<span class="n">df_ticket</span> <span class="o">=</span> <span class="n">df_train</span><span class="p">.</span><span class="nf">groupby</span><span class="p">(</span><span class="sh">'</span><span class="s">Ticket</span><span class="sh">'</span><span class="p">).</span><span class="nf">median</span><span class="p">()[[</span><span class="sh">'</span><span class="s">Survived</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Ticket_Frequency</span><span class="sh">'</span><span class="p">]]</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 3. filter families with more that one member and present in both the train and test sets
</span><span class="n">df_family</span> <span class="o">=</span> <span class="n">df_family</span><span class="p">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df_family</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="nf">isin</span><span class="p">(</span><span class="n">non_unique_families</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_family</span><span class="p">[</span><span class="sh">'</span><span class="s">Family_Size</span><span class="sh">'</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)][[</span><span class="sh">'</span><span class="s">Survived</span><span class="sh">'</span><span class="p">]]</span>
<span class="n">df_ticket</span> <span class="o">=</span> <span class="n">df_ticket</span><span class="p">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df_ticket</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="nf">isin</span><span class="p">(</span><span class="n">non_unique_tickets</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_ticket</span><span class="p">[</span><span class="sh">'</span><span class="s">Ticket_Frequency</span><span class="sh">'</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)][[</span><span class="sh">'</span><span class="s">Survived</span><span class="sh">'</span><span class="p">]]</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 3. compute mean survival rate
</span><span class="n">mean_survival_rate</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">df_train</span><span class="p">[</span><span class="sh">'</span><span class="s">Survived</span><span class="sh">'</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 3.
# assign family survival rate to each passenger, same for tickets
</span><span class="n">df_train</span> <span class="o">=</span> <span class="n">df_train</span><span class="p">.</span><span class="nf">merge</span><span class="p">(</span><span class="n">right</span><span class="o">=</span><span class="n">df_family</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="sh">'</span><span class="s">left</span><span class="sh">'</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="sh">'</span><span class="s">Last_Name</span><span class="sh">'</span><span class="p">,</span><span class="n">right_index</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="sh">''</span><span class="p">,</span> <span class="sh">'</span><span class="s">_y</span><span class="sh">'</span><span class="p">))</span>
<span class="n">df_train</span> <span class="o">=</span> <span class="n">df_train</span><span class="p">.</span><span class="nf">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="sh">"</span><span class="s">Survived_y</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Family_Survival</span><span class="sh">"</span><span class="p">})</span>
<span class="n">df_train</span> <span class="o">=</span> <span class="n">df_train</span><span class="p">.</span><span class="nf">merge</span><span class="p">(</span><span class="n">right</span><span class="o">=</span><span class="n">df_ticket</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="sh">'</span><span class="s">left</span><span class="sh">'</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="sh">'</span><span class="s">Ticket</span><span class="sh">'</span><span class="p">,</span><span class="n">right_index</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="sh">''</span><span class="p">,</span> <span class="sh">'</span><span class="s">_y</span><span class="sh">'</span><span class="p">))</span>
<span class="n">df_train</span> <span class="o">=</span> <span class="n">df_train</span><span class="p">.</span><span class="nf">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="sh">"</span><span class="s">Survived_y</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Ticket_Survival</span><span class="sh">"</span><span class="p">})</span>

<span class="n">df_test</span> <span class="o">=</span> <span class="n">df_test</span><span class="p">.</span><span class="nf">merge</span><span class="p">(</span><span class="n">right</span><span class="o">=</span><span class="n">df_family</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="sh">'</span><span class="s">left</span><span class="sh">'</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="sh">'</span><span class="s">Last_Name</span><span class="sh">'</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="sh">''</span><span class="p">,</span> <span class="sh">'</span><span class="s">_y</span><span class="sh">'</span><span class="p">))</span>
<span class="n">df_test</span> <span class="o">=</span> <span class="n">df_test</span><span class="p">.</span><span class="nf">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="sh">"</span><span class="s">Survived</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Family_Survival</span><span class="sh">"</span><span class="p">})</span>
<span class="n">df_test</span> <span class="o">=</span> <span class="n">df_test</span><span class="p">.</span><span class="nf">merge</span><span class="p">(</span><span class="n">right</span><span class="o">=</span><span class="n">df_ticket</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="sh">'</span><span class="s">left</span><span class="sh">'</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="sh">'</span><span class="s">Ticket</span><span class="sh">'</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="sh">''</span><span class="p">,</span> <span class="sh">'</span><span class="s">_y</span><span class="sh">'</span><span class="p">))</span>
<span class="n">df_test</span> <span class="o">=</span> <span class="n">df_test</span><span class="p">.</span><span class="nf">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="sh">"</span><span class="s">Survived</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Ticket_Survival</span><span class="sh">"</span><span class="p">})</span>

<span class="c1"># new feature to determine if a family has a family-based survival rate, same for tickets
</span><span class="n">df_train</span><span class="p">[</span><span class="sh">'</span><span class="s">Has_Family_Survival</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">~</span><span class="n">df_train</span><span class="p">[</span><span class="sh">'</span><span class="s">Family_Survival</span><span class="sh">'</span><span class="p">].</span><span class="nf">isnull</span><span class="p">()).</span><span class="nf">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">df_test</span><span class="p">[</span><span class="sh">'</span><span class="s">Has_Family_Survival</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">~</span><span class="n">df_test</span><span class="p">[</span><span class="sh">'</span><span class="s">Family_Survival</span><span class="sh">'</span><span class="p">].</span><span class="nf">isnull</span><span class="p">()).</span><span class="nf">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">df_train</span><span class="p">[</span><span class="sh">'</span><span class="s">Has_Ticket_Survival</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">~</span><span class="n">df_train</span><span class="p">[</span><span class="sh">'</span><span class="s">Ticket_Survival</span><span class="sh">'</span><span class="p">].</span><span class="nf">isnull</span><span class="p">()).</span><span class="nf">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">df_test</span><span class="p">[</span><span class="sh">'</span><span class="s">Has_Ticket_Survival</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">~</span><span class="n">df_test</span><span class="p">[</span><span class="sh">'</span><span class="s">Ticket_Survival</span><span class="sh">'</span><span class="p">].</span><span class="nf">isnull</span><span class="p">()).</span><span class="nf">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
     
<span class="c1"># fill null with mean survival rate, same for tickets
</span><span class="n">df_train</span><span class="p">[</span><span class="sh">'</span><span class="s">Family_Survival</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_train</span><span class="p">[</span><span class="sh">'</span><span class="s">Family_Survival</span><span class="sh">'</span><span class="p">].</span><span class="nf">fillna</span><span class="p">(</span><span class="n">mean_survival_rate</span><span class="p">)</span>
<span class="n">df_test</span><span class="p">[</span><span class="sh">'</span><span class="s">Family_Survival</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_test</span><span class="p">[</span><span class="sh">'</span><span class="s">Family_Survival</span><span class="sh">'</span><span class="p">].</span><span class="nf">fillna</span><span class="p">(</span><span class="n">mean_survival_rate</span><span class="p">)</span>
<span class="n">df_train</span><span class="p">[</span><span class="sh">'</span><span class="s">Ticket_Survival</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_train</span><span class="p">[</span><span class="sh">'</span><span class="s">Ticket_Survival</span><span class="sh">'</span><span class="p">].</span><span class="nf">fillna</span><span class="p">(</span><span class="n">mean_survival_rate</span><span class="p">)</span>
<span class="n">df_test</span><span class="p">[</span><span class="sh">'</span><span class="s">Ticket_Survival</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_test</span><span class="p">[</span><span class="sh">'</span><span class="s">Ticket_Survival</span><span class="sh">'</span><span class="p">].</span><span class="nf">fillna</span><span class="p">(</span><span class="n">mean_survival_rate</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 4. Combine survival rates (Family and Ticket)
</span><span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="p">[</span><span class="n">df_train</span><span class="p">,</span> <span class="n">df_test</span><span class="p">]:</span>
    <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">Survival_Rate</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">Ticket_Survival</span><span class="sh">'</span><span class="p">]</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">Family_Survival</span><span class="sh">'</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">Has_Survival</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">Has_Ticket_Survival</span><span class="sh">'</span><span class="p">]</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">Has_Family_Survival</span><span class="sh">'</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>  
</code></pre></div></div>

<p><a id="Section_65"></a></p>
<h3 id="65-fare-binning">6.5 Fare Binning</h3>

<p>In order to improve our predictions on unseen data, it is common to bin continuous features. Therefore, we bin the fare using quantiles. We select a number of bins with the intent to create bins as pure as possible.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df_all</span> <span class="o">=</span> <span class="nf">concat_df</span><span class="p">(</span><span class="n">df_train</span><span class="p">,</span> <span class="n">df_test</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df_all</span><span class="p">[</span><span class="sh">'</span><span class="s">Fare_Bin</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">qcut</span><span class="p">(</span><span class="n">df_all</span><span class="p">[</span><span class="sh">'</span><span class="s">Fare</span><span class="sh">'</span><span class="p">],</span> <span class="mi">13</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="p">.</span><span class="nf">countplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="sh">'</span><span class="s">Fare_Bin</span><span class="sh">'</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="sh">'</span><span class="s">Survived</span><span class="sh">'</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_all</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="n">sns</span><span class="p">.</span><span class="nf">diverging_palette</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>

<span class="n">plt</span><span class="p">.</span><span class="nf">xlabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Fare Bins</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">ylabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Passenger Count</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">legend</span><span class="p">([</span><span class="sh">'</span><span class="s">Not Survived</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Survived</span><span class="sh">'</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="sh">'</span><span class="s">upper right</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">title</span><span class="p">(</span><span class="sh">'</span><span class="s">Count of Survival in {} Feature</span><span class="sh">'</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">'</span><span class="s">Fare Bin</span><span class="sh">'</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">tight_layout</span><span class="p">()</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2020-02-02-Titanic/output_153_0.png" />
</figure>

<p><a id="Section_66"></a></p>
<h3 id="66-age-binning">6.6 Age Binning</h3>

<p>Similar to the Fare feature, we bin the age feature.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df_all</span><span class="p">[</span><span class="sh">'</span><span class="s">Age_Bin</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">qcut</span><span class="p">(</span><span class="n">df_all</span><span class="p">[</span><span class="sh">'</span><span class="s">Age</span><span class="sh">'</span><span class="p">],</span> <span class="mi">10</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="p">.</span><span class="nf">countplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="sh">'</span><span class="s">Age_Bin</span><span class="sh">'</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="sh">'</span><span class="s">Survived</span><span class="sh">'</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_all</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="n">sns</span><span class="p">.</span><span class="nf">diverging_palette</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>

<span class="n">plt</span><span class="p">.</span><span class="nf">xlabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Age Bins</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">ylabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Passenger Count</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">legend</span><span class="p">([</span><span class="sh">'</span><span class="s">Not Survived</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Survived</span><span class="sh">'</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="sh">'</span><span class="s">upper right</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">title</span><span class="p">(</span><span class="sh">'</span><span class="s">Count of Survival in {} Feature</span><span class="sh">'</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">'</span><span class="s">Age Bin</span><span class="sh">'</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">tight_layout</span><span class="p">()</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2020-02-02-Titanic/output_157_0.png" />
</figure>

<p><a id="Section_67"></a></p>
<h3 id="67-encoding">6.7 Encoding</h3>
<p>In order for our model to interpret categorical and non-numerical features, we need to generate new feature for each possible label.</p>

<p>The following features need to be encoded:</p>
<ol>
  <li>Embarked</li>
  <li>Sex</li>
  <li>Deck</li>
  <li>Family_Size_Grp</li>
  <li>Age_Bin</li>
  <li>Fare_Bin</li>
  <li>Title</li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df_train</span><span class="p">,</span> <span class="n">df_test</span> <span class="o">=</span> <span class="nf">divide_df</span><span class="p">(</span><span class="n">df_all</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># features to be encoded
</span><span class="n">encoding</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">Embarked</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Sex</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Deck</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Family_Size_Grp</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Age_Bin</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Fare_Bin</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Title</span><span class="sh">'</span><span class="p">]</span>

<span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">encoding</span><span class="p">:</span>
    <span class="n">encoder</span> <span class="o">=</span> <span class="nc">LabelEncoder</span><span class="p">()</span>
    <span class="n">df_train</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span> <span class="o">=</span> <span class="n">encoder</span><span class="p">.</span><span class="nf">fit_transform</span><span class="p">(</span><span class="n">df_train</span><span class="p">[</span><span class="n">feature</span><span class="p">])</span>
    <span class="n">df_test</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span> <span class="o">=</span> <span class="n">encoder</span><span class="p">.</span><span class="nf">transform</span><span class="p">(</span><span class="n">df_test</span><span class="p">[</span><span class="n">feature</span><span class="p">])</span>
</code></pre></div></div>

<p>Once the features have been encoded, we can create dummies.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dummies</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">Pclass</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Sex</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Deck</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Embarked</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Title</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Family_Size_Grp</span><span class="sh">'</span><span class="p">]</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df_train</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">get_dummies</span><span class="p">(</span><span class="n">df_train</span><span class="p">,</span> <span class="n">prefix_sep</span><span class="o">=</span><span class="sh">'</span><span class="s">_</span><span class="sh">'</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">dummies</span><span class="p">,</span> <span class="n">drop_first</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">df_test</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">get_dummies</span><span class="p">(</span><span class="n">df_test</span><span class="p">,</span> <span class="n">prefix_sep</span><span class="o">=</span><span class="sh">'</span><span class="s">_</span><span class="sh">'</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">dummies</span><span class="p">,</span> <span class="n">drop_first</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</code></pre></div></div>

<p>Finally, we can drop several columns that we do not need.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df_all</span> <span class="o">=</span> <span class="nf">concat_df</span><span class="p">(</span><span class="n">df_train</span><span class="p">,</span> <span class="n">df_test</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">drop_columns</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">Family_Size</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Survived</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Name</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Parch</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Last_Name</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">PassengerId</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">SibSp</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">Ticket</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Ticket_Survival</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Family_Survival</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Has_Family_Survival</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Has_Ticket_Survival</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">Age</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Fare</span><span class="sh">'</span><span class="p">]</span>

<span class="n">drop_columns_test</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">Family_Size</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Name</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Parch</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Last_Name</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">PassengerId</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">SibSp</span><span class="sh">'</span><span class="p">,</span>
                     <span class="sh">'</span><span class="s">Ticket</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Ticket_Survival</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Family_Survival</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Has_Family_Survival</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Has_Ticket_Survival</span><span class="sh">'</span><span class="p">,</span>
                     <span class="sh">'</span><span class="s">Age</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Fare</span><span class="sh">'</span><span class="p">]</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df_all</span> <span class="o">=</span> <span class="n">df_all</span><span class="p">.</span><span class="nf">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">drop_columns</span><span class="p">)</span>
<span class="n">df_all</span><span class="p">.</span><span class="nf">head</span><span class="p">()</span>
</code></pre></div></div>

<div style="overflow-x:auto;">
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Age_Bin</th>
      <th>Deck_0</th>
      <th>Deck_1</th>
      <th>Deck_2</th>
      <th>Deck_3</th>
      <th>Embarked_0</th>
      <th>Embarked_1</th>
      <th>Embarked_2</th>
      <th>Family_Size_Grp_0</th>
      <th>Family_Size_Grp_1</th>
      <th>...</th>
      <th>Pclass_2</th>
      <th>Pclass_3</th>
      <th>Sex_0</th>
      <th>Sex_1</th>
      <th>Survival_Rate</th>
      <th>Ticket_Frequency</th>
      <th>Title_0</th>
      <th>Title_1</th>
      <th>Title_2</th>
      <th>Title_3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0.383838</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>7</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1.000000</td>
      <td>2</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>4</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0.383838</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>7</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0.383838</td>
      <td>2</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>7</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0.383838</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 26 columns</p>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df_all</span><span class="p">.</span><span class="n">columns</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Index(['Age_Bin', 'Deck_0', 'Deck_1', 'Deck_2', 'Deck_3', 'Embarked_0',
       'Embarked_1', 'Embarked_2', 'Family_Size_Grp_0', 'Family_Size_Grp_1',
       'Family_Size_Grp_2', 'Family_Size_Grp_3', 'Fare_Bin', 'Has_Survival',
       'Is_Married', 'Pclass_1', 'Pclass_2', 'Pclass_3', 'Sex_0', 'Sex_1',
       'Survival_Rate', 'Ticket_Frequency', 'Title_0', 'Title_1', 'Title_2',
       'Title_3'],
      dtype='object')
</code></pre></div></div>

<hr />
<p><a id="Section_7"></a></p>
<h2 id="7-model-preparation">7. Model Preparation</h2>

<p>We will now prepare the data before creating a model. The preparation is divided into three steps:</p>
<ol>
  <li>Separate the dataframe into our input data and our output feature (X and y).</li>
  <li>Normalize the data</li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">X_train</span> <span class="o">=</span> <span class="nc">StandardScaler</span><span class="p">().</span><span class="nf">fit_transform</span><span class="p">(</span><span class="n">df_train</span><span class="p">.</span><span class="nf">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">drop_columns</span><span class="p">))</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">df_train</span><span class="p">[</span><span class="sh">'</span><span class="s">Survived</span><span class="sh">'</span><span class="p">].</span><span class="n">values</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="nc">StandardScaler</span><span class="p">().</span><span class="nf">fit_transform</span><span class="p">(</span><span class="n">df_test</span><span class="p">.</span><span class="nf">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">drop_columns_test</span><span class="p">))</span>

<span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">X_train shape: {}</span><span class="sh">'</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">X_train</span><span class="p">.</span><span class="n">shape</span><span class="p">))</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">y_train shape: {}</span><span class="sh">'</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">y_train</span><span class="p">.</span><span class="n">shape</span><span class="p">))</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">X_test shape: {}</span><span class="sh">'</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">X_test</span><span class="p">.</span><span class="n">shape</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>X_train shape: (891, 26)
y_train shape: (891,)
X_test shape: (418, 26)
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># PCA
</span><span class="n">pca</span> <span class="o">=</span> <span class="nc">PCA</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">X_pca</span> <span class="o">=</span> <span class="n">pca</span><span class="p">.</span><span class="nf">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">cumsum</span><span class="p">(</span><span class="n">pca</span><span class="p">.</span><span class="n">explained_variance_ratio_</span><span class="p">))</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">set_xlabel</span><span class="p">(</span><span class="sh">"</span><span class="s">Component</span><span class="sh">"</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">set_ylabel</span><span class="p">(</span><span class="sh">"</span><span class="s">Percent of Explained Variance</span><span class="sh">"</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">set_title</span><span class="p">(</span><span class="sh">"</span><span class="s">Cumulative Variance</span><span class="sh">"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">pca</span><span class="p">.</span><span class="n">n_components_</span><span class="p">);</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2020-02-02-Titanic/output_174_0.png" />
</figure>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">16</span><span class="p">))</span>
<span class="n">cmap</span> <span class="o">=</span> <span class="n">sns</span><span class="p">.</span><span class="nf">diverging_palette</span><span class="p">(</span><span class="mi">220</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">as_cmap</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">cset</span> <span class="o">=</span> <span class="n">ax</span><span class="p">.</span><span class="nf">imshow</span><span class="p">(</span>
    <span class="n">pca</span><span class="p">.</span><span class="n">components_</span><span class="p">.</span><span class="n">T</span><span class="p">,</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">,</span>
    <span class="n">vmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">ylabels</span> <span class="o">=</span> <span class="n">df_train</span><span class="p">.</span><span class="nf">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">drop_columns</span><span class="p">).</span><span class="n">columns</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="nf">tolist</span><span class="p">()</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">ylabels</span><span class="p">)))</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">set_yticklabels</span><span class="p">(</span><span class="n">ylabels</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="nf">len</span><span class="p">(</span><span class="n">ylabels</span><span class="p">)</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">set_xticks</span><span class="p">(</span><span class="nf">range</span><span class="p">(</span><span class="n">pca</span><span class="p">.</span><span class="n">n_components_</span><span class="p">))</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">grid</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">set_xlabel</span><span class="p">(</span><span class="sh">"</span><span class="s">Principal Component</span><span class="sh">"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">set_ylabel</span><span class="p">(</span><span class="sh">"</span><span class="s">Contribution</span><span class="sh">"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">set_title</span><span class="p">(</span><span class="sh">"</span><span class="s">Contribution of Features to Components</span><span class="sh">"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">fig</span><span class="p">.</span><span class="nf">colorbar</span><span class="p">(</span><span class="n">cset</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">tight_layout</span><span class="p">();</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2020-02-02-Titanic/output_175_0.png" />
</figure>

<hr />
<p><a id="Section_8"></a></p>
<h2 id="8-models">8. Models</h2>

<p>In this section, we will make predictions using the following models:</p>
<ul>
  <li>RandomForestClassifier</li>
  <li>ExtraTreesClassifier</li>
  <li>LogisticRegression</li>
  <li>GradientBoostingClassifier</li>
  <li>LinearDiscriminantAnalysis</li>
  <li>RidgeClassifier</li>
  <li>XGBClassifier</li>
  <li>MLPClassifier</li>
  <li>BaggingClassifier</li>
  <li>BernoulliNB</li>
  <li>ExtraTreeClassifier</li>
  <li>DecisionTreeClassifier</li>
  <li>LinearSVC</li>
  <li>AdaBoostClassifier</li>
  <li>SVC</li>
  <li>NuSVC</li>
  <li>SGDClassifier</li>
  <li>Perceptron</li>
  <li>GaussianProcessClassifier</li>
  <li>KNeighborsClassifier</li>
  <li>GaussianNB</li>
  <li>PassiveAggressiveClassifier</li>
  <li>QuadraticDiscriminantAnalysis</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Cross validate model with Kfold stratified cross val
</span><span class="n">kfold</span> <span class="o">=</span> <span class="nc">StratifiedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">random_state</span> <span class="o">=</span> <span class="mi">42</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># classifiers
</span><span class="n">classifiers_list</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1">#Ensemble Methods
</span>    <span class="nc">AdaBoostClassifier</span><span class="p">(</span><span class="nc">AdaBoostClassifier</span><span class="p">(</span><span class="nc">DecisionTreeClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">),</span><span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)),</span>
    <span class="nc">BaggingClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">),</span>
    <span class="nc">ExtraTreesClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">),</span>
    <span class="nc">GradientBoostingClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">),</span>
    <span class="nc">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">),</span>

    <span class="c1">#Gaussian Processes
</span>    <span class="nc">GaussianProcessClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">),</span>
    
    <span class="c1">#GLM
</span>    <span class="nc">LogisticRegression</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">),</span>
    <span class="nc">PassiveAggressiveClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">),</span>
    <span class="nc">RidgeClassifier</span><span class="p">(),</span>
    <span class="nc">SGDClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">),</span>
    <span class="nc">Perceptron</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">),</span>
    <span class="nc">MLPClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">),</span>
    
    <span class="c1">#Navies Bayes
</span>    <span class="nc">BernoulliNB</span><span class="p">(),</span>
    <span class="nc">GaussianNB</span><span class="p">(),</span>
    
    <span class="c1">#Nearest Neighbor
</span>    <span class="nc">KNeighborsClassifier</span><span class="p">(),</span>
    
    <span class="c1">#SVM
</span>    <span class="nc">SVC</span><span class="p">(</span><span class="n">probability</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">),</span>
    <span class="nc">NuSVC</span><span class="p">(</span><span class="n">probability</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">),</span>
    <span class="nc">LinearSVC</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">),</span>
    
    <span class="c1">#Trees    
</span>    <span class="nc">DecisionTreeClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">),</span>
    <span class="nc">ExtraTreeClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">),</span>
    
    <span class="c1">#Discriminant Analysis
</span>    <span class="nc">LinearDiscriminantAnalysis</span><span class="p">(),</span>
    <span class="nc">QuadraticDiscriminantAnalysis</span><span class="p">(),</span>

    <span class="c1">#xgboost: http://xgboost.readthedocs.io/en/latest/model.html
</span>    <span class="nc">XGBClassifier</span><span class="p">()</span>    
    <span class="p">]</span>

<span class="c1"># store cv results in list
</span><span class="n">cv_results_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">cv_means_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">cv_std_list</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># perform cross-validation
</span><span class="k">for</span> <span class="n">clf</span> <span class="ow">in</span> <span class="nf">tqdm</span><span class="p">(</span><span class="n">classifiers_list</span><span class="p">):</span>
    <span class="n">cv_results_list</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nf">cross_val_score</span><span class="p">(</span><span class="n">clf</span><span class="p">,</span>
                                           <span class="n">X_train</span><span class="p">,</span>
                                           <span class="n">y_train</span><span class="p">,</span>
                                           <span class="n">scoring</span> <span class="o">=</span> <span class="sh">"</span><span class="s">accuracy</span><span class="sh">"</span><span class="p">,</span>
                                           <span class="n">cv</span> <span class="o">=</span> <span class="n">kfold</span><span class="p">,</span>
                                           <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">clf</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">clf</span><span class="p">.</span><span class="nf">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="c1"># store mean and std accuracy
</span><span class="k">for</span> <span class="n">cv_result</span> <span class="ow">in</span> <span class="n">cv_results_list</span><span class="p">:</span>
    <span class="n">cv_means_list</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">cv_result</span><span class="p">.</span><span class="nf">mean</span><span class="p">())</span>
    <span class="n">cv_std_list</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">cv_result</span><span class="p">.</span><span class="nf">std</span><span class="p">())</span>
                      
<span class="n">cv_res_df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">({</span><span class="sh">"</span><span class="s">CrossValMeans</span><span class="sh">"</span><span class="p">:</span><span class="n">cv_means_list</span><span class="p">,</span>
                          <span class="sh">"</span><span class="s">CrossValerrors</span><span class="sh">"</span><span class="p">:</span> <span class="n">cv_std_list</span><span class="p">,</span>
                          <span class="sh">"</span><span class="s">Algorithm</span><span class="sh">"</span><span class="p">:[</span><span class="n">clf</span><span class="p">.</span><span class="n">__class__</span><span class="p">.</span><span class="n">__name__</span> <span class="k">for</span> <span class="n">clf</span> <span class="ow">in</span> <span class="n">classifiers_list</span><span class="p">]})</span>                    

<span class="n">cv_res_df</span> <span class="o">=</span> <span class="n">cv_res_df</span><span class="p">.</span><span class="nf">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="sh">'</span><span class="s">CrossValMeans</span><span class="sh">'</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>             
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>100%|██████████████████████████████████████████████████████████████████████████████████| 23/23 [00:20&lt;00:00,  1.12it/s]
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cv_res_df</span><span class="p">.</span><span class="nf">set_index</span><span class="p">(</span><span class="sh">'</span><span class="s">Algorithm</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div>

<div style="overflow-x:auto;">
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>CrossValMeans</th>
      <th>CrossValerrors</th>
    </tr>
    <tr>
      <th>Algorithm</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>LogisticRegression</th>
      <td>0.853035</td>
      <td>0.035074</td>
    </tr>
    <tr>
      <th>GradientBoostingClassifier</th>
      <td>0.853010</td>
      <td>0.028286</td>
    </tr>
    <tr>
      <th>LinearDiscriminantAnalysis</th>
      <td>0.851893</td>
      <td>0.026919</td>
    </tr>
    <tr>
      <th>RidgeClassifier</th>
      <td>0.851893</td>
      <td>0.026919</td>
    </tr>
    <tr>
      <th>LinearSVC</th>
      <td>0.850781</td>
      <td>0.030352</td>
    </tr>
    <tr>
      <th>MLPClassifier</th>
      <td>0.850769</td>
      <td>0.026927</td>
    </tr>
    <tr>
      <th>XGBClassifier</th>
      <td>0.850769</td>
      <td>0.027849</td>
    </tr>
    <tr>
      <th>NuSVC</th>
      <td>0.840675</td>
      <td>0.028222</td>
    </tr>
    <tr>
      <th>SVC</th>
      <td>0.840669</td>
      <td>0.028718</td>
    </tr>
    <tr>
      <th>SGDClassifier</th>
      <td>0.837261</td>
      <td>0.028204</td>
    </tr>
    <tr>
      <th>GaussianProcessClassifier</th>
      <td>0.835057</td>
      <td>0.026180</td>
    </tr>
    <tr>
      <th>RandomForestClassifier</th>
      <td>0.831674</td>
      <td>0.023097</td>
    </tr>
    <tr>
      <th>KNeighborsClassifier</th>
      <td>0.829452</td>
      <td>0.027523</td>
    </tr>
    <tr>
      <th>BaggingClassifier</th>
      <td>0.823828</td>
      <td>0.026461</td>
    </tr>
    <tr>
      <th>ExtraTreesClassifier</th>
      <td>0.821581</td>
      <td>0.026906</td>
    </tr>
    <tr>
      <th>AdaBoostClassifier</th>
      <td>0.818204</td>
      <td>0.028622</td>
    </tr>
    <tr>
      <th>DecisionTreeClassifier</th>
      <td>0.810345</td>
      <td>0.019053</td>
    </tr>
    <tr>
      <th>GaussianNB</th>
      <td>0.808123</td>
      <td>0.032538</td>
    </tr>
    <tr>
      <th>ExtraTreeClassifier</th>
      <td>0.805850</td>
      <td>0.016329</td>
    </tr>
    <tr>
      <th>BernoulliNB</th>
      <td>0.795750</td>
      <td>0.011812</td>
    </tr>
    <tr>
      <th>Perceptron</th>
      <td>0.766675</td>
      <td>0.060092</td>
    </tr>
    <tr>
      <th>QuadraticDiscriminantAnalysis</th>
      <td>0.754234</td>
      <td>0.024949</td>
    </tr>
    <tr>
      <th>PassiveAggressiveClassifier</th>
      <td>0.727224</td>
      <td>0.068009</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># plot results
</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="p">.</span><span class="nf">barplot</span><span class="p">(</span><span class="sh">"</span><span class="s">CrossValMeans</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">Algorithm</span><span class="sh">"</span><span class="p">,</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">cv_res_df</span><span class="p">,</span>
                <span class="n">palette</span><span class="o">=</span><span class="sh">"</span><span class="s">Set3</span><span class="sh">"</span><span class="p">,</span>
                <span class="n">orient</span> <span class="o">=</span> <span class="sh">"</span><span class="s">h</span><span class="sh">"</span><span class="p">,</span>
                <span class="o">**</span><span class="p">{</span><span class="sh">'</span><span class="s">xerr</span><span class="sh">'</span><span class="p">:</span><span class="n">cv_std_list</span><span class="p">})</span>
<span class="n">g</span><span class="p">.</span><span class="nf">set_xlabel</span><span class="p">(</span><span class="sh">"</span><span class="s">Mean Accuracy</span><span class="sh">"</span><span class="p">)</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="nf">set_title</span><span class="p">(</span><span class="sh">"</span><span class="s">Cross validation scores</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2020-02-02-Titanic/output_181_0.png" />
</figure>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># store best models
</span><span class="n">best_models</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">optimize_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">paramgrid</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="sh">'</span><span class="s">_best</span><span class="sh">'</span><span class="p">,</span>
                  <span class="n">metric</span> <span class="o">=</span> <span class="sh">'</span><span class="s">accuracy</span><span class="sh">'</span><span class="p">,</span> <span class="n">kfold</span><span class="o">=</span><span class="nc">StratifiedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">other_args</span><span class="o">=</span><span class="p">{},</span> <span class="n">print_best</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    
    <span class="c1"># adjust base estimator parameters
</span>    <span class="n">estimator</span> <span class="o">=</span> <span class="nf">model</span><span class="p">(</span><span class="o">**</span><span class="n">other_args</span><span class="p">)</span>
    
    <span class="c1"># create k-fold-based grid-search
</span>    <span class="n">gridsearch</span> <span class="o">=</span> <span class="nc">GridSearchCV</span><span class="p">(</span><span class="n">estimator</span><span class="p">,</span> <span class="n">param_grid</span><span class="o">=</span><span class="n">paramgrid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">kfold</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="n">metric</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    
    <span class="c1"># fit grid search
</span>    <span class="n">gridsearch</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    
    <span class="c1"># store best model
</span>    <span class="n">name</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">__name__</span> <span class="o">+</span> <span class="n">suffix</span>
    <span class="n">best_models</span><span class="p">.</span><span class="nf">append</span><span class="p">((</span><span class="n">name</span><span class="p">,</span> <span class="n">gridsearch</span><span class="p">.</span><span class="n">best_estimator_</span><span class="p">))</span>
    
    <span class="c1"># print (optional)
</span>    <span class="k">if</span> <span class="n">print_best</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">gridsearch</span><span class="p">)</span>
    
    <span class="c1"># display accuracy
</span>    <span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">Best {} model archieves {:.2f}% {}</span><span class="sh">'</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">__name__</span><span class="p">,</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">gridsearch</span><span class="p">.</span><span class="n">best_score_</span><span class="p">,</span> <span class="n">metric</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">'</span><span class="s">max_depth</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span>
    <span class="sh">'</span><span class="s">learning_rate</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.025</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.075</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span>
    <span class="sh">'</span><span class="s">n_estimators</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="mi">500</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">1500</span><span class="p">],</span>
<span class="p">}</span>

<span class="nf">optimize_model</span><span class="p">(</span><span class="n">XGBClassifier</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">paramgrid</span><span class="o">=</span><span class="n">param_grid</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Fitting 5 folds for each of 108 candidates, totalling 540 fits


[Parallel(n_jobs=-1)]: Using backend LokyBackend with 8 concurrent workers.
[Parallel(n_jobs=-1)]: Done  34 tasks      | elapsed:   15.3s
[Parallel(n_jobs=-1)]: Done 184 tasks      | elapsed:  1.3min
[Parallel(n_jobs=-1)]: Done 434 tasks      | elapsed:  2.9min
[Parallel(n_jobs=-1)]: Done 540 out of 540 | elapsed:  3.5min finished


GridSearchCV(cv=StratifiedKFold(n_splits=5, random_state=5, shuffle=True),
             error_score=nan,
             estimator=XGBClassifier(base_score=0.5, booster='gbtree',
                                     colsample_bylevel=1, colsample_bynode=1,
                                     colsample_bytree=1, gamma=0,
                                     learning_rate=0.1, max_delta_step=0,
                                     max_depth=3, min_child_weight=1,
                                     missing=None, n_estimators=100, n_jobs=1,
                                     nthread=None, objective='binary:logistic',
                                     random_state=0, reg_alpha=0, reg_lambda=1,
                                     scale_pos_weight=1, seed=None, silent=None,
                                     subsample=1, verbosity=1),
             iid='deprecated', n_jobs=-1,
             param_grid={'learning_rate': [0.01, 0.025, 0.05, 0.075, 0, 1, 0,
                                           15, 0.2],
                         'max_depth': [3, 5, 6, 7],
                         'n_estimators': [500, 1000, 1500]},
             pre_dispatch='2*n_jobs', refit=True, return_train_score=False,
             scoring='accuracy', verbose=1)
Best XGBClassifier model archieves 85.64% accuracy
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">"</span><span class="s">max_depth</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="bp">None</span><span class="p">],</span>
    <span class="sh">"</span><span class="s">max_features</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="sh">'</span><span class="s">auto</span><span class="sh">'</span><span class="p">],</span>
    <span class="sh">"</span><span class="s">min_samples_split</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
    <span class="sh">"</span><span class="s">min_samples_leaf</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
    <span class="sh">"</span><span class="s">bootstrap</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="bp">False</span><span class="p">],</span>
    <span class="sh">"</span><span class="s">n_estimators</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="mi">1500</span><span class="p">,</span> <span class="mi">2000</span><span class="p">],</span>
    <span class="sh">"</span><span class="s">criterion</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="sh">"</span><span class="s">gini</span><span class="sh">"</span><span class="p">]</span>
<span class="p">}</span>

<span class="nf">optimize_model</span><span class="p">(</span><span class="n">ExtraTreesClassifier</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">paramgrid</span><span class="o">=</span><span class="n">param_grid</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Fitting 5 folds for each of 54 candidates, totalling 270 fits


[Parallel(n_jobs=-1)]: Using backend LokyBackend with 8 concurrent workers.
[Parallel(n_jobs=-1)]: Done  34 tasks      | elapsed:   18.5s
[Parallel(n_jobs=-1)]: Done 184 tasks      | elapsed:  1.5min
[Parallel(n_jobs=-1)]: Done 270 out of 270 | elapsed:  2.3min finished


GridSearchCV(cv=StratifiedKFold(n_splits=5, random_state=5, shuffle=True),
             error_score=nan,
             estimator=ExtraTreesClassifier(bootstrap=False, ccp_alpha=0.0,
                                            class_weight=None, criterion='gini',
                                            max_depth=None, max_features='auto',
                                            max_leaf_nodes=None,
                                            max_samples=None,
                                            min_impurity_decrease=0.0,
                                            min_impurity_split=None,
                                            min_samples_leaf=1,
                                            min_samples_split=2,
                                            min_w...
                                            oob_score=False, random_state=None,
                                            verbose=0, warm_start=False),
             iid='deprecated', n_jobs=-1,
             param_grid={'bootstrap': [False], 'criterion': ['gini'],
                         'max_depth': [None], 'max_features': [5, 7, 'auto'],
                         'min_samples_leaf': [4, 5, 6],
                         'min_samples_split': [4, 5, 6],
                         'n_estimators': [1500, 2000]},
             pre_dispatch='2*n_jobs', refit=True, return_train_score=False,
             scoring='accuracy', verbose=1)
Best ExtraTreesClassifier model archieves 83.96% accuracy
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">"</span><span class="s">max_depth</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span>
    <span class="sh">"</span><span class="s">min_samples_split</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
    <span class="sh">"</span><span class="s">min_samples_leaf</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
    <span class="sh">"</span><span class="s">max_features</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="sh">'</span><span class="s">auto</span><span class="sh">'</span><span class="p">],</span>
    <span class="sh">"</span><span class="s">n_estimators</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="mi">1750</span><span class="p">],</span>
    <span class="sh">"</span><span class="s">criterion</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="sh">"</span><span class="s">gini</span><span class="sh">"</span><span class="p">]</span>
<span class="p">}</span>

<span class="nf">optimize_model</span><span class="p">(</span><span class="n">RandomForestClassifier</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">paramgrid</span><span class="o">=</span><span class="n">param_grid</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Fitting 5 folds for each of 81 candidates, totalling 405 fits


[Parallel(n_jobs=-1)]: Using backend LokyBackend with 8 concurrent workers.
[Parallel(n_jobs=-1)]: Done  34 tasks      | elapsed:   29.4s
[Parallel(n_jobs=-1)]: Done 184 tasks      | elapsed:  2.0min
[Parallel(n_jobs=-1)]: Done 405 out of 405 | elapsed:  4.3min finished


GridSearchCV(cv=StratifiedKFold(n_splits=5, random_state=5, shuffle=True),
             error_score=nan,
             estimator=RandomForestClassifier(bootstrap=True, ccp_alpha=0.0,
                                              class_weight=None,
                                              criterion='gini', max_depth=None,
                                              max_features='auto',
                                              max_leaf_nodes=None,
                                              max_samples=None,
                                              min_impurity_decrease=0.0,
                                              min_impurity_split=None,
                                              min_samples_leaf=1,
                                              min_samples_split=2,
                                              min_...
                                              n_estimators=100, n_jobs=None,
                                              oob_score=False,
                                              random_state=None, verbose=0,
                                              warm_start=False),
             iid='deprecated', n_jobs=-1,
             param_grid={'criterion': ['gini'], 'max_depth': [5, 6, 7],
                         'max_features': [5, 7, 'auto'],
                         'min_samples_leaf': [4, 5, 6],
                         'min_samples_split': [4, 5, 6],
                         'n_estimators': [1750]},
             pre_dispatch='2*n_jobs', refit=True, return_train_score=False,
             scoring='accuracy', verbose=1)
Best RandomForestClassifier model archieves 84.74% accuracy
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">'</span><span class="s">kernel</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="sh">'</span><span class="s">rbf</span><span class="sh">'</span><span class="p">],</span>
    <span class="sh">'</span><span class="s">gamma</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.0005</span><span class="p">,</span> <span class="mf">0.0008</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="sh">'</span><span class="s">C</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">500</span><span class="p">]</span>
<span class="p">}</span>

<span class="nf">optimize_model</span><span class="p">(</span><span class="n">SVC</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">paramgrid</span><span class="o">=</span><span class="n">param_grid</span><span class="p">,</span> <span class="n">other_args</span><span class="o">=</span><span class="p">{</span><span class="sh">'</span><span class="s">probability</span><span class="sh">'</span><span class="p">:</span><span class="bp">True</span><span class="p">})</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Fitting 5 folds for each of 63 candidates, totalling 315 fits


[Parallel(n_jobs=-1)]: Using backend LokyBackend with 8 concurrent workers.
[Parallel(n_jobs=-1)]: Done  52 tasks      | elapsed:    0.8s
[Parallel(n_jobs=-1)]: Done 300 out of 315 | elapsed:    9.5s remaining:    0.4s


GridSearchCV(cv=StratifiedKFold(n_splits=5, random_state=5, shuffle=True),
             error_score=nan,
             estimator=SVC(C=1.0, break_ties=False, cache_size=200,
                           class_weight=None, coef0=0.0,
                           decision_function_shape='ovr', degree=3,
                           gamma='scale', kernel='rbf', max_iter=-1,
                           probability=True, random_state=None, shrinking=True,
                           tol=0.001, verbose=False),
             iid='deprecated', n_jobs=-1,
             param_grid={'C': [1, 10, 50, 100, 200, 250, 500],
                         'gamma': [0.0005, 0.0008, 0.001, 0.005, 0.01, 0.05,
                                   0.1, 0.5, 1],
                         'kernel': ['rbf']},
             pre_dispatch='2*n_jobs', refit=True, return_train_score=False,
             scoring='accuracy', verbose=1)
Best SVC model archieves 85.42% accuracy


[Parallel(n_jobs=-1)]: Done 315 out of 315 | elapsed:   10.2s finished
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="sh">"</span><span class="s">C</span><span class="sh">"</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="nf">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">40</span><span class="p">),</span> <span class="sh">"</span><span class="s">penalty</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="sh">"</span><span class="s">l1</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">l2</span><span class="sh">"</span><span class="p">]}</span>

<span class="nf">optimize_model</span><span class="p">(</span><span class="n">LogisticRegression</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">paramgrid</span><span class="o">=</span><span class="n">param_grid</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Fitting 5 folds for each of 80 candidates, totalling 400 fits


[Parallel(n_jobs=-1)]: Using backend LokyBackend with 8 concurrent workers.
[Parallel(n_jobs=-1)]: Done  56 tasks      | elapsed:    0.0s


GridSearchCV(cv=StratifiedKFold(n_splits=5, random_state=5, shuffle=True),
             error_score=nan,
             estimator=LogisticRegression(C=1.0, class_weight=None, dual=False,
                                          fit_intercept=True,
                                          intercept_scaling=1, l1_ratio=None,
                                          max_iter=100, multi_class='auto',
                                          n_jobs=None, penalty='l2',
                                          random_state=None, solver='lbfgs',
                                          tol=0.0001, verbose=0,
                                          warm_start=False),
             iid='deprecated'...
       4.92388263e+00, 7.01703829e+00, 1.00000000e+01, 1.42510267e+01,
       2.03091762e+01, 2.89426612e+01, 4.12462638e+01, 5.87801607e+01,
       8.37677640e+01, 1.19377664e+02, 1.70125428e+02, 2.42446202e+02,
       3.45510729e+02, 4.92388263e+02, 7.01703829e+02, 1.00000000e+03]),
                         'penalty': ['l1', 'l2']},
             pre_dispatch='2*n_jobs', refit=True, return_train_score=False,
             scoring='accuracy', verbose=1)
Best LogisticRegression model archieves 85.64% accuracy


[Parallel(n_jobs=-1)]: Done 400 out of 400 | elapsed:    0.3s finished
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">"</span><span class="s">learning_rate</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.025</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.075</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span>
    <span class="sh">"</span><span class="s">subsample</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.62</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="mf">0.87</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
<span class="p">}</span>

<span class="nf">optimize_model</span><span class="p">(</span><span class="n">GradientBoostingClassifier</span><span class="p">,</span>
               <span class="n">X_train</span><span class="p">,</span>
               <span class="n">y_train</span><span class="p">,</span>
               <span class="n">paramgrid</span><span class="o">=</span><span class="n">param_grid</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[Parallel(n_jobs=-1)]: Using backend LokyBackend with 8 concurrent workers.


Fitting 5 folds for each of 56 candidates, totalling 280 fits


[Parallel(n_jobs=-1)]: Done  52 tasks      | elapsed:    1.5s


GridSearchCV(cv=StratifiedKFold(n_splits=5, random_state=5, shuffle=True),
             error_score=nan,
             estimator=GradientBoostingClassifier(ccp_alpha=0.0,
                                                  criterion='friedman_mse',
                                                  init=None, learning_rate=0.1,
                                                  loss='deviance', max_depth=3,
                                                  max_features=None,
                                                  max_leaf_nodes=None,
                                                  min_impurity_decrease=0.0,
                                                  min_impurity_split=None,
                                                  min_samples_leaf=1,
                                                  min_samples_split=2,
                                                  min...
                                                  n_iter_no_change=None,
                                                  presort='deprecated',
                                                  random_state=None,
                                                  subsample=1.0, tol=0.0001,
                                                  validation_fraction=0.1,
                                                  verbose=0, warm_start=False),
             iid='deprecated', n_jobs=-1,
             param_grid={'learning_rate': [0.01, 0.025, 0.05, 0.075, 0.1, 0.15,
                                           0.2],
                         'subsample': [0.5, 0.62, 0.8, 0.85, 0.87, 0.9, 0.95,
                                       1.0]},
             pre_dispatch='2*n_jobs', refit=True, return_train_score=False,
             scoring='accuracy', verbose=1)
Best GradientBoostingClassifier model archieves 86.20% accuracy


[Parallel(n_jobs=-1)]: Done 280 out of 280 | elapsed:    6.8s finished
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">"</span><span class="s">n_neighbors</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">15</span><span class="p">],</span>
    <span class="sh">"</span><span class="s">weights</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="sh">'</span><span class="s">uniform</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">distance</span><span class="sh">'</span><span class="p">],</span>
    <span class="sh">"</span><span class="s">metric</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="sh">'</span><span class="s">manhattan</span><span class="sh">'</span><span class="p">],</span>
    <span class="sh">"</span><span class="s">algorithm</span><span class="sh">"</span><span class="p">:[</span><span class="sh">'</span><span class="s">auto</span><span class="sh">'</span><span class="p">]</span>
<span class="p">}</span>

<span class="nf">optimize_model</span><span class="p">(</span><span class="n">KNeighborsClassifier</span><span class="p">,</span>
               <span class="n">X_train</span><span class="p">,</span>
               <span class="n">y_train</span><span class="p">,</span>
               <span class="n">paramgrid</span><span class="o">=</span><span class="n">param_grid</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Fitting 5 folds for each of 12 candidates, totalling 60 fits


[Parallel(n_jobs=-1)]: Using backend LokyBackend with 4 concurrent workers.


GridSearchCV(cv=StratifiedKFold(n_splits=5, random_state=5, shuffle=True),
             error_score='raise-deprecating',
             estimator=KNeighborsClassifier(algorithm='auto', leaf_size=30,
                                            metric='minkowski',
                                            metric_params=None, n_jobs=None,
                                            n_neighbors=5, p=2,
                                            weights='uniform'),
             iid='warn', n_jobs=-1,
             param_grid={'algorithm': ['auto'], 'metric': ['manhattan'],
                         'n_neighbors': [3, 5, 7, 11, 13, 15],
                         'weights': ['uniform', 'distance']},
             pre_dispatch='2*n_jobs', refit=True, return_train_score=False,
             scoring='accuracy', verbose=1)
Best KNeighborsClassifier model archieves 83.95% accuracy


[Parallel(n_jobs=-1)]: Done  60 out of  60 | elapsed:    4.1s finished
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">LDA</span> <span class="o">=</span> <span class="nc">LinearDiscriminantAnalysis</span><span class="p">()</span>
<span class="n">LDA</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">LDA_best</span> <span class="o">=</span> <span class="n">LDA</span>
<span class="n">best_models</span><span class="p">.</span><span class="nf">append</span><span class="p">((</span><span class="sh">"</span><span class="s">LDA_best</span><span class="sh">"</span><span class="p">,</span> <span class="n">LDA_best</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">predictions</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">N_fold</span> <span class="o">=</span> <span class="mi">5</span>


<span class="k">def</span> <span class="nf">generalize_predictions</span><span class="p">(</span><span class="n">model</span><span class="p">,</span>
                           <span class="n">X_train</span><span class="p">,</span>
                           <span class="n">y_train</span><span class="p">,</span>
                           <span class="n">X_test</span><span class="p">,</span>
                           <span class="n">skf</span><span class="o">=</span><span class="nc">StratifiedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="n">N_fold</span><span class="p">,</span>
                                               <span class="n">random_state</span><span class="o">=</span><span class="n">N_fold</span><span class="p">,</span>
                                               <span class="n">shuffle</span><span class="o">=</span><span class="bp">True</span><span class="p">)):</span>

    <span class="c1"># store predicted probas for each folds
</span>    <span class="n">probas</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">((</span><span class="nf">len</span><span class="p">(</span><span class="n">X_test</span><span class="p">),</span> <span class="n">N_fold</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)),</span>
                          <span class="n">columns</span><span class="o">=</span><span class="p">[</span>
                              <span class="sh">'</span><span class="s">Fold_{}_Class_{}</span><span class="sh">'</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
                              <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N_fold</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
                          <span class="p">],</span>
                          <span class="n">index</span><span class="o">=</span><span class="n">passengerId</span><span class="p">)</span>

    <span class="c1"># for each fold, train then predict
</span>    <span class="k">for</span> <span class="n">fold_id</span><span class="p">,</span> <span class="p">(</span><span class="n">train_idx</span><span class="p">,</span>
                  <span class="n">val_idx</span><span class="p">)</span> <span class="ow">in</span> <span class="nf">tqdm</span><span class="p">(</span><span class="nf">enumerate</span><span class="p">(</span><span class="n">skf</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">),</span> <span class="mi">1</span><span class="p">)):</span>

        <span class="c1"># Fitting the model
</span>        <span class="n">model</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">[</span><span class="n">train_idx</span><span class="p">],</span> <span class="n">y_train</span><span class="p">[</span><span class="n">train_idx</span><span class="p">])</span>

        <span class="c1"># X_test probabilities
</span>        <span class="n">probas</span><span class="p">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="sh">'</span><span class="s">Fold_{}_Class_0</span><span class="sh">'</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">fold_id</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="nf">predict_proba</span><span class="p">(</span>
            <span class="n">X_test</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">probas</span><span class="p">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="sh">'</span><span class="s">Fold_{}_Class_1</span><span class="sh">'</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">fold_id</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="nf">predict_proba</span><span class="p">(</span>
            <span class="n">X_test</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="c1"># save results
</span>    <span class="nf">return </span><span class="p">(</span><span class="n">probas</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">predictions</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="nf">generalize_predictions</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">best_models</span><span class="p">}</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>5it [00:07,  1.49s/it]
5it [00:13,  2.70s/it]
5it [00:13,  2.78s/it]
5it [00:01,  3.91it/s]
5it [00:00, 40.15it/s]
5it [00:00,  6.12it/s]
5it [00:00, 18.64it/s]
5it [00:00, 116.72it/s]
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">make_predictions</span><span class="p">(</span><span class="n">model_df</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="sh">"</span><span class="s">hard</span><span class="sh">"</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
    
    <span class="n">predictions</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">((</span><span class="nf">len</span><span class="p">(</span><span class="n">X_test</span><span class="p">),</span> <span class="mi">3</span><span class="p">)),</span>
                     <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">1</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">0</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">pred</span><span class="sh">'</span><span class="p">])</span>
    
    <span class="c1"># isolate probabilities of class 1
</span>    <span class="n">class_one</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">model_df</span><span class="p">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span><span class="p">.</span><span class="nf">endswith</span><span class="p">(</span><span class="sh">'</span><span class="s">Class_1</span><span class="sh">'</span><span class="p">)]</span>
    
    <span class="c1"># compute average of class 1 probabilities
</span>    <span class="n">predictions</span><span class="p">[</span><span class="sh">'</span><span class="s">1</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">model_df</span><span class="p">[</span><span class="n">class_one</span><span class="p">].</span><span class="nf">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">N_fold</span>
    <span class="n">predictions</span><span class="p">[</span><span class="sh">'</span><span class="s">0</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">-</span> <span class="n">predictions</span><span class="p">[</span><span class="sh">'</span><span class="s">1</span><span class="sh">'</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="n">mode</span><span class="o">==</span><span class="sh">"</span><span class="s">hard</span><span class="sh">"</span><span class="p">:</span>
        <span class="n">predictions</span><span class="p">[</span><span class="sh">'</span><span class="s">pred</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">predictions</span><span class="p">[</span><span class="sh">'</span><span class="s">1</span><span class="sh">'</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">threshold</span><span class="p">).</span><span class="nf">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">predictions</span><span class="p">[</span><span class="sh">'</span><span class="s">pred</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">predictions</span><span class="p">[</span><span class="sh">'</span><span class="s">1</span><span class="sh">'</span><span class="p">]</span>
    
    <span class="n">model_results</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">PassengerId</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Survived</span><span class="sh">'</span><span class="p">])</span>
    <span class="n">model_results</span><span class="p">[</span><span class="sh">'</span><span class="s">PassengerId</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_test</span><span class="p">[</span><span class="sh">'</span><span class="s">PassengerId</span><span class="sh">'</span><span class="p">]</span>
    <span class="n">model_results</span><span class="p">[</span><span class="sh">'</span><span class="s">Survived</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">predictions</span><span class="p">[</span><span class="sh">'</span><span class="s">pred</span><span class="sh">'</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">model_results</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">results</span> <span class="o">=</span> <span class="p">[(</span><span class="n">key</span><span class="p">,</span> <span class="nf">make_predictions</span><span class="p">(</span><span class="n">model</span><span class="p">))</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">predictions</span><span class="p">.</span><span class="nf">items</span><span class="p">()]</span>
</code></pre></div></div>

<hr />
<p><a id="Section_9"></a></p>
<h2 id="9-best-models">9. Best Models</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">best_models</span><span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>XGBClassifier_best
ExtraTreesClassifier_best
RandomForestClassifier_best
SVC_best
LogisticRegression_best
GradientBoostingClassifier_best
KNeighborsClassifier_best
LDA_best
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">predictions</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="nf">tqdm</span><span class="p">(</span><span class="n">best_models</span><span class="p">):</span>
    <span class="c1"># make predictions
</span>    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="nf">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    
    <span class="c1"># store predictions
</span>    <span class="n">predictions</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">model_name</span><span class="p">))</span>
    
<span class="c1"># concatenate predictions
</span><span class="n">ensemble_results</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">concat</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>100%|██████████| 8/8 [00:00&lt;00:00, 16.13it/s]
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Generate a mask for the upper triangle
</span><span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros_like</span><span class="p">(</span><span class="n">ensemble_results</span><span class="p">.</span><span class="nf">corr</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="nb">bool</span><span class="p">)</span>
<span class="n">mask</span><span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="nf">triu_indices_from</span><span class="p">(</span><span class="n">mask</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">True</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="n">cmap</span> <span class="o">=</span> <span class="n">sns</span><span class="p">.</span><span class="nf">diverging_palette</span><span class="p">(</span><span class="mi">220</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">as_cmap</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="p">.</span><span class="nf">heatmap</span><span class="p">(</span><span class="n">ensemble_results</span><span class="p">.</span><span class="nf">corr</span><span class="p">(),</span>
                <span class="n">annot</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span>
                <span class="n">annot_kws</span><span class="o">=</span><span class="p">{</span><span class="sh">"</span><span class="s">fontsize</span><span class="sh">"</span><span class="p">:</span> <span class="mi">14</span><span class="p">},</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>

<span class="n">ylabels</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">.</span><span class="nf">get_text</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">g</span><span class="p">.</span><span class="nf">get_yticklabels</span><span class="p">()]</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">yticks</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">ylabels</span><span class="p">))</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">,</span>
           <span class="n">ylabels</span><span class="p">,</span>
           <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
           <span class="n">fontsize</span><span class="o">=</span><span class="sh">"</span><span class="s">14</span><span class="sh">"</span><span class="p">,</span>
           <span class="n">va</span><span class="o">=</span><span class="sh">"</span><span class="s">center</span><span class="sh">"</span><span class="p">)</span>
<span class="n">g</span><span class="p">.</span><span class="nf">set_ylim</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">best_models</span><span class="p">),</span> <span class="mf">0.5</span><span class="p">);</span>
</code></pre></div></div>

<figure>
<img src="https://tdody.github.io/assets/img/2020-02-02-Titanic/output_200_0.png" />  
</figure>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">plot_learning_curve</span><span class="p">(</span><span class="n">models</span><span class="p">,</span>
                        <span class="n">X</span><span class="p">,</span>
                        <span class="n">y</span><span class="p">,</span>
                        <span class="n">ylim</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                        <span class="n">cv</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                        <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">train_sizes</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="nf">linspace</span><span class="p">(.</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mi">5</span><span class="p">)):</span>

    <span class="c1"># extract number of models
</span>    <span class="n">n_models</span> <span class="o">=</span> <span class="nf">len</span><span class="p">(</span><span class="n">models</span><span class="p">)</span>

    <span class="c1"># create figure
</span>    <span class="n">fix</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="n">n_models</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">n_models</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">models</span><span class="p">):</span>
        <span class="c1"># unpack
</span>        <span class="n">name</span><span class="p">,</span> <span class="n">model</span> <span class="o">=</span> <span class="n">val</span>

        <span class="c1"># scale y axis
</span>        <span class="k">if</span> <span class="n">ylim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="n">axes</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="nf">set_ylim</span><span class="p">(</span><span class="o">*</span><span class="n">ylim</span><span class="p">)</span>
        <span class="c1"># set title
</span>        <span class="n">axes</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="nf">set_title</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="sh">"</span><span class="s">learning curves</span><span class="sh">"</span><span class="p">)</span>
        <span class="c1"># set labels
</span>        <span class="n">axes</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="nf">set_xlabel</span><span class="p">(</span><span class="sh">"</span><span class="s">Training size</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="nf">set_ylabel</span><span class="p">(</span><span class="sh">"</span><span class="s">Score</span><span class="sh">"</span><span class="p">)</span>
        <span class="c1"># compute learning curves
</span>        <span class="n">train_sizes</span><span class="p">,</span> <span class="n">train_scores</span><span class="p">,</span> <span class="n">test_scores</span> <span class="o">=</span> <span class="nf">learning_curve</span><span class="p">(</span>
            <span class="n">model</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="n">n_jobs</span><span class="p">,</span> <span class="n">train_sizes</span><span class="o">=</span><span class="n">train_sizes</span><span class="p">)</span>
        <span class="c1"># compute statistics
</span>        <span class="n">train_score_mean</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">train_scores</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">train_score_std</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">std</span><span class="p">(</span><span class="n">train_scores</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">test_score_mean</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">test_scores</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">test_score_std</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">std</span><span class="p">(</span><span class="n">test_scores</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">axes</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="nf">fill_between</span><span class="p">(</span><span class="n">train_sizes</span><span class="p">,</span>
                               <span class="n">train_score_mean</span> <span class="o">-</span> <span class="n">train_score_std</span><span class="p">,</span>
                               <span class="n">train_score_mean</span> <span class="o">+</span> <span class="n">train_score_std</span><span class="p">,</span>
                               <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                               <span class="n">color</span><span class="o">=</span><span class="sh">'</span><span class="s">r</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="nf">fill_between</span><span class="p">(</span><span class="n">train_sizes</span><span class="p">,</span>
                               <span class="n">test_score_mean</span> <span class="o">-</span> <span class="n">test_score_std</span><span class="p">,</span>
                               <span class="n">test_score_mean</span> <span class="o">+</span> <span class="n">test_score_std</span><span class="p">,</span>
                               <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                               <span class="n">color</span><span class="o">=</span><span class="sh">'</span><span class="s">g</span><span class="sh">'</span><span class="p">)</span>

        <span class="n">axes</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="nf">plot</span><span class="p">(</span><span class="n">train_sizes</span><span class="p">,</span>
                       <span class="n">train_score_mean</span><span class="p">,</span>
                       <span class="sh">'</span><span class="s">o-</span><span class="sh">'</span><span class="p">,</span>
                       <span class="n">color</span><span class="o">=</span><span class="sh">"</span><span class="s">r</span><span class="sh">"</span><span class="p">,</span>
                       <span class="n">label</span><span class="o">=</span><span class="sh">"</span><span class="s">Training score</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="nf">plot</span><span class="p">(</span><span class="n">train_sizes</span><span class="p">,</span>
                       <span class="n">test_score_mean</span><span class="p">,</span>
                       <span class="sh">'</span><span class="s">o-</span><span class="sh">'</span><span class="p">,</span>
                       <span class="n">color</span><span class="o">=</span><span class="sh">"</span><span class="s">g</span><span class="sh">"</span><span class="p">,</span>
                       <span class="n">label</span><span class="o">=</span><span class="sh">"</span><span class="s">Cross-validation score</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="nf">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="sh">'</span><span class="s">best</span><span class="sh">'</span><span class="p">)</span>
        
    <span class="n">plt</span><span class="p">.</span><span class="nf">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">plot_learning_curve</span><span class="p">(</span><span class="n">best_models</span><span class="p">,</span><span class="n">X_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">,</span><span class="n">cv</span><span class="o">=</span><span class="n">kfold</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">1.</span><span class="p">));</span>
</code></pre></div></div>

<figure>
<img src="https://tdody.github.io/assets/img/2020-02-02-Titanic/output_202_0.png" />  
</figure>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">nrows</span> <span class="o">=</span> <span class="n">ncols</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="n">nrows</span> <span class="o">=</span> <span class="n">nrows</span><span class="p">,</span> <span class="n">ncols</span> <span class="o">=</span> <span class="n">ncols</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="sh">"</span><span class="s">all</span><span class="sh">"</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">))</span>

<span class="n">names_classifiers</span> <span class="o">=</span> <span class="p">[(</span><span class="sh">"</span><span class="s">XGBClassifier_best</span><span class="sh">"</span><span class="p">,</span><span class="n">best_models</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span>
                     <span class="p">(</span><span class="sh">"</span><span class="s">ExtraTreesClassifier_best</span><span class="sh">"</span><span class="p">,</span><span class="n">best_models</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span>
                     <span class="p">(</span><span class="sh">"</span><span class="s">RandomForestClassifier_best</span><span class="sh">"</span><span class="p">,</span><span class="n">best_models</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span>
                     <span class="p">(</span><span class="sh">"</span><span class="s">GradientBoostingClassifier_best</span><span class="sh">"</span><span class="p">,</span><span class="n">best_models</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">1</span><span class="p">])]</span>

<span class="n">nclassifier</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">nrows</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">ncols</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">names_classifiers</span><span class="p">[</span><span class="n">nclassifier</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">classifier</span> <span class="o">=</span> <span class="n">names_classifiers</span><span class="p">[</span><span class="n">nclassifier</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">argsort</span><span class="p">(</span><span class="n">classifier</span><span class="p">.</span><span class="n">feature_importances_</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="mi">40</span><span class="p">]</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="p">.</span><span class="nf">barplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">df_train</span><span class="p">.</span><span class="n">columns</span><span class="p">[</span><span class="n">indices</span><span class="p">][:</span><span class="mi">40</span><span class="p">],</span><span class="n">x</span> <span class="o">=</span> <span class="n">classifier</span><span class="p">.</span><span class="n">feature_importances_</span><span class="p">[</span><span class="n">indices</span><span class="p">][:</span><span class="mi">40</span><span class="p">]</span> <span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="sh">'</span><span class="s">h</span><span class="sh">'</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">col</span><span class="p">])</span>
        <span class="n">g</span><span class="p">.</span><span class="nf">set_xlabel</span><span class="p">(</span><span class="sh">"</span><span class="s">Relative importance</span><span class="sh">"</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">g</span><span class="p">.</span><span class="nf">set_ylabel</span><span class="p">(</span><span class="sh">"</span><span class="s">Features</span><span class="sh">"</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">g</span><span class="p">.</span><span class="nf">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
        <span class="n">g</span><span class="p">.</span><span class="nf">set_title</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="sh">"</span><span class="s"> feature importance</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">nclassifier</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">tight_layout</span><span class="p">()</span>
</code></pre></div></div>

<figure>
<img src="https://tdody.github.io/assets/img/2020-02-02-Titanic/output_203_0.png" />  
</figure>

<hr />
<p><a id="Section_10"></a></p>
<h2 id="10-create-submission">10. Create Submission</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># generate submission file 
</span><span class="n">submission_df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">({</span><span class="sh">'</span><span class="s">PassengerId</span><span class="sh">'</span><span class="p">:</span> <span class="n">passengerId</span><span class="p">,</span>
                            <span class="sh">'</span><span class="s">Survived</span><span class="sh">'</span><span class="p">:</span> <span class="n">results</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">].</span><span class="n">values</span><span class="p">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]})</span>
<span class="n">submission_df</span><span class="p">.</span><span class="nf">to_csv</span><span class="p">(</span><span class="sh">"</span><span class="s">voting_submission_df.csv</span><span class="sh">"</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</code></pre></div></div>

<p>The submission leads to a <strong>81.339%</strong> accuracy. This is puts the predictions in the top <strong>3%</strong> of the Kaggle leaderboard.</p>

<figure>
<img src="https://tdody.github.io/assets/img/2020-02-02-Titanic/Score.PNG" style="width:800px;" />  
</figure>
<figure>
<img src="https://tdody.github.io/assets/img/2020-02-02-Titanic/Rank.PNG" style="width:250px;" />
</figure>
