<footer id="attribution" style="float:right; color:#999; background:#fff;">
Created by Thibault Dody, 07/02/2019.
</footer>

<h1 id="forest-cover-type">Forest Cover Type</h1>

<figure>
<img src="https://tdody.github.io/assets/img/2019-07-15-Forest-Cover/banner_forest.jpg" style="width:1920px;" />
</figure>

<p>We are asked to predict the forest cover type (the predominant kind of tree cover) from cartographic variables. The actual forest cover type for a given 30 x 30 meter cell was determined from US Forest Service (USFS) Region 2 Resource Information System data. Independent variables were then derived from data obtained from the US Geological Survey and USFS. The data is in raw form and contains binary columns of data for qualitative independent variables such as wilderness areas and soil type.</p>

<p>This study area includes four wilderness areas located in the Roosevelt National Forest of northern Colorado. These areas represent forests with minimal human-caused disturbances, so that existing forest cover types are more a result of ecological processes rather than forest management practices.</p>

<p>The pictures below show the seven cover types considered in this analysis</p>
<figure class="third">
	<img src="https://tdody.github.io/assets/img/2019-07-15-Forest-Cover/Spruce.jpeg" style="height: 150px;width: 150px" />
	<img src="https://tdody.github.io/assets/img/2019-07-15-Forest-Cover/lodgepole pine.jpg" style="height: 150px;;width: 150px" />
	<img src="https://tdody.github.io/assets/img/2019-07-15-Forest-Cover/Ponderosa Pine.jpeg" style="height: 150px;;width: 150px" />
</figure>

<figure class="third">
	<img src="https://tdody.github.io/assets/img/2019-07-15-Forest-Cover/Cottonwood_Willow.jpg" style="height: 150px;;width: 150px" />
	<img src="https://tdody.github.io/assets/img/2019-07-15-Forest-Cover/Aspen.jpg" style="height: 150px;;width: 150px" />
	<img src="https://tdody.github.io/assets/img/2019-07-15-Forest-Cover/Douglas-fir.jpg" style="height: 150px;;width: 150px" />
</figure>

<figure class="third">
	<img src="https://tdody.github.io/assets/img/2019-07-15-Forest-Cover/Krummholz.jpg" style="height: 150px;;width: 150px" />
</figure>

<h1 id="table-of-content">Table of Content</h1>

<p><a href="#Section_1"><strong>1. Introduction</strong></a><br />
<a href="#Section_2"><strong>2. Tool Functions</strong></a><br />
<a href="#Section_3"><strong>3. Data Exploration</strong></a><br />
    <a href="#Section_3_1">3.1 Class Distribution</a><br />
    <a href="#Section_3_2">3.2 Elevation</a><br />
    <a href="#Section_3_3">3.3 Aspect</a><br />
    <a href="#Section_3_4">3.4 Slope</a><br />
    <a href="#Section_3_5">3.5 Horizontal Distance To Hydrology</a><br />
    <a href="#Section_3_6">3.6 Vertical Distance To Hydrology</a><br />
    <a href="#Section_3_7">3.7 Horizontal Distance To Roadways</a><br />
    <a href="#Section_3_8">3.8 Hillshade 9 AM</a><br />
    <a href="#Section_3_9">3.9 Hillshade Noon</a><br />
    <a href="#Section_3_10">3.10 Hillshade 3 PM</a><br />
    <a href="#Section_3_11">3.11 Horizontal Distance To Fire Points</a><br />
    <a href="#Section_3_12">3.12 Wilderness Areas</a><br />
    <a href="#Section_3_13">3.13 Soil Type</a><br />
    <a href="#Section_3_13">3.14 Feature Correlation</a><br />
<a href="#Section_4"><strong>4. Feature Engineering</strong></a><br />
<a href="#Section_5"><strong>5. Models</strong></a><br />
<a href="#Section_6"><strong>6. Submission</strong></a></p>

<hr />
<p><a id="Section_1"></a></p>
<h2 id="1-introduction">1. Introduction</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># import libraries
</span><span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="n">sys</span>
<span class="n">np</span><span class="p">.</span><span class="nf">set_printoptions</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="n">sys</span><span class="p">.</span><span class="n">maxsize</span><span class="p">)</span>

<span class="kn">import</span> <span class="n">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="n">seaborn</span> <span class="k">as</span> <span class="n">sns</span>
<span class="c1"># sns.set_style("whitegrid")
</span><span class="n">sns</span><span class="p">.</span><span class="nf">set</span><span class="p">()</span>
<span class="n">mycols</span> <span class="o">=</span> <span class="p">[</span><span class="sh">"</span><span class="s">#66c2ff</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">#00cc99</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">#85e085</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">#ffd966</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">#ffb3b3</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">#dab3ff</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">#c2c2d6</span><span class="sh">"</span><span class="p">]</span>
<span class="n">sns</span><span class="p">.</span><span class="nf">set_palette</span><span class="p">(</span><span class="n">palette</span> <span class="o">=</span> <span class="n">mycols</span><span class="p">,</span> <span class="n">n_colors</span> <span class="o">=</span> <span class="mi">7</span><span class="p">)</span>

<span class="kn">from</span> <span class="n">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="kn">from</span> <span class="n">scipy.stats</span> <span class="kn">import</span> <span class="n">skew</span><span class="p">,</span> <span class="n">norm</span>
<span class="kn">from</span> <span class="n">scipy.special</span> <span class="kn">import</span> <span class="n">boxcox1p</span>
<span class="kn">from</span> <span class="n">scipy.stats.stats</span> <span class="kn">import</span> <span class="n">pearsonr</span>
<span class="kn">from</span> <span class="n">scipy.stats</span> <span class="kn">import</span> <span class="n">ttest_ind</span>

<span class="kn">from</span> <span class="n">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span><span class="p">,</span> <span class="n">ShuffleSplit</span>

<span class="kn">import</span> <span class="n">xgboost</span> <span class="k">as</span> <span class="n">xgb</span>

<span class="kn">import</span> <span class="n">math</span>

<span class="kn">import</span> <span class="n">warnings</span>
<span class="n">warnings</span><span class="p">.</span><span class="nf">simplefilter</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="sh">'</span><span class="s">ignore</span><span class="sh">'</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="nb">FutureWarning</span><span class="p">)</span>
<span class="n">warnings</span><span class="p">.</span><span class="nf">simplefilter</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="sh">'</span><span class="s">ignore</span><span class="sh">'</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="nb">RuntimeWarning</span><span class="p">)</span>
<span class="n">warnings</span><span class="p">.</span><span class="nf">filterwarnings</span><span class="p">(</span><span class="sh">"</span><span class="s">ignore</span><span class="sh">"</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="nb">DeprecationWarning</span><span class="p">)</span>

<span class="kn">from</span> <span class="n">sklearn.base</span> <span class="kn">import</span> <span class="n">TransformerMixin</span><span class="p">,</span> <span class="n">BaseEstimator</span>

<span class="n">decimals</span> <span class="o">=</span> <span class="mi">2</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
</code></pre></div></div>

<p>The study area includes four wilderness areas located in the Roosevelt National Forest of northern Colorado. Each observation is a 30m x 30m patch. Our are asked to predict an integer classification for the forest cover type. <strong>The seven types are:</strong></p>

<ol>
  <li>Spruce/Fir</li>
  <li>Lodgepole Pine</li>
  <li>Ponderosa Pine</li>
  <li>Cottonwood/Willow</li>
  <li>Aspen</li>
  <li>Douglas-fir</li>
  <li>Krummholz</li>
</ol>

<p>The training set (<strong>15120 observations</strong>) contains both features and the Cover_Type. The test set contains only the features. You must predict the Cover_Type for every row in the test set (<strong>565892 observations</strong>).</p>

<p>Data Fields</p>
<ul>
  <li>Elevation - Elevation in meters</li>
  <li>Aspect - Aspect in degrees azimuth</li>
  <li>Slope - Slope in degrees</li>
  <li>Horizontal_Distance_To_Hydrology - Horz Dist to nearest surface water features</li>
  <li>Vertical_Distance_To_Hydrology - Vert Dist to nearest surface water features</li>
  <li>Horizontal_Distance_To_Roadways - Horz Dist to nearest roadway</li>
  <li>Hillshade_9am (0 to 255 index) - Hillshade index at 9am, summer solstice</li>
  <li>Hillshade_Noon (0 to 255 index) - Hillshade index at noon, summer solstice</li>
  <li>Hillshade_3pm (0 to 255 index) - Hillshade index at 3pm, summer solstice</li>
  <li>Horizontal_Distance_To_Fire_Points - Horz Dist to nearest wildfire ignition points</li>
  <li>Wilderness_Area (4 binary columns, 0 = absence or 1 = presence) - Wilderness area designation</li>
  <li>Soil_Type (40 binary columns, 0 = absence or 1 = presence) - Soil Type designation</li>
  <li>Cover_Type (7 types, integers 1 to 7) - Forest Cover Type designation</li>
</ul>

<p>The wilderness areas are:</p>

<ol>
  <li>Rawah Wilderness Area</li>
  <li>Neota Wilderness Area</li>
  <li>Comanche Peak Wilderness Area</li>
  <li>Cache la Poudre Wilderness Area</li>
</ol>

<p>The soil types are:</p>

<ol>
  <li>Cathedral family - Rock outcrop complex, extremely stony.</li>
  <li>Vanet - Ratake families complex, very stony.</li>
  <li>Haploborolis - Rock outcrop complex, rubbly.</li>
  <li>Ratake family - Rock outcrop complex, rubbly.</li>
  <li>Vanet family - Rock outcrop complex complex, rubbly.</li>
  <li>Vanet - Wetmore families - Rock outcrop complex, stony.</li>
  <li>Gothic family.</li>
  <li>Supervisor - Limber families complex.</li>
  <li>Troutville family, very stony.</li>
  <li>Bullwark - Catamount families - Rock outcrop complex, rubbly.</li>
  <li>Bullwark - Catamount families - Rock land complex, rubbly.</li>
  <li>Legault family - Rock land complex, stony.</li>
  <li>Catamount family - Rock land - Bullwark family complex, rubbly.</li>
  <li>Pachic Argiborolis - Aquolis complex.</li>
  <li>unspecified in the USFS Soil and ELU Survey.</li>
  <li>Cryaquolis - Cryoborolis complex.</li>
  <li>Gateview family - Cryaquolis complex.</li>
  <li>Rogert family, very stony.</li>
  <li>Typic Cryaquolis - Borohemists complex.</li>
  <li>Typic Cryaquepts - Typic Cryaquolls complex.</li>
  <li>Typic Cryaquolls - Leighcan family, till substratum complex.</li>
  <li>Leighcan family, till substratum, extremely bouldery.</li>
  <li>Leighcan family, till substratum - Typic Cryaquolls complex.</li>
  <li>Leighcan family, extremely stony.</li>
  <li>Leighcan family, warm, extremely stony.</li>
  <li>Granile - Catamount families complex, very stony.</li>
  <li>Leighcan family, warm - Rock outcrop complex, extremely stony.</li>
  <li>Leighcan family - Rock outcrop complex, extremely stony.</li>
  <li>Como - Legault families complex, extremely stony.</li>
  <li>Como family - Rock land - Legault family complex, extremely stony.</li>
  <li>Leighcan - Catamount families complex, extremely stony.</li>
  <li>Catamount family - Rock outcrop - Leighcan family complex, extremely stony.</li>
  <li>Leighcan - Catamount families - Rock outcrop complex, extremely stony.</li>
  <li>Cryorthents - Rock land complex, extremely stony.</li>
  <li>Cryumbrepts - Rock outcrop - Cryaquepts complex.</li>
  <li>Bross family - Rock land - Cryumbrepts complex, extremely stony.</li>
  <li>Rock outcrop - Cryumbrepts - Cryorthents complex, extremely stony.</li>
  <li>Leighcan - Moran families - Cryaquolls complex, extremely stony.</li>
  <li>Moran family - Cryorthents - Leighcan family complex, extremely stony.</li>
  <li>Moran family - Cryorthents - Rock land complex, extremely stony.</li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># load data
</span><span class="n">train</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_csv</span><span class="p">(</span><span class="sh">'</span><span class="s">data/train.csv</span><span class="sh">'</span><span class="p">)</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_csv</span><span class="p">(</span><span class="sh">'</span><span class="s">data/test.csv</span><span class="sh">'</span><span class="p">)</span>

<span class="c1"># save Id
</span><span class="n">train_ID</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="sh">'</span><span class="s">Id</span><span class="sh">'</span><span class="p">]</span>
<span class="n">test_ID</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="sh">'</span><span class="s">Id</span><span class="sh">'</span><span class="p">]</span>

<span class="c1"># drop iD
</span><span class="k">del</span> <span class="n">train</span><span class="p">[</span><span class="sh">'</span><span class="s">Id</span><span class="sh">'</span><span class="p">]</span>
<span class="k">del</span> <span class="n">test</span><span class="p">[</span><span class="sh">'</span><span class="s">Id</span><span class="sh">'</span><span class="p">]</span>

<span class="c1"># investigate shapes
</span><span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">Train shape:</span><span class="sh">'</span><span class="p">,</span> <span class="n">train</span><span class="p">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">Test shape:</span><span class="sh">'</span><span class="p">,</span> <span class="n">test</span><span class="p">.</span><span class="n">shape</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Train shape: (15120, 55)
Test shape: (565892, 54)
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># list features
</span><span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">List of features:</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">train</span><span class="p">.</span><span class="n">columns</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>List of features:
Index(['Elevation', 'Aspect', 'Slope', 'Horizontal_Distance_To_Hydrology',
       'Vertical_Distance_To_Hydrology', 'Horizontal_Distance_To_Roadways',
       'Hillshade_9am', 'Hillshade_Noon', 'Hillshade_3pm',
       'Horizontal_Distance_To_Fire_Points', 'Wilderness_Area1',
       'Wilderness_Area2', 'Wilderness_Area3', 'Wilderness_Area4',
       'Soil_Type1', 'Soil_Type2', 'Soil_Type3', 'Soil_Type4', 'Soil_Type5',
       'Soil_Type6', 'Soil_Type7', 'Soil_Type8', 'Soil_Type9', 'Soil_Type10',
       'Soil_Type11', 'Soil_Type12', 'Soil_Type13', 'Soil_Type14',
       'Soil_Type15', 'Soil_Type16', 'Soil_Type17', 'Soil_Type18',
       'Soil_Type19', 'Soil_Type20', 'Soil_Type21', 'Soil_Type22',
       'Soil_Type23', 'Soil_Type24', 'Soil_Type25', 'Soil_Type26',
       'Soil_Type27', 'Soil_Type28', 'Soil_Type29', 'Soil_Type30',
       'Soil_Type31', 'Soil_Type32', 'Soil_Type33', 'Soil_Type34',
       'Soil_Type35', 'Soil_Type36', 'Soil_Type37', 'Soil_Type38',
       'Soil_Type39', 'Soil_Type40', 'Cover_Type'],
      dtype='object')
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># explore data
</span><span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Here are a few observations: </span><span class="sh">"</span><span class="p">)</span>
<span class="n">train</span><span class="p">.</span><span class="nf">head</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Here are a few observations: 
</code></pre></div></div>

<div style="overflow-x:auto;">
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Elevation</th>
      <th>Aspect</th>
      <th>Slope</th>
      <th>Horizontal_Distance_To_Hydrology</th>
      <th>Vertical_Distance_To_Hydrology</th>
      <th>Horizontal_Distance_To_Roadways</th>
      <th>Hillshade_9am</th>
      <th>Hillshade_Noon</th>
      <th>Hillshade_3pm</th>
      <th>Horizontal_Distance_To_Fire_Points</th>
      <th>...</th>
      <th>Soil_Type32</th>
      <th>Soil_Type33</th>
      <th>Soil_Type34</th>
      <th>Soil_Type35</th>
      <th>Soil_Type36</th>
      <th>Soil_Type37</th>
      <th>Soil_Type38</th>
      <th>Soil_Type39</th>
      <th>Soil_Type40</th>
      <th>Cover_Type</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2596</td>
      <td>51</td>
      <td>3</td>
      <td>258</td>
      <td>0</td>
      <td>510</td>
      <td>221</td>
      <td>232</td>
      <td>148</td>
      <td>6279</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>5</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2590</td>
      <td>56</td>
      <td>2</td>
      <td>212</td>
      <td>-6</td>
      <td>390</td>
      <td>220</td>
      <td>235</td>
      <td>151</td>
      <td>6225</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>5</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2804</td>
      <td>139</td>
      <td>9</td>
      <td>268</td>
      <td>65</td>
      <td>3180</td>
      <td>234</td>
      <td>238</td>
      <td>135</td>
      <td>6121</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2785</td>
      <td>155</td>
      <td>18</td>
      <td>242</td>
      <td>118</td>
      <td>3090</td>
      <td>238</td>
      <td>238</td>
      <td>122</td>
      <td>6211</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2595</td>
      <td>45</td>
      <td>2</td>
      <td>153</td>
      <td>-1</td>
      <td>391</td>
      <td>220</td>
      <td>234</td>
      <td>150</td>
      <td>6172</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>5</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 55 columns</p>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># explore data
</span><span class="n">train</span><span class="p">.</span><span class="nf">info</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 15120 entries, 0 to 15119
Data columns (total 55 columns):
Elevation                             15120 non-null int64
Aspect                                15120 non-null int64
Slope                                 15120 non-null int64
Horizontal_Distance_To_Hydrology      15120 non-null int64
Vertical_Distance_To_Hydrology        15120 non-null int64
Horizontal_Distance_To_Roadways       15120 non-null int64
Hillshade_9am                         15120 non-null int64
Hillshade_Noon                        15120 non-null int64
Hillshade_3pm                         15120 non-null int64
Horizontal_Distance_To_Fire_Points    15120 non-null int64
Wilderness_Area1                      15120 non-null int64
Wilderness_Area2                      15120 non-null int64
Wilderness_Area3                      15120 non-null int64
Wilderness_Area4                      15120 non-null int64
Soil_Type1                            15120 non-null int64
Soil_Type2                            15120 non-null int64
Soil_Type3                            15120 non-null int64
Soil_Type4                            15120 non-null int64
Soil_Type5                            15120 non-null int64
Soil_Type6                            15120 non-null int64
Soil_Type7                            15120 non-null int64
Soil_Type8                            15120 non-null int64
Soil_Type9                            15120 non-null int64
Soil_Type10                           15120 non-null int64
Soil_Type11                           15120 non-null int64
Soil_Type12                           15120 non-null int64
Soil_Type13                           15120 non-null int64
Soil_Type14                           15120 non-null int64
Soil_Type15                           15120 non-null int64
Soil_Type16                           15120 non-null int64
Soil_Type17                           15120 non-null int64
Soil_Type18                           15120 non-null int64
Soil_Type19                           15120 non-null int64
Soil_Type20                           15120 non-null int64
Soil_Type21                           15120 non-null int64
Soil_Type22                           15120 non-null int64
Soil_Type23                           15120 non-null int64
Soil_Type24                           15120 non-null int64
Soil_Type25                           15120 non-null int64
Soil_Type26                           15120 non-null int64
Soil_Type27                           15120 non-null int64
Soil_Type28                           15120 non-null int64
Soil_Type29                           15120 non-null int64
Soil_Type30                           15120 non-null int64
Soil_Type31                           15120 non-null int64
Soil_Type32                           15120 non-null int64
Soil_Type33                           15120 non-null int64
Soil_Type34                           15120 non-null int64
Soil_Type35                           15120 non-null int64
Soil_Type36                           15120 non-null int64
Soil_Type37                           15120 non-null int64
Soil_Type38                           15120 non-null int64
Soil_Type39                           15120 non-null int64
Soil_Type40                           15120 non-null int64
Cover_Type                            15120 non-null int64
dtypes: int64(55)
memory usage: 6.3 MB
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># explore data
</span><span class="n">test</span><span class="p">.</span><span class="nf">info</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 565892 entries, 0 to 565891
Data columns (total 54 columns):
Elevation                             565892 non-null int64
Aspect                                565892 non-null int64
Slope                                 565892 non-null int64
Horizontal_Distance_To_Hydrology      565892 non-null int64
Vertical_Distance_To_Hydrology        565892 non-null int64
Horizontal_Distance_To_Roadways       565892 non-null int64
Hillshade_9am                         565892 non-null int64
Hillshade_Noon                        565892 non-null int64
Hillshade_3pm                         565892 non-null int64
Horizontal_Distance_To_Fire_Points    565892 non-null int64
Wilderness_Area1                      565892 non-null int64
Wilderness_Area2                      565892 non-null int64
Wilderness_Area3                      565892 non-null int64
Wilderness_Area4                      565892 non-null int64
Soil_Type1                            565892 non-null int64
Soil_Type2                            565892 non-null int64
Soil_Type3                            565892 non-null int64
Soil_Type4                            565892 non-null int64
Soil_Type5                            565892 non-null int64
Soil_Type6                            565892 non-null int64
Soil_Type7                            565892 non-null int64
Soil_Type8                            565892 non-null int64
Soil_Type9                            565892 non-null int64
Soil_Type10                           565892 non-null int64
Soil_Type11                           565892 non-null int64
Soil_Type12                           565892 non-null int64
Soil_Type13                           565892 non-null int64
Soil_Type14                           565892 non-null int64
Soil_Type15                           565892 non-null int64
Soil_Type16                           565892 non-null int64
Soil_Type17                           565892 non-null int64
Soil_Type18                           565892 non-null int64
Soil_Type19                           565892 non-null int64
Soil_Type20                           565892 non-null int64
Soil_Type21                           565892 non-null int64
Soil_Type22                           565892 non-null int64
Soil_Type23                           565892 non-null int64
Soil_Type24                           565892 non-null int64
Soil_Type25                           565892 non-null int64
Soil_Type26                           565892 non-null int64
Soil_Type27                           565892 non-null int64
Soil_Type28                           565892 non-null int64
Soil_Type29                           565892 non-null int64
Soil_Type30                           565892 non-null int64
Soil_Type31                           565892 non-null int64
Soil_Type32                           565892 non-null int64
Soil_Type33                           565892 non-null int64
Soil_Type34                           565892 non-null int64
Soil_Type35                           565892 non-null int64
Soil_Type36                           565892 non-null int64
Soil_Type37                           565892 non-null int64
Soil_Type38                           565892 non-null int64
Soil_Type39                           565892 non-null int64
Soil_Type40                           565892 non-null int64
dtypes: int64(54)
memory usage: 233.1 MB
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># explore data
</span><span class="n">train</span><span class="p">.</span><span class="nf">describe</span><span class="p">()</span>
</code></pre></div></div>

<div style="overflow-x:auto;">
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Elevation</th>
      <th>Aspect</th>
      <th>Slope</th>
      <th>Horizontal_Distance_To_Hydrology</th>
      <th>Vertical_Distance_To_Hydrology</th>
      <th>Horizontal_Distance_To_Roadways</th>
      <th>Hillshade_9am</th>
      <th>Hillshade_Noon</th>
      <th>Hillshade_3pm</th>
      <th>Horizontal_Distance_To_Fire_Points</th>
      <th>...</th>
      <th>Soil_Type32</th>
      <th>Soil_Type33</th>
      <th>Soil_Type34</th>
      <th>Soil_Type35</th>
      <th>Soil_Type36</th>
      <th>Soil_Type37</th>
      <th>Soil_Type38</th>
      <th>Soil_Type39</th>
      <th>Soil_Type40</th>
      <th>Cover_Type</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>15120.000000</td>
      <td>15120.000000</td>
      <td>15120.000000</td>
      <td>15120.000000</td>
      <td>15120.000000</td>
      <td>15120.000000</td>
      <td>15120.000000</td>
      <td>15120.000000</td>
      <td>15120.000000</td>
      <td>15120.000000</td>
      <td>...</td>
      <td>15120.000000</td>
      <td>15120.000000</td>
      <td>15120.000000</td>
      <td>15120.000000</td>
      <td>15120.000000</td>
      <td>15120.000000</td>
      <td>15120.000000</td>
      <td>15120.000000</td>
      <td>15120.000000</td>
      <td>15120.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>2749.322553</td>
      <td>156.676653</td>
      <td>16.501587</td>
      <td>227.195701</td>
      <td>51.076521</td>
      <td>1714.023214</td>
      <td>212.704299</td>
      <td>218.965608</td>
      <td>135.091997</td>
      <td>1511.147288</td>
      <td>...</td>
      <td>0.045635</td>
      <td>0.040741</td>
      <td>0.001455</td>
      <td>0.006746</td>
      <td>0.000661</td>
      <td>0.002249</td>
      <td>0.048148</td>
      <td>0.043452</td>
      <td>0.030357</td>
      <td>4.000000</td>
    </tr>
    <tr>
      <th>std</th>
      <td>417.678187</td>
      <td>110.085801</td>
      <td>8.453927</td>
      <td>210.075296</td>
      <td>61.239406</td>
      <td>1325.066358</td>
      <td>30.561287</td>
      <td>22.801966</td>
      <td>45.895189</td>
      <td>1099.936493</td>
      <td>...</td>
      <td>0.208699</td>
      <td>0.197696</td>
      <td>0.038118</td>
      <td>0.081859</td>
      <td>0.025710</td>
      <td>0.047368</td>
      <td>0.214086</td>
      <td>0.203880</td>
      <td>0.171574</td>
      <td>2.000066</td>
    </tr>
    <tr>
      <th>min</th>
      <td>1863.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>-146.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>99.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>...</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>2376.000000</td>
      <td>65.000000</td>
      <td>10.000000</td>
      <td>67.000000</td>
      <td>5.000000</td>
      <td>764.000000</td>
      <td>196.000000</td>
      <td>207.000000</td>
      <td>106.000000</td>
      <td>730.000000</td>
      <td>...</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>2.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>2752.000000</td>
      <td>126.000000</td>
      <td>15.000000</td>
      <td>180.000000</td>
      <td>32.000000</td>
      <td>1316.000000</td>
      <td>220.000000</td>
      <td>223.000000</td>
      <td>138.000000</td>
      <td>1256.000000</td>
      <td>...</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>4.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>3104.000000</td>
      <td>261.000000</td>
      <td>22.000000</td>
      <td>330.000000</td>
      <td>79.000000</td>
      <td>2270.000000</td>
      <td>235.000000</td>
      <td>235.000000</td>
      <td>167.000000</td>
      <td>1988.250000</td>
      <td>...</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>6.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>3849.000000</td>
      <td>360.000000</td>
      <td>52.000000</td>
      <td>1343.000000</td>
      <td>554.000000</td>
      <td>6890.000000</td>
      <td>254.000000</td>
      <td>254.000000</td>
      <td>248.000000</td>
      <td>6993.000000</td>
      <td>...</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>7.000000</td>
    </tr>
  </tbody>
</table>
<p>8 rows × 55 columns</p>
</div>

<p>The datasets appear to be complete. There is no need to fill missing value or to drop records.</p>

<hr />
<p><a id="Section_2"></a></p>
<h2 id="2-tool-functions">2. Tool Functions</h2>
<p>The following functions are created to help the data exploration.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">t_test_feature</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">feature_name</span><span class="p">,</span> <span class="n">class_feature_name</span><span class="p">,</span> <span class="n">same_variance</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">sign_level</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sh">'''</span><span class="s">
    Perform t-test hypothesis testing and return a heatmap of the results:
    
    Significance level (alpha) : 0.05
    Null hypothesis (Ho): The two classes of the target feature have the same mean for the selected feature.
    Alternative hypothesis (Ha): The two classes of the target feature do not have the same mean for the selected feature.
    
    Inputs:
    df--input dataframe (pandas.DataFrame)
    feature_name--name of the feature to be considered for the hypothesis testing (string)
    class_feature_name--name of the target feature (string). The records are divided into classes corresponding to the classes of the class_feature_name.
    same_variance--should the variances of the two populations be considered equal (boolean)
    sign_level--threshold used to reject the null hypothesis.
    ax--axes to be used for plot (matplotlib.axes)
    
    Outputs:
    pvalues--pvalues of the hypothesis testing.
    plot--seaborn heatmap of the results of the hypothesis testing.
    </span><span class="sh">'''</span>
    
    <span class="c1"># isolate classes of Cover_Type:
</span>    <span class="n">classes</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">class_feature_name</span><span class="p">].</span><span class="nf">unique</span><span class="p">().</span><span class="nf">tolist</span><span class="p">()</span>
    <span class="n">classes</span><span class="p">.</span><span class="nf">sort</span><span class="p">()</span>
    
    <span class="c1"># iterate over classes and perform T-test hypothesis testing for identical mean
</span>    <span class="n">pvalues</span> <span class="o">=</span>  <span class="n">np</span><span class="p">.</span><span class="nf">full</span><span class="p">([</span><span class="nf">len</span><span class="p">(</span><span class="n">classes</span><span class="p">),</span><span class="nf">len</span><span class="p">(</span><span class="n">classes</span><span class="p">)],</span> <span class="n">np</span><span class="p">.</span><span class="n">nan</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">class_i</span> <span class="ow">in</span> <span class="n">classes</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">class_j</span> <span class="ow">in</span> <span class="n">classes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">class_i</span><span class="o">&gt;</span><span class="n">class_j</span><span class="p">:</span>
                
                <span class="c1"># isolate records for class i
</span>                <span class="n">records_i</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">class_feature_name</span><span class="p">]</span><span class="o">==</span><span class="n">class_i</span><span class="p">,</span><span class="n">feature_name</span><span class="p">]</span>
                
                <span class="c1"># isolate records for class j
</span>                <span class="n">records_j</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">class_feature_name</span><span class="p">]</span><span class="o">==</span><span class="n">class_j</span><span class="p">,</span><span class="n">feature_name</span><span class="p">]</span>
                
                <span class="c1"># compute pvalue and store in array
</span>                <span class="n">_</span><span class="p">,</span> <span class="n">pvalue</span> <span class="o">=</span> <span class="nf">ttest_ind</span><span class="p">(</span><span class="n">records_i</span><span class="p">,</span> <span class="n">records_j</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">equal_var</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">nan_policy</span><span class="o">=</span><span class="sh">'</span><span class="s">omit</span><span class="sh">'</span><span class="p">)</span>
                <span class="n">pvalues</span><span class="p">[</span><span class="n">class_i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">class_j</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">pvalue</span>
                
    <span class="c1"># filter p-value (pvalue&lt;sign_level)
</span>    <span class="n">pvalues</span> <span class="o">=</span> <span class="n">pvalues</span><span class="o">&gt;</span><span class="n">sign_level</span>
    
    <span class="c1"># generate a mask for the upper triangle
</span>    <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros_like</span><span class="p">(</span><span class="n">pvalues</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="nb">bool</span><span class="p">)</span>
    <span class="n">mask</span><span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="nf">triu_indices_from</span><span class="p">(</span><span class="n">mask</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">True</span>
    
    <span class="c1"># plot heatmat
</span>    <span class="n">cmap</span> <span class="o">=</span> <span class="n">sns</span><span class="p">.</span><span class="nf">diverging_palette</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">220</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="c1"># create plot if no plot exists
</span>    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
    
    <span class="c1"># plot heatmap
</span>    <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="p">.</span><span class="nf">heatmap</span><span class="p">(</span><span class="n">pvalues</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                     <span class="n">square</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="n">cbar_kws</span><span class="o">=</span><span class="p">{</span><span class="sh">"</span><span class="s">shrink</span><span class="sh">"</span><span class="p">:</span> <span class="p">.</span><span class="mi">3</span><span class="p">})</span>
    
    <span class="c1"># set colorbar properties
</span>    <span class="n">ax</span><span class="p">.</span><span class="n">collections</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">colorbar</span><span class="p">.</span><span class="nf">set_ticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.25</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.75</span> <span class="p">,</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">.</span><span class="n">collections</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">colorbar</span><span class="p">.</span><span class="n">ax</span><span class="p">.</span><span class="nf">set_yticklabels</span><span class="p">([</span><span class="sh">''</span><span class="p">,</span><span class="sh">'</span><span class="s">p&lt;α</span><span class="sh">'</span><span class="p">,</span><span class="sh">''</span><span class="p">,</span><span class="sh">'</span><span class="s">p&gt;α</span><span class="sh">'</span><span class="p">,</span><span class="sh">''</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">.</span><span class="n">collections</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">colorbar</span><span class="p">.</span><span class="n">ax</span><span class="p">.</span><span class="nf">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    
    <span class="c1"># set plot title and tick properties
</span>    <span class="n">ax</span><span class="p">.</span><span class="nf">set_title</span><span class="p">(</span><span class="sh">'</span><span class="s">T-test: Identical Mean (α=0.05)</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">.</span><span class="nf">set_yticklabels</span><span class="p">(</span><span class="n">classes</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">.</span><span class="nf">set_xticklabels</span><span class="p">(</span><span class="n">classes</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">pvalues</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">plot_3_plots</span><span class="p">(</span><span class="n">feature</span><span class="p">):</span>
    <span class="sh">'''</span><span class="s">
    Plot:
    1--boxplot of feature data per Cover Type
    2--histogram of feature data per Cover Type
    3--t-test hypothesis testing resuts   
    </span><span class="sh">'''</span>
    <span class="n">sns</span><span class="p">.</span><span class="nf">set</span><span class="p">()</span>
    <span class="n">sns</span><span class="p">.</span><span class="nf">set_palette</span><span class="p">(</span><span class="n">palette</span> <span class="o">=</span> <span class="n">mycols</span><span class="p">,</span> <span class="n">n_colors</span> <span class="o">=</span> <span class="mi">7</span><span class="p">)</span>
    
    <span class="n">fig</span><span class="p">,</span> <span class="n">axarr</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">figsize</span> <span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">fig</span><span class="p">.</span><span class="nf">suptitle</span><span class="p">(</span><span class="n">feature</span><span class="p">.</span><span class="nf">upper</span><span class="p">(),</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    
    <span class="c1"># boxplot
</span>    <span class="n">sns</span><span class="p">.</span><span class="nf">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="sh">'</span><span class="s">Cover_Type</span><span class="sh">'</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">feature</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">train</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axarr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">axarr</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">train</span><span class="p">[</span><span class="n">feature</span><span class="p">].</span><span class="nf">max</span><span class="p">()</span><span class="o">*</span><span class="mf">1.10</span><span class="p">)</span>
    
    <span class="c1"># barplot   
</span>    <span class="n">sns</span><span class="p">.</span><span class="nf">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="sh">'</span><span class="s">Cover_Type</span><span class="sh">'</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">feature</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">train</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axarr</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ci</span><span class="o">=</span><span class="sh">'</span><span class="s">sd</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">axarr</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nf">set_ylim</span><span class="p">(</span><span class="n">axarr</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">get_ylim</span><span class="p">())</span>
    <span class="n">axarr</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nf">set_yticklabels</span><span class="p">([])</span>
    <span class="n">axarr</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nf">set_ylabel</span><span class="p">(</span><span class="sh">''</span><span class="p">)</span>
    
    <span class="c1"># ttest   
</span>    <span class="nf">t_test_feature</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">feature</span><span class="p">,</span> <span class="sh">'</span><span class="s">Cover_Type</span><span class="sh">'</span><span class="p">,</span> <span class="n">same_variance</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">sign_level</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axarr</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    
    <span class="k">return</span> <span class="bp">None</span><span class="p">;</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">plot_continuous_features</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">feature_name</span><span class="p">,</span> <span class="n">class_feature_name</span><span class="p">):</span>
    <span class="sh">'''</span><span class="s">
    Return multiple plots used to inspect a continuous feature. One stacked histogram and one kde plot are produced.
    
    Inputs:
    df--input dataframe (pandas.DataFrame)
    feature_name--name of the continuous feature to be inspected (string)
    class_feature_name--name of the class feature (string)
    
    Output:
    None
    </span><span class="sh">'''</span>
    <span class="n">sns</span><span class="p">.</span><span class="nf">set</span><span class="p">()</span>
    <span class="c1"># isolate feature records for each class
</span>    <span class="n">values_per_class</span> <span class="o">=</span> <span class="p">[</span><span class="n">df</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">class_feature_name</span><span class="p">]</span><span class="o">==</span><span class="n">i</span><span class="p">,</span><span class="n">feature_name</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="p">.</span><span class="nf">sort</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">class_feature_name</span><span class="p">].</span><span class="nf">unique</span><span class="p">())]</span>

    <span class="c1"># create figure
</span>    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">12</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">set_title</span><span class="p">(</span><span class="n">feature_name</span><span class="p">.</span><span class="nf">upper</span><span class="p">(),</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    
    <span class="c1"># plot histogram, assign legend and scale y axis
</span>    <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">patches</span><span class="p">)</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">hist</span><span class="p">(</span><span class="n">values_per_class</span><span class="p">,</span><span class="n">stacked</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">mycols</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">7</span><span class="p">])</span>
    
    <span class="c1"># add legend to plot
</span>    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">legend</span><span class="p">([</span><span class="sh">'</span><span class="s">1 - Spruce/Fir</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">2 - Lodgepole Pine</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">3 - Ponderosa Pine</span><span class="sh">'</span><span class="p">,</span>
                    <span class="sh">'</span><span class="s">4 - Cottonwood/Willow</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">5 - Aspen</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">6 - Douglas-fir</span><span class="sh">'</span><span class="p">,</span>
                    <span class="sh">'</span><span class="s">7 - Krummholz</span><span class="sh">'</span><span class="p">]);</span>

    <span class="c1"># histogram upper value and round to upper 100
</span>    <span class="n">y_max</span> <span class="o">=</span> <span class="n">n</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">].</span><span class="nf">max</span><span class="p">()</span> <span class="o">*</span> <span class="mf">1.05</span>
    <span class="n">y_max</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="n">math</span><span class="p">.</span><span class="nf">ceil</span><span class="p">(</span><span class="n">y_max</span> <span class="o">/</span> <span class="mf">100.0</span><span class="p">))</span> <span class="o">*</span> <span class="mi">100</span>   
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">set_ylim</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="n">y_max</span><span class="p">))</span>
    
    <span class="k">for</span> <span class="n">ix</span><span class="p">,</span> <span class="n">el</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">values_per_class</span><span class="p">):</span>
        <span class="n">sns</span><span class="p">.</span><span class="nf">kdeplot</span><span class="p">(</span><span class="n">el</span><span class="p">,</span><span class="n">shade</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="n">mycols</span><span class="p">[</span><span class="n">ix</span><span class="p">],</span>
                    <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="c1"># add legend to plot
</span>    <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">1 - Spruce/Fir</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">2 - Lodgepole Pine</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">3 - Ponderosa Pine</span><span class="sh">'</span><span class="p">,</span>
                    <span class="sh">'</span><span class="s">4 - Cottonwood/Willow</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">5 - Aspen</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">6 - Douglas-fir</span><span class="sh">'</span><span class="p">,</span>
                    <span class="sh">'</span><span class="s">7 - Krummholz</span><span class="sh">'</span><span class="p">]</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nf">legend</span><span class="p">(</span><span class="n">labels</span><span class="p">);</span>
        
    <span class="c1"># Initialize the FacetGrid object
</span>    <span class="n">df</span> <span class="o">=</span> <span class="n">train</span><span class="p">[[</span><span class="n">feature_name</span><span class="p">,</span><span class="n">class_feature_name</span><span class="p">]]</span>
    
    
    <span class="c1">#sns.p(palette = mycols, n_colors = 7)
</span>    <span class="n">sns</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="sh">"</span><span class="s">white</span><span class="sh">"</span><span class="p">,</span> <span class="n">rc</span><span class="o">=</span><span class="p">{</span><span class="sh">"</span><span class="s">axes.facecolor</span><span class="sh">"</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)})</span>
    <span class="c1">#pal = sns.cubehelix_palette(10, rot=-.25, light=.7)
</span>    <span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="p">.</span><span class="nc">FacetGrid</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">class_feature_name</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="n">class_feature_name</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="n">mycols</span><span class="p">)</span>
    
    <span class="c1"># Draw the densities in a few steps
</span>    <span class="n">g</span><span class="p">.</span><span class="nf">map</span><span class="p">(</span><span class="n">sns</span><span class="p">.</span><span class="n">kdeplot</span><span class="p">,</span> <span class="n">feature_name</span><span class="p">,</span> <span class="n">clip_on</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">shade</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">bw</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">g</span><span class="p">.</span><span class="nf">map</span><span class="p">(</span><span class="n">sns</span><span class="p">.</span><span class="n">kdeplot</span><span class="p">,</span> <span class="n">feature_name</span><span class="p">,</span> <span class="n">clip_on</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="sh">"</span><span class="s">w</span><span class="sh">"</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">bw</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">g</span><span class="p">.</span><span class="nf">map</span><span class="p">(</span><span class="n">plt</span><span class="p">.</span><span class="n">axhline</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">clip_on</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

    <span class="n">g</span><span class="p">.</span><span class="nf">map</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">feature_name</span><span class="p">)</span>
    
    <span class="c1"># Set the subplots to overlap
</span>    <span class="n">g</span><span class="p">.</span><span class="n">fig</span><span class="p">.</span><span class="nf">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=-</span><span class="mf">0.50</span><span class="p">)</span>
    <span class="c1"># Remove axes details that don't play well with overlap
</span>    <span class="n">g</span><span class="p">.</span><span class="nf">set_titles</span><span class="p">(</span><span class="sh">""</span><span class="p">)</span>
    <span class="n">g</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="n">yticks</span><span class="o">=</span><span class="p">[])</span>
    <span class="n">g</span><span class="p">.</span><span class="nf">despine</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="nf">show</span><span class="p">();</span>
    <span class="k">return</span> <span class="bp">None</span><span class="p">;</span>

<span class="c1"># Define and use a simple function to label the plot in axes coordinates
</span><span class="k">def</span> <span class="nf">label</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">gca</span><span class="p">()</span>
    <span class="n">ax</span><span class="p">.</span><span class="nf">text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">.</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="sh">"</span><span class="s">bold</span><span class="sh">"</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
            <span class="n">ha</span><span class="o">=</span><span class="sh">"</span><span class="s">left</span><span class="sh">"</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="sh">"</span><span class="s">center</span><span class="sh">"</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="p">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">plot_multiple_boolean_subclasses</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">feature_root_name</span><span class="p">,</span> <span class="n">class_feature_name</span><span class="p">):</span>
    <span class="sh">'''</span><span class="s">
    Plot the histogram of any boolean feature divided into subclasses.
    
    Inputs:
    df--input dataframe (pandas.DataFrame)
    feature_root_name--root of the feature divided into subclasses (string)
    class_feature_name--feature to predict (string)
    </span><span class="sh">'''</span>
    
    <span class="c1"># create list of features based on root name
</span>    <span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="p">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">feature_root_name</span> <span class="ow">in</span> <span class="n">col</span><span class="p">]</span>
    
    <span class="c1"># group by and count number of positive record per subclass
</span>    <span class="n">grouped_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">groupby</span><span class="p">(</span><span class="n">class_feature_name</span><span class="p">)[</span><span class="n">features</span><span class="p">].</span><span class="nf">sum</span><span class="p">().</span><span class="n">T</span>

    <span class="c1"># define width of plot based on number of subclasses
</span>    <span class="n">subclass_count</span> <span class="o">=</span> <span class="nf">len</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
    <span class="n">plot_width</span> <span class="o">=</span> <span class="nf">min</span><span class="p">(</span><span class="nf">max</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="n">subclass_count</span><span class="o">+</span><span class="mi">4</span><span class="p">),</span> <span class="nf">min</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="n">subclass_count</span><span class="o">+</span><span class="mi">4</span><span class="p">))</span>

    <span class="c1"># create figure and plot results
</span>    <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">plot_width</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">grouped_df</span><span class="p">.</span><span class="n">plot</span><span class="p">.</span><span class="nf">bar</span><span class="p">(</span><span class="n">stacked</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">mycols</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">);</span>
    
    <span class="k">return</span> <span class="bp">None</span><span class="p">;</span>
</code></pre></div></div>

<hr />
<p><a id="Section_3"></a></p>
<h2 id="3-data-exploration">3. Data Exploration</h2>

<hr />
<p><a id="Section_3_1"></a></p>
<h3 id="31-class-distribution">3.1. Class Distribution</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Plot sample distribution
</span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">train</span><span class="p">[</span><span class="sh">'</span><span class="s">Cover_Type</span><span class="sh">'</span><span class="p">].</span><span class="nf">value_counts</span><span class="p">().</span><span class="nf">sort_index</span><span class="p">().</span><span class="nf">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="sh">'</span><span class="s">bar</span><span class="sh">'</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">mycols</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">title</span><span class="p">(</span><span class="sh">'</span><span class="s">Sample distribution</span><span class="sh">'</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">xlabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Cover_Type</span><span class="sh">'</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">ylabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Count</span><span class="sh">'</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">);</span>
<span class="nf">print</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="sh">'</span><span class="s">Cover_Type</span><span class="sh">'</span><span class="p">].</span><span class="nf">value_counts</span><span class="p">().</span><span class="nf">sort_index</span><span class="p">());</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1    2160
2    2160
3    2160
4    2160
5    2160
6    2160
7    2160
Name: Cover_Type, dtype: int64
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-07-15-Forest-Cover/output_25_1.png" />
</figure>

<p>The target feature is homogeneously distributed amongst all 7 output classes.</p>

<p><a id="Section_3_2"></a></p>
<h3 id="32-elevation">3.2. Elevation</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">plot_continuous_features</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="sh">'</span><span class="s">Elevation</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Cover_Type</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-07-15-Forest-Cover/output_28_0.png" />
</figure>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-07-15-Forest-Cover/output_28_1.png" />
</figure>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">plot_3_plots</span><span class="p">(</span><span class="sh">'</span><span class="s">Elevation</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-07-15-Forest-Cover/output_29_0.png" />
</figure>

<p>It can be observed from the above plots that the Cover Type can be fairly well separated using the elevation feature.</p>

<p><a id="Section_3_3"></a></p>
<h3 id="33-aspect">3.3. Aspect</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">plot_continuous_features</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="sh">'</span><span class="s">Aspect</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Cover_Type</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-07-15-Forest-Cover/output_32_0.png" />
</figure>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-07-15-Forest-Cover/output_32_1.png" />
</figure>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">plot_3_plots</span><span class="p">(</span><span class="sh">'</span><span class="s">Aspect</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-07-15-Forest-Cover/output_33_0.png" />
</figure>

<p>The Aspect feature does not appear to be a good class separator. Indeed, the t-test reveals several failures to reject the identical mean hypothesis (1-7, 2-7, 3-6, 4-6).</p>

<p><a id="Section_3_4"></a></p>
<h3 id="34-slope">3.4. Slope</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">plot_continuous_features</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="sh">'</span><span class="s">Slope</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Cover_Type</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-07-15-Forest-Cover/output_36_0.png" />
</figure>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-07-15-Forest-Cover/output_36_1.png" />
</figure>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">plot_3_plots</span><span class="p">(</span><span class="sh">'</span><span class="s">Slope</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-07-15-Forest-Cover/output_37_0.png" />
</figure>

<p><a id="Section_3_5"></a></p>
<h3 id="35-horizontal-distance-to-hydrology">3.5. Horizontal Distance To Hydrology</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">plot_continuous_features</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="sh">'</span><span class="s">Horizontal_Distance_To_Hydrology</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Cover_Type</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-07-15-Forest-Cover/output_39_0.png" />
</figure>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-07-15-Forest-Cover/output_39_1.png" />
</figure>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">plot_3_plots</span><span class="p">(</span><span class="sh">'</span><span class="s">Horizontal_Distance_To_Hydrology</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-07-15-Forest-Cover/output_40_0.png" />
</figure>

<p>Based on the above plots, the data seems to be distributed according to a log distribution. In order to facilitate the classification, the log of the Horizontal Distance to Hydrology can be used.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">train</span><span class="p">[</span><span class="sh">'</span><span class="s">log_Horizontal_Distance_To_Hydrology</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="sh">'</span><span class="s">Horizontal_Distance_To_Hydrology</span><span class="sh">'</span><span class="p">].</span><span class="nf">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="o">&gt;</span><span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
<span class="nf">plot_continuous_features</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="sh">'</span><span class="s">log_Horizontal_Distance_To_Hydrology</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Cover_Type</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-07-15-Forest-Cover/output_42_0.png" />
</figure>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-07-15-Forest-Cover/output_42_1.png" />
</figure>

<p><a id="Section_3_6"></a></p>
<h3 id="36-vertical-distance-to-hydrology">3.6. Vertical Distance To Hydrology</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">plot_continuous_features</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="sh">'</span><span class="s">Vertical_Distance_To_Hydrology</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Cover_Type</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-07-15-Forest-Cover/output_44_0.png" />
</figure>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-07-15-Forest-Cover/output_44_1.png" />
</figure>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">plot_3_plots</span><span class="p">(</span><span class="sh">'</span><span class="s">Vertical_Distance_To_Hydrology</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-07-15-Forest-Cover/output_45_0.png" />
</figure>

<p>Similarly to the previous feature, the data seems to be distributed according to a log distribution. In order to facilitate the classification, the log of the Vertical Distance to Hydrology can be used.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">train</span><span class="p">[</span><span class="sh">'</span><span class="s">log_Vertical_Distance_To_Hydrology</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="sh">'</span><span class="s">Vertical_Distance_To_Hydrology</span><span class="sh">'</span><span class="p">].</span><span class="nf">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="o">&gt;</span><span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
<span class="nf">plot_continuous_features</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="sh">'</span><span class="s">log_Vertical_Distance_To_Hydrology</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Cover_Type</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-07-15-Forest-Cover/output_47_0.png" />
</figure>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-07-15-Forest-Cover/output_47_1.png" />
</figure>

<p><a id="Section_3_7"></a></p>
<h3 id="37-horizontal-distance-to-roadways">3.7. Horizontal Distance To Roadways</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">plot_continuous_features</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="sh">'</span><span class="s">Horizontal_Distance_To_Roadways</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Cover_Type</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-07-15-Forest-Cover/output_49_0.png" />
</figure>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-07-15-Forest-Cover/output_49_1.png" />
</figure>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">plot_3_plots</span><span class="p">(</span><span class="sh">'</span><span class="s">Horizontal_Distance_To_Roadways</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-07-15-Forest-Cover/output_50_0.png" />
</figure>

<p><a id="Section_3_8"></a></p>
<h3 id="38-hillshade-9am">3.8. Hillshade 9am</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">plot_continuous_features</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="sh">'</span><span class="s">Hillshade_9am</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Cover_Type</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-07-15-Forest-Cover/output_52_0.png" />
</figure>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-07-15-Forest-Cover/output_52_1.png" />
</figure>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">plot_3_plots</span><span class="p">(</span><span class="sh">'</span><span class="s">Hillshade_9am</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-07-15-Forest-Cover/output_53_0.png" />
</figure>

<p><a id="Section_3_9"></a></p>
<h3 id="39-hillshade-noon">3.9. Hillshade Noon</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">plot_continuous_features</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="sh">'</span><span class="s">Hillshade_Noon</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Cover_Type</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-07-15-Forest-Cover/output_55_0.png" />
</figure>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-07-15-Forest-Cover/output_55_1.png" />
</figure>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">plot_3_plots</span><span class="p">(</span><span class="sh">'</span><span class="s">Hillshade_Noon</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-07-15-Forest-Cover/output_56_0.png" />
</figure>

<p><a id="Section_3_10"></a></p>
<h3 id="310-hillshade-3-pm">3.10. Hillshade 3 PM</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">plot_continuous_features</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="sh">'</span><span class="s">Hillshade_3pm</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Cover_Type</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-07-15-Forest-Cover/output_58_0.png" />
</figure>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-07-15-Forest-Cover/output_58_1.png" />
</figure>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">plot_3_plots</span><span class="p">(</span><span class="sh">'</span><span class="s">Hillshade_3pm</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-07-15-Forest-Cover/output_59_0.png" />
</figure>

<p><a id="Section_3_11"></a></p>
<h3 id="311-horizontal-distance-to-fire-points">3.11. Horizontal Distance To Fire Points</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">plot_continuous_features</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="sh">'</span><span class="s">Horizontal_Distance_To_Fire_Points</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Cover_Type</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-07-15-Forest-Cover/output_61_0.png" />
</figure>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-07-15-Forest-Cover/output_61_1.png" />
</figure>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">plot_3_plots</span><span class="p">(</span><span class="sh">'</span><span class="s">Horizontal_Distance_To_Fire_Points</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-07-15-Forest-Cover/output_62_0.png" />
</figure>

<p><a id="Section_3_12"></a></p>
<h3 id="312-wilderness-areas">3.12. Wilderness Areas</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">plot_multiple_boolean_subclasses</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="sh">'</span><span class="s">Wilderness_Area</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Cover_Type</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-07-15-Forest-Cover/output_64_0.png" />
</figure>

<p>From the above plot, it can be seen that not every Cover Type is contained in each Wilderness Areas. For instance, the cover type “Ponderosa Pin” (3) is not present in the first two Wilderness Areas (Rawah Wilderness and Neota Wilderness Areas).</p>

<p><a id="Section_3_13"></a></p>
<h3 id="313-soil-type">3.13. Soil Type</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">plot_multiple_boolean_subclasses</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="sh">'</span><span class="s">Soil_Type</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Cover_Type</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-07-15-Forest-Cover/output_67_0.png" />
</figure>

<p>Several soil type do not contain any cover type. These features will be deleted.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Data distribution
</span><span class="n">train</span><span class="p">.</span><span class="nf">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">).</span><span class="nf">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="bp">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Soil_Type15     0.0
Soil_Type7      0.0
Soil_Type25     1.0
Soil_Type8      1.0
Soil_Type28     9.0
Soil_Type36    10.0
Soil_Type9     10.0
Soil_Type27    15.0
Soil_Type21    16.0
Soil_Type34    22.0
dtype: float64
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># drop empty soil types
</span><span class="k">def</span> <span class="nf">drop_empty_soil</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">test</span><span class="p">):</span>
    <span class="sh">'''</span><span class="s">drop the Soil_Type7 and Soil_Type15 features of train and test DataFrame.</span><span class="sh">'''</span>
    <span class="n">train</span> <span class="o">=</span> <span class="n">train</span><span class="p">.</span><span class="nf">drop</span><span class="p">([</span><span class="sh">'</span><span class="s">Soil_Type7</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Soil_Type15</span><span class="sh">'</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">test</span> <span class="o">=</span> <span class="n">test</span><span class="p">.</span><span class="nf">drop</span><span class="p">([</span><span class="sh">'</span><span class="s">Soil_Type7</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Soil_Type15</span><span class="sh">'</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">train</span><span class="p">,</span> <span class="n">test</span>

<span class="c1"># drop empty features
</span><span class="n">train</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="nf">drop_empty_soil</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">test</span><span class="p">)</span>
</code></pre></div></div>

<p><a id="Section_3_14"></a></p>
<h3 id="314-feature-correlation">3.14. Feature Correlation</h3>

<p>We produce a pair plot to evaluate the correlation between the target and the predictors.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Compute the correlation matrix
</span><span class="n">corr</span> <span class="o">=</span> <span class="n">train</span><span class="p">[[</span><span class="sh">'</span><span class="s">Elevation</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Aspect</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Slope</span><span class="sh">'</span><span class="p">,</span>
       <span class="sh">'</span><span class="s">Horizontal_Distance_To_Hydrology</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Vertical_Distance_To_Hydrology</span><span class="sh">'</span><span class="p">,</span>
       <span class="sh">'</span><span class="s">Horizontal_Distance_To_Roadways</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Hillshade_9am</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Hillshade_Noon</span><span class="sh">'</span><span class="p">,</span>
       <span class="sh">'</span><span class="s">Hillshade_3pm</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Horizontal_Distance_To_Fire_Points</span><span class="sh">'</span><span class="p">]].</span><span class="nf">corr</span><span class="p">()</span>

<span class="c1"># Generate a mask for the upper triangle
</span><span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros_like</span><span class="p">(</span><span class="n">corr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="nb">bool</span><span class="p">)</span>
<span class="n">mask</span><span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="nf">triu_indices_from</span><span class="p">(</span><span class="n">mask</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">True</span>

<span class="c1"># Set up the matplotlib figure
</span><span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">13</span><span class="p">))</span>

<span class="c1"># Generate a custom diverging colormap
</span><span class="n">cmap</span> <span class="o">=</span> <span class="n">sns</span><span class="p">.</span><span class="nf">diverging_palette</span><span class="p">(</span><span class="mi">220</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">as_cmap</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1"># Draw the heatmap with the mask and correct aspect ratio
</span><span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="p">.</span><span class="nf">heatmap</span><span class="p">(</span><span class="n">corr</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">vmin</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">annot</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
            <span class="n">square</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="n">cbar_kws</span><span class="o">=</span><span class="p">{</span><span class="sh">"</span><span class="s">shrink</span><span class="sh">"</span><span class="p">:</span> <span class="p">.</span><span class="mi">3</span><span class="p">})</span>
<span class="n">g</span><span class="p">.</span><span class="nf">set_xticklabels</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="nf">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span> <span class="o">=</span> <span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="sh">"</span><span class="s">right</span><span class="sh">"</span><span class="p">);</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-07-15-Forest-Cover/output_73_0.png" />
</figure>

<p><strong>COMMENT</strong>:
From the table above, we can notice the following large <strong>positive</strong> correlations:</p>
<ol>
  <li>0.65 between <strong>Vertical_Distance_To_Hydrology</strong> and <strong>Horizontal_Distance_To_Hydrology</strong></li>
  <li>0.64 between <strong>Hillshade_3pm</strong> and <strong>Aspect</strong></li>
  <li>0.61 between <strong>Hillshade_3pm</strong> and <strong>Hillshade_Noon</strong></li>
  <li>0.58 between <strong>Horizontal_Distance_To_Roadways</strong> and <strong>Elevation</strong></li>
</ol>

<p>From the table above, we can notice the following large <strong>negative</strong> correlations:</p>
<ol>
  <li>-0.78 between <strong>Hillshade_3pm</strong> and <strong>Hillshade_9am</strong></li>
  <li>-0.61 between <strong>Slope</strong> and <strong>Hillshade_Noon</strong></li>
  <li>-0.59 between <strong>Hillshade_9am</strong> and <strong>Aspect</strong></li>
</ol>

<hr />
<p><a id="Section_4"></a></p>
<h2 id="4-feature-engineering">4. Feature Engineering</h2>

<p>The following features will be added to the dataset:</p>

<table>
  <thead>
    <tr>
      <th>New Feature</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Hillshade_mean</td>
      <td>mean of all three hillshade values</td>
    </tr>
    <tr>
      <td>Euclidean_Distance_to_Hydrology</td>
      <td>euclidean distance to hydrology (\(\sqrt{h^{2}+v{2}}\))</td>
    </tr>
    <tr>
      <td>Has_Soil_Type</td>
      <td>is a soil type assigned to the record?</td>
    </tr>
    <tr>
      <td>Cosine_Slope</td>
      <td>cosine of slope</td>
    </tr>
    <tr>
      <td>Sine_Slope</td>
      <td>sine of slope</td>
    </tr>
    <tr>
      <td>Slope_sq</td>
      <td>slope squared</td>
    </tr>
    <tr>
      <td>Elevation_sq</td>
      <td>elevation squared</td>
    </tr>
    <tr>
      <td>Aspect_sq</td>
      <td>aspect squared</td>
    </tr>
    <tr>
      <td>Horizontal_Distance_to_Hydrology_sq</td>
      <td>horizontal distance to hydrology squared</td>
    </tr>
    <tr>
      <td>Vertical_Distance_to_Hydrology_sq</td>
      <td>vertical distance to hydrology squared</td>
    </tr>
    <tr>
      <td>Horizontal_Distance_to_Roadways_sq</td>
      <td>horizontal distance to roadways squared</td>
    </tr>
    <tr>
      <td>Horizontal_Distance_to_Fire_Points_sq</td>
      <td>horizontal distance to fire points squared</td>
    </tr>
    <tr>
      <td>H_to_F_sum</td>
      <td>Horizontal_Distance_to_Hydrology+Horizontal_Distance_to_Fire_Points</td>
    </tr>
    <tr>
      <td>H_to_F_sub</td>
      <td>Horizontal_Distance_to_Hydrology-Horizontal_Distance_to_Fire_Points</td>
    </tr>
    <tr>
      <td>H_to_R_sum</td>
      <td>Horizontal_Distance_to_Hydrology+Horizontal_Distance_to_Roadways</td>
    </tr>
    <tr>
      <td>H_to_R_sub</td>
      <td>Horizontal_Distance_to_Hydrology-Horizontal_Distance_to_Roadways</td>
    </tr>
    <tr>
      <td>R_to_F_sum</td>
      <td>Horizontal_Distance_to_Roadways+Horizontal_Distance_to_Fire_Points</td>
    </tr>
    <tr>
      <td>R_to_F_sub</td>
      <td>Horizontal_Distance_to_Roadways-Horizontal_Distance_to_Fire_Points</td>
    </tr>
    <tr>
      <td>Slope_Hydrology</td>
      <td>Vertical_Distance_to_Hydrology/Horizontal_Distance_to_Hydrology</td>
    </tr>
  </tbody>
</table>

<p>In order to process the data (train and test sets) in a consistent way, pipelines will be used. The pipeline consists of two branches: one for categorical features and the other for numerical features. Once the data going into each branch is processed, it will be re-combined into a single set.</p>

<ol>
  <li>
    <p>Numerical Features:<br />
 a. Data selection: isolate numerical features from train or test set<br />
 b. Feature engineering: create new features based on numerical data<br />
 c. Scaler: scale data using standard scaler</p>
  </li>
  <li>Categorical Features:<br />
 a. Data selection: isolate categorical features from train or test set<br />
 b. Feature engineering: create new features based on categorical data</li>
  <li>Union: combine the output of both pipelines</li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># load data
</span><span class="n">train</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_csv</span><span class="p">(</span><span class="sh">'</span><span class="s">data/train.csv</span><span class="sh">'</span><span class="p">)</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_csv</span><span class="p">(</span><span class="sh">'</span><span class="s">data/test.csv</span><span class="sh">'</span><span class="p">)</span>

<span class="c1"># save Id
</span><span class="n">train_ID</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="sh">'</span><span class="s">Id</span><span class="sh">'</span><span class="p">]</span>
<span class="n">test_ID</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="sh">'</span><span class="s">Id</span><span class="sh">'</span><span class="p">]</span>

<span class="c1"># create X and y dataframe
</span><span class="n">X_train</span> <span class="o">=</span> <span class="n">train</span><span class="p">.</span><span class="nf">drop</span><span class="p">([</span><span class="sh">'</span><span class="s">Cover_Type</span><span class="sh">'</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">).</span><span class="nf">copy</span><span class="p">()</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="sh">'</span><span class="s">Cover_Type</span><span class="sh">'</span><span class="p">].</span><span class="nf">copy</span><span class="p">()</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">test</span><span class="p">.</span><span class="nf">copy</span><span class="p">()</span>

<span class="c1"># drop iD
</span><span class="k">del</span> <span class="n">X_train</span><span class="p">[</span><span class="sh">'</span><span class="s">Id</span><span class="sh">'</span><span class="p">]</span>
<span class="k">del</span> <span class="n">X_test</span><span class="p">[</span><span class="sh">'</span><span class="s">Id</span><span class="sh">'</span><span class="p">]</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># isolate categorical and numerical feature
# different pipelines will be used
</span><span class="n">numerical_features</span> <span class="o">=</span> <span class="p">[</span>
    <span class="sh">'</span><span class="s">Elevation</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Aspect</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Slope</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Horizontal_Distance_To_Hydrology</span><span class="sh">'</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">Vertical_Distance_To_Hydrology</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Horizontal_Distance_To_Roadways</span><span class="sh">'</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">Hillshade_9am</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Hillshade_Noon</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Hillshade_3pm</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Horizontal_Distance_To_Fire_Points</span><span class="sh">'</span><span class="p">]</span>

<span class="n">catergorical_features</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">X_train</span><span class="p">.</span><span class="n">columns</span><span class="p">.</span><span class="nf">difference</span><span class="p">(</span><span class="n">numerical_features</span><span class="p">))</span>

<span class="n">new_numerical_features</span> <span class="o">=</span> <span class="p">[</span>
    <span class="sh">'</span><span class="s">log_Horizontal_Distance_To_Hydrology</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">log_Vertical_Distance_To_Hydrology</span><span class="sh">'</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">Slope_sq</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Elevation_sq</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Aspect_sq</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Horizontal_Distance_To_Hydrology_sq</span><span class="sh">'</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">Vertical_Distance_To_Hydrology_sq</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Horizontal_Distance_To_Roadways_sq</span><span class="sh">'</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">Horizontal_Distance_To_Fire_Points_sq</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Hillshade_mean</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Euclidean_Distance_to_Hydrology</span><span class="sh">'</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">Cosine_Slope</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Sine_Slope</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">H_to_F_sum</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">H_to_F_sub</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">H_to_R_sum</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">H_to_R_sub</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">R_to_F_sum</span><span class="sh">'</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">R_to_F_sub</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Slope_Hydrology</span><span class="sh">'</span><span class="p">]</span>

<span class="n">new_categorical_features</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">Has_Soil_Type</span><span class="sh">'</span><span class="p">]</span>

<span class="n">full_feature_list_with</span> <span class="o">=</span> <span class="n">numerical_features</span><span class="o">+</span><span class="n">new_numerical_features</span><span class="o">+</span><span class="n">catergorical_features</span><span class="o">+</span><span class="n">new_categorical_features</span>
<span class="n">full_feature_list_without</span> <span class="o">=</span> <span class="n">numerical_features</span><span class="o">+</span><span class="n">catergorical_features</span><span class="o">+</span><span class="n">new_categorical_features</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># import scalers
</span><span class="kn">from</span> <span class="n">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span><span class="p">,</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="n">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="n">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">FeatureUnion</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">DataFrameSelector</span><span class="p">(</span><span class="nb">BaseException</span><span class="p">,</span> <span class="n">TransformerMixin</span><span class="p">):</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">attributes_names</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">attributes_names</span> <span class="o">=</span> <span class="n">attributes_names</span>
        
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">self</span>
    
    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">X</span><span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">attributes_names</span><span class="p">]</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">NewNumericalFeatureGenerator</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span><span class="p">):</span>
    <span class="sh">'''</span><span class="s">
    Generate new features on input dataframe.
    </span><span class="sh">'''</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">add_new_features</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">add_new_features</span> <span class="o">=</span> <span class="n">add_new_features</span> 
    
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">self</span>
    
    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        
        <span class="n">df_copy</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">copy</span><span class="p">()</span>
        
        <span class="n">df_copy</span> <span class="o">=</span> <span class="n">df_copy</span><span class="p">.</span><span class="nf">astype</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">float64</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">add_new_features</span><span class="p">:</span>
        
            <span class="c1"># log features
</span>            <span class="n">log_features</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">Horizontal_Distance_To_Hydrology</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Vertical_Distance_To_Hydrology</span><span class="sh">'</span><span class="p">]</span>
            
            <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">log_features</span><span class="p">:</span>
                <span class="n">df_copy</span><span class="p">[</span><span class="sh">'</span><span class="s">log_</span><span class="sh">'</span><span class="o">+</span><span class="n">feature</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_copy</span><span class="p">[</span><span class="n">feature</span><span class="p">].</span><span class="nf">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="o">&gt;</span><span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
                
            <span class="c1"># squared features
</span>            <span class="n">squared_features</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">Slope</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Elevation</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Aspect</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Horizontal_Distance_To_Hydrology</span><span class="sh">'</span><span class="p">,</span>
                               <span class="sh">'</span><span class="s">Vertical_Distance_To_Hydrology</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Horizontal_Distance_To_Roadways</span><span class="sh">'</span><span class="p">,</span>
                               <span class="sh">'</span><span class="s">Horizontal_Distance_To_Fire_Points</span><span class="sh">'</span><span class="p">]</span>
            
            <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">squared_features</span><span class="p">:</span>
                <span class="n">df_copy</span><span class="p">[</span><span class="n">feature</span><span class="o">+</span><span class="sh">'</span><span class="s">_sq</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_copy</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
                
            <span class="c1"># Hillshade_mean
</span>            <span class="n">df_copy</span><span class="p">[</span><span class="sh">'</span><span class="s">Hillshade_mean</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df_copy</span><span class="p">[</span><span class="sh">'</span><span class="s">Hillshade_9am</span><span class="sh">'</span><span class="p">]</span><span class="o">+</span><span class="n">df_copy</span><span class="p">[</span><span class="sh">'</span><span class="s">Hillshade_Noon</span><span class="sh">'</span><span class="p">]</span><span class="o">+</span><span class="n">df_copy</span><span class="p">[</span><span class="sh">'</span><span class="s">Hillshade_3pm</span><span class="sh">'</span><span class="p">])</span><span class="o">/</span><span class="mf">3.</span>
              
            <span class="c1"># Euclidean_Distance_to_Hydrology
</span>            <span class="n">df_copy</span><span class="p">[</span><span class="sh">'</span><span class="s">Euclidean_Distance_to_Hydrology</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">df_copy</span><span class="p">[</span><span class="sh">'</span><span class="s">Horizontal_Distance_To_Hydrology_sq</span><span class="sh">'</span><span class="p">]</span><span class="o">+</span><span class="n">df_copy</span><span class="p">[</span><span class="sh">'</span><span class="s">Vertical_Distance_To_Hydrology_sq</span><span class="sh">'</span><span class="p">])</span>
                   
            <span class="c1"># Cosine_Slope
</span>            <span class="n">df_copy</span><span class="p">[</span><span class="sh">'</span><span class="s">Cosine_Slope</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">cos</span><span class="p">(</span><span class="n">df_copy</span><span class="p">[</span><span class="sh">'</span><span class="s">Slope</span><span class="sh">'</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span>
            
            <span class="c1"># Sine_Slope
</span>            <span class="n">df_copy</span><span class="p">[</span><span class="sh">'</span><span class="s">Sine_Slope</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">sin</span><span class="p">(</span><span class="n">df_copy</span><span class="p">[</span><span class="sh">'</span><span class="s">Slope</span><span class="sh">'</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span>
            
            <span class="c1"># H_to_F_sum
</span>            <span class="n">df_copy</span><span class="p">[</span><span class="sh">'</span><span class="s">H_to_F_sum</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">abs</span><span class="p">(</span><span class="n">df_copy</span><span class="p">[</span><span class="sh">'</span><span class="s">Horizontal_Distance_To_Hydrology</span><span class="sh">'</span><span class="p">]</span> <span class="o">+</span> <span class="n">df_copy</span><span class="p">[</span><span class="sh">'</span><span class="s">Horizontal_Distance_To_Fire_Points</span><span class="sh">'</span><span class="p">])</span>
            
            <span class="c1"># H_to_F_sub
</span>            <span class="n">df_copy</span><span class="p">[</span><span class="sh">'</span><span class="s">H_to_F_sub</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">abs</span><span class="p">(</span><span class="n">df_copy</span><span class="p">[</span><span class="sh">'</span><span class="s">Horizontal_Distance_To_Hydrology</span><span class="sh">'</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_copy</span><span class="p">[</span><span class="sh">'</span><span class="s">Horizontal_Distance_To_Fire_Points</span><span class="sh">'</span><span class="p">])</span>
            
            <span class="c1"># H_to_R_sum
</span>            <span class="n">df_copy</span><span class="p">[</span><span class="sh">'</span><span class="s">H_to_R_sum</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">abs</span><span class="p">(</span><span class="n">df_copy</span><span class="p">[</span><span class="sh">'</span><span class="s">Horizontal_Distance_To_Hydrology</span><span class="sh">'</span><span class="p">]</span> <span class="o">+</span> <span class="n">df_copy</span><span class="p">[</span><span class="sh">'</span><span class="s">Horizontal_Distance_To_Roadways</span><span class="sh">'</span><span class="p">])</span>
            
            <span class="c1"># H_to_R_sub
</span>            <span class="n">df_copy</span><span class="p">[</span><span class="sh">'</span><span class="s">H_to_R_sub</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">abs</span><span class="p">(</span><span class="n">df_copy</span><span class="p">[</span><span class="sh">'</span><span class="s">Horizontal_Distance_To_Hydrology</span><span class="sh">'</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_copy</span><span class="p">[</span><span class="sh">'</span><span class="s">Horizontal_Distance_To_Roadways</span><span class="sh">'</span><span class="p">])</span>
            
            <span class="c1"># R_to_F_sum
</span>            <span class="n">df_copy</span><span class="p">[</span><span class="sh">'</span><span class="s">R_to_F_sum</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">abs</span><span class="p">(</span><span class="n">df_copy</span><span class="p">[</span><span class="sh">'</span><span class="s">Horizontal_Distance_To_Roadways</span><span class="sh">'</span><span class="p">]</span> <span class="o">+</span> <span class="n">df_copy</span><span class="p">[</span><span class="sh">'</span><span class="s">Horizontal_Distance_To_Fire_Points</span><span class="sh">'</span><span class="p">])</span>
            
            <span class="c1"># R_to_F_sub
</span>            <span class="n">df_copy</span><span class="p">[</span><span class="sh">'</span><span class="s">R_to_F_sub</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">abs</span><span class="p">(</span><span class="n">df_copy</span><span class="p">[</span><span class="sh">'</span><span class="s">Horizontal_Distance_To_Roadways</span><span class="sh">'</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_copy</span><span class="p">[</span><span class="sh">'</span><span class="s">Horizontal_Distance_To_Fire_Points</span><span class="sh">'</span><span class="p">])</span>
            
            <span class="c1"># Slope_Hydrology
</span>            <span class="n">df_copy</span><span class="p">[</span><span class="sh">'</span><span class="s">Slope_Hydrology</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_copy</span><span class="p">[</span><span class="sh">'</span><span class="s">Vertical_Distance_To_Hydrology</span><span class="sh">'</span><span class="p">]</span> <span class="o">/</span> <span class="n">df_copy</span><span class="p">[</span><span class="sh">'</span><span class="s">Horizontal_Distance_To_Hydrology</span><span class="sh">'</span><span class="p">]</span>
            <span class="n">df_copy</span><span class="p">[</span><span class="sh">'</span><span class="s">Slope_Hydrology</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_copy</span><span class="p">[</span><span class="sh">'</span><span class="s">Slope_Hydrology</span><span class="sh">'</span><span class="p">].</span><span class="nf">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">np</span><span class="p">.</span><span class="nf">isnan</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">else</span> <span class="n">x</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">df_copy</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">NewCategoricalFeatureGenerator</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span><span class="p">):</span>
    <span class="sh">'''</span><span class="s">
    Generate new features on input dataframe.
    </span><span class="sh">'''</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="k">pass</span>
    
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">self</span>
    
    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        
        <span class="n">df_copy</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">copy</span><span class="p">()</span>
            
        <span class="c1"># Has_Soil_Type
</span>        <span class="n">soil_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">df_copy</span><span class="p">.</span><span class="n">columns</span> <span class="k">if</span> <span class="sh">'</span><span class="s">Soil_Type</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>
        <span class="n">df_copy</span><span class="p">[</span><span class="sh">'</span><span class="s">Has_Soil_Type</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_copy</span><span class="p">[</span><span class="n">soil_types</span><span class="p">].</span><span class="nf">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="c1"># return numpy array
</span>        <span class="n">df_copy_values</span> <span class="o">=</span> <span class="n">df_copy</span><span class="p">.</span><span class="n">values</span>
        
        <span class="k">return</span> <span class="n">df_copy_values</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">SpecialScaler</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span><span class="p">):</span>
    <span class="sh">'''</span><span class="s">
    Standardize features
    </span><span class="sh">'''</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">scaling_type</span><span class="o">=</span><span class="sh">'</span><span class="s">MinMax</span><span class="sh">'</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="n">scaling_type</span><span class="o">==</span><span class="sh">'</span><span class="s">MinMax</span><span class="sh">'</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">scaler</span> <span class="o">=</span> <span class="nc">MinMaxScaler</span><span class="p">()</span>
        
        <span class="k">elif</span> <span class="n">scaling_type</span><span class="o">==</span><span class="sh">'</span><span class="s">StandardScaler</span><span class="sh">'</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">scaler</span> <span class="o">=</span> <span class="nc">StandardScaler</span><span class="p">()</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">scaler</span> <span class="o">=</span> <span class="bp">None</span>
    
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">scaler</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">scaler</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">self</span>
        
    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">scaler</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">df</span><span class="p">.</span><span class="n">values</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">scaler</span><span class="p">.</span><span class="nf">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">num_pipeline_with_new_features</span> <span class="o">=</span> <span class="nc">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="sh">'</span><span class="s">selector</span><span class="sh">'</span><span class="p">,</span><span class="nc">DataFrameSelector</span><span class="p">(</span><span class="n">numerical_features</span><span class="p">)),</span>
    <span class="p">(</span><span class="sh">'</span><span class="s">feature_adder</span><span class="sh">'</span><span class="p">,</span><span class="nc">NewNumericalFeatureGenerator</span><span class="p">(</span><span class="n">add_new_features</span><span class="o">=</span><span class="bp">True</span><span class="p">)),</span>
    <span class="p">(</span><span class="sh">'</span><span class="s">scaler</span><span class="sh">'</span><span class="p">,</span><span class="nc">SpecialScaler</span><span class="p">(</span><span class="n">scaling_type</span><span class="o">=</span><span class="sh">'</span><span class="s">StandardScaler</span><span class="sh">'</span><span class="p">))</span>
<span class="p">])</span>

<span class="n">num_pipeline_without_new_features</span> <span class="o">=</span> <span class="nc">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="sh">'</span><span class="s">selector</span><span class="sh">'</span><span class="p">,</span><span class="nc">DataFrameSelector</span><span class="p">(</span><span class="n">numerical_features</span><span class="p">)),</span>
    <span class="p">(</span><span class="sh">'</span><span class="s">feature_adder</span><span class="sh">'</span><span class="p">,</span><span class="nc">NewNumericalFeatureGenerator</span><span class="p">(</span><span class="n">add_new_features</span><span class="o">=</span><span class="bp">False</span><span class="p">)),</span>
    <span class="p">(</span><span class="sh">'</span><span class="s">scaler</span><span class="sh">'</span><span class="p">,</span><span class="nc">SpecialScaler</span><span class="p">(</span><span class="n">scaling_type</span><span class="o">=</span><span class="sh">'</span><span class="s">StandardScaler</span><span class="sh">'</span><span class="p">))</span>
<span class="p">])</span>


<span class="n">cat_pipeline</span> <span class="o">=</span> <span class="nc">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="sh">'</span><span class="s">selector</span><span class="sh">'</span><span class="p">,</span><span class="nc">DataFrameSelector</span><span class="p">(</span><span class="n">catergorical_features</span><span class="p">)),</span>
    <span class="p">(</span><span class="sh">'</span><span class="s">feature_adder</span><span class="sh">'</span><span class="p">,</span><span class="nc">NewCategoricalFeatureGenerator</span><span class="p">()),</span>
<span class="p">])</span>

<span class="n">full_pipeline_with_new_features</span> <span class="o">=</span> <span class="nc">FeatureUnion</span><span class="p">(</span><span class="n">transformer_list</span><span class="o">=</span><span class="p">[(</span><span class="sh">'</span><span class="s">num_pipeline</span><span class="sh">'</span><span class="p">,</span><span class="n">num_pipeline_with_new_features</span><span class="p">),</span>
                                                                 <span class="p">(</span><span class="sh">'</span><span class="s">cat_pipeline</span><span class="sh">'</span><span class="p">,</span><span class="n">cat_pipeline</span><span class="p">)])</span>

<span class="n">full_pipeline_without_new_features</span> <span class="o">=</span> <span class="nc">FeatureUnion</span><span class="p">(</span><span class="n">transformer_list</span><span class="o">=</span><span class="p">[(</span><span class="sh">'</span><span class="s">num_pipeline</span><span class="sh">'</span><span class="p">,</span><span class="n">num_pipeline_without_new_features</span><span class="p">),</span>
                                                                    <span class="p">(</span><span class="sh">'</span><span class="s">cat_pipeline</span><span class="sh">'</span><span class="p">,</span><span class="n">cat_pipeline</span><span class="p">)])</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">X_train_prepared_with</span> <span class="o">=</span> <span class="n">full_pipeline_with_new_features</span><span class="p">.</span><span class="nf">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">X_train_prepared_without</span> <span class="o">=</span> <span class="n">full_pipeline_without_new_features</span><span class="p">.</span><span class="nf">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
</code></pre></div></div>

<p>The new dataset contains a large number of attributes (76). In order to normalize our model, feature selection can be used to extract only the most important features. To do so, a simple Random Forest Classifier will be used.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="n">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># create model
</span><span class="n">forest_clf</span> <span class="o">=</span> <span class="nc">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="c1"># create gridsearch
</span><span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="sh">'</span><span class="s">n_estimators</span><span class="sh">'</span><span class="p">:[</span><span class="mi">3</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">100</span><span class="p">],</span><span class="sh">'</span><span class="s">max_features</span><span class="sh">'</span><span class="p">:[</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">],</span><span class="sh">'</span><span class="s">max_depth</span><span class="sh">'</span><span class="p">:[</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">15</span><span class="p">]}</span>

<span class="c1"># train model
</span><span class="n">grid_search_with</span> <span class="o">=</span> <span class="nc">GridSearchCV</span><span class="p">(</span><span class="n">forest_clf</span><span class="p">,</span><span class="n">param_grid</span><span class="p">,</span><span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">scoring</span><span class="o">=</span><span class="sh">'</span><span class="s">accuracy</span><span class="sh">'</span><span class="p">,</span><span class="n">n_jobs</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">grid_search_with</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">X_train_prepared_with</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="n">grid_search_without</span> <span class="o">=</span> <span class="nc">GridSearchCV</span><span class="p">(</span><span class="n">forest_clf</span><span class="p">,</span><span class="n">param_grid</span><span class="p">,</span><span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">scoring</span><span class="o">=</span><span class="sh">'</span><span class="s">accuracy</span><span class="sh">'</span><span class="p">,</span><span class="n">n_jobs</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">grid_search_without</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">X_train_prepared_without</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Fitting 5 folds for each of 80 candidates, totalling 400 fits


[Parallel(n_jobs=4)]: Using backend LokyBackend with 4 concurrent workers.
[Parallel(n_jobs=4)]: Done  33 tasks      | elapsed:    4.1s
[Parallel(n_jobs=4)]: Done 154 tasks      | elapsed:   21.8s
[Parallel(n_jobs=4)]: Done 357 tasks      | elapsed:  1.2min
[Parallel(n_jobs=4)]: Done 400 out of 400 | elapsed:  1.5min finished


Fitting 5 folds for each of 80 candidates, totalling 400 fits


[Parallel(n_jobs=4)]: Using backend LokyBackend with 4 concurrent workers.
[Parallel(n_jobs=4)]: Done 128 tasks      | elapsed:    8.4s
[Parallel(n_jobs=4)]: Done 253 tasks      | elapsed:   20.3s
[Parallel(n_jobs=4)]: Done 400 out of 400 | elapsed:   47.1s finished





GridSearchCV(cv=5, error_score='raise-deprecating',
             estimator=RandomForestClassifier(bootstrap=True, class_weight=None,
                                              criterion='gini', max_depth=None,
                                              max_features='auto',
                                              max_leaf_nodes=None,
                                              min_impurity_decrease=0.0,
                                              min_impurity_split=None,
                                              min_samples_leaf=1,
                                              min_samples_split=2,
                                              min_weight_fraction_leaf=0.0,
                                              n_estimators='warn', n_jobs=None,
                                              oob_score=False, random_state=42,
                                              verbose=0, warm_start=False),
             iid='warn', n_jobs=4,
             param_grid={'max_depth': [3, 5, 10, 15],
                         'max_features': [2, 4, 6, 8],
                         'n_estimators': [3, 10, 30, 50, 100]},
             pre_dispatch='2*n_jobs', refit=True, return_train_score=False,
             scoring='accuracy', verbose=2)
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Best accuracy with new features</span><span class="sh">"</span><span class="p">,</span><span class="n">grid_search_with</span><span class="p">.</span><span class="n">best_score_</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Best accuracy without new features</span><span class="sh">"</span><span class="p">,</span><span class="n">grid_search_without</span><span class="p">.</span><span class="n">best_score_</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Best accuracy with new features 0.7851190476190476
Best accuracy without new features 0.7618386243386244
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature_importances_with</span> <span class="o">=</span> <span class="n">grid_search_with</span><span class="p">.</span><span class="n">best_estimator_</span><span class="p">.</span><span class="n">feature_importances_</span>

<span class="k">for</span> <span class="n">ix</span><span class="p">,</span><span class="n">item</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="nf">sorted</span><span class="p">(</span><span class="nf">zip</span><span class="p">(</span><span class="n">feature_importances_with</span><span class="p">,</span><span class="n">full_feature_list_with</span><span class="p">),</span><span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)):</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">ix</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1 (0.14152351076150732, 'Elevation')
2 (0.13190518916873342, 'Elevation_sq')
3 (0.03878816856795683, 'R_to_F_sum')
4 (0.03687988835737898, 'Wilderness_Area4')
5 (0.03465820030896246, 'H_to_R_sub')
6 (0.02969575956564049, 'Horizontal_Distance_To_Roadways')
7 (0.028719686262350896, 'H_to_R_sum')
8 (0.028414939013321355, 'Horizontal_Distance_To_Roadways_sq')
9 (0.025056946923004707, 'R_to_F_sub')
10 (0.023834760808291177, 'H_to_F_sum')
11 (0.02263890186894855, 'Hillshade_9am')
12 (0.022235681492061888, 'Horizontal_Distance_To_Fire_Points')
13 (0.020816744245214534, 'Horizontal_Distance_To_Fire_Points_sq')
14 (0.020300429050862795, 'Euclidean_Distance_to_Hydrology')
15 (0.02020020125477723, 'Aspect')
16 (0.01966048192263614, 'H_to_F_sub')
17 (0.01944452869164485, 'Aspect_sq')
18 (0.018757557523025766, 'Soil_Type10')
19 (0.017981809544327057, 'Horizontal_Distance_To_Hydrology_sq')
20 (0.01681290363696822, 'Vertical_Distance_To_Hydrology_sq')
21 (0.01628750794156562, 'Hillshade_3pm')
22 (0.015767908168667726, 'Soil_Type3')
23 (0.015684408039363464, 'log_Horizontal_Distance_To_Hydrology')
24 (0.015621261267752283, 'Horizontal_Distance_To_Hydrology')
25 (0.015577123262199837, 'Wilderness_Area3')
26 (0.015336705888016116, 'Wilderness_Area1')
27 (0.015086774235711094, 'Hillshade_Noon')
28 (0.014486586781480938, 'Soil_Type38')
29 (0.01425128617291883, 'Hillshade_mean')
30 (0.013858095606874144, 'Slope_Hydrology')
31 (0.013770929149894306, 'Vertical_Distance_To_Hydrology')
32 (0.013590421450373293, 'Soil_Type39')
33 (0.011584893055557866, 'log_Vertical_Distance_To_Hydrology')
34 (0.00883439889425353, 'Cosine_Slope')
35 (0.008824731678667782, 'Sine_Slope')
36 (0.008519215091788636, 'Slope')
37 (0.008406001964489292, 'Soil_Type4')
38 (0.008049744667644264, 'Slope_sq')
39 (0.007418427316254516, 'Soil_Type40')
40 (0.00591836799042853, 'Soil_Type30')
41 (0.003449767700896693, 'Soil_Type13')
42 (0.003026236704389329, 'Wilderness_Area2')
43 (0.002917783790374529, 'Soil_Type12')
44 (0.002792952520826473, 'Soil_Type29')
45 (0.0027696099299623278, 'Soil_Type32')
46 (0.0027157440327077276, 'Soil_Type2')
47 (0.0027039817262601417, 'Soil_Type22')
48 (0.002654504572087974, 'Soil_Type23')
49 (0.0019415364596016252, 'Soil_Type17')
50 (0.0016143585426425708, 'Soil_Type33')
51 (0.0012767757230445415, 'Soil_Type6')
52 (0.0009590220884099596, 'Soil_Type11')
53 (0.0009310613728797029, 'Soil_Type35')
54 (0.000785856673361728, 'Soil_Type31')
55 (0.0007823089137053381, 'Soil_Type24')
56 (0.0007530883967865013, 'Soil_Type1')
57 (0.0006799707571842439, 'Soil_Type20')
58 (0.0005747015598076818, 'Soil_Type5')
59 (0.0004453989768105188, 'Soil_Type16')
60 (0.0002218366821015433, 'Soil_Type18')
61 (0.00018435985478080187, 'Soil_Type14')
62 (0.00014059895771458805, 'Soil_Type37')
63 (0.0001318831735853356, 'Soil_Type26')
64 (9.608551995037555e-05, 'Soil_Type19')
65 (5.027960141285551e-05, 'Soil_Type34')
66 (4.949345221571494e-05, 'Soil_Type28')
67 (4.555758972482114e-05, 'Soil_Type27')
68 (4.371425550097232e-05, 'Soil_Type21')
69 (3.9161118007753776e-05, 'Soil_Type9')
70 (1.7843910376931404e-05, 'Soil_Type36')
71 (3.43710410880248e-06, 'Soil_Type25')
72 (1.0747263197141472e-08, 'Soil_Type8')
73 (0.0, 'Soil_Type7')
74 (0.0, 'Soil_Type15')
75 (0.0, 'Has_Soil_Type')
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature_importances_without</span> <span class="o">=</span> <span class="n">grid_search_without</span><span class="p">.</span><span class="n">best_estimator_</span><span class="p">.</span><span class="n">feature_importances_</span>

<span class="k">for</span> <span class="n">ix</span><span class="p">,</span><span class="n">item</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="nf">sorted</span><span class="p">(</span><span class="nf">zip</span><span class="p">(</span><span class="n">feature_importances_without</span><span class="p">,</span><span class="n">full_feature_list_without</span><span class="p">),</span><span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)):</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">ix</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1 (0.25878829585756613, 'Elevation')
2 (0.08698109411500367, 'Horizontal_Distance_To_Roadways')
3 (0.06334081721558939, 'Horizontal_Distance_To_Fire_Points')
4 (0.05736072766500386, 'Wilderness_Area4')
5 (0.05640103379348544, 'Horizontal_Distance_To_Hydrology')
6 (0.045080251148035336, 'Hillshade_9am')
7 (0.043516585043468704, 'Vertical_Distance_To_Hydrology')
8 (0.04002124407977922, 'Aspect')
9 (0.03817656728870067, 'Hillshade_3pm')
10 (0.03472020682173347, 'Hillshade_Noon')
11 (0.027799274938067668, 'Soil_Type10')
12 (0.02573161368161303, 'Slope')
13 (0.02450273362314368, 'Soil_Type39')
14 (0.024484916872244165, 'Soil_Type38')
15 (0.021348381588154094, 'Wilderness_Area3')
16 (0.020457233904003884, 'Wilderness_Area1')
17 (0.020147880229841632, 'Soil_Type3')
18 (0.0144625025231886, 'Soil_Type4')
19 (0.01133349335971847, 'Soil_Type40')
20 (0.00910708906663545, 'Soil_Type30')
21 (0.007926063722480137, 'Soil_Type22')
22 (0.00722141237917537, 'Soil_Type13')
23 (0.0064434542330762505, 'Soil_Type17')
24 (0.006077001190013304, 'Soil_Type29')
25 (0.005918225908316521, 'Soil_Type2')
26 (0.00535686144733342, 'Soil_Type12')
27 (0.0052671046186313995, 'Wilderness_Area2')
28 (0.005136083279655753, 'Soil_Type23')
29 (0.0043006374729556394, 'Soil_Type32')
30 (0.002987245513505226, 'Soil_Type33')
31 (0.002895173751792928, 'Soil_Type6')
32 (0.002441118962703501, 'Soil_Type11')
33 (0.0024339839669552097, 'Soil_Type35')
34 (0.0018534233806203665, 'Soil_Type24')
35 (0.0018524652699843077, 'Soil_Type1')
36 (0.001434765633805951, 'Soil_Type31')
37 (0.0012583713883418176, 'Soil_Type5')
38 (0.0011774069004786391, 'Soil_Type20')
39 (0.0008610774455624859, 'Soil_Type18')
40 (0.0007952791538882718, 'Soil_Type14')
41 (0.0007862567472032722, 'Soil_Type16')
42 (0.000710748968022875, 'Soil_Type37')
43 (0.0002163889962338194, 'Soil_Type26')
44 (0.00020074267666505787, 'Soil_Type19')
45 (0.00016198783895200196, 'Soil_Type34')
46 (0.00011485179619529112, 'Soil_Type21')
47 (0.00010892953211897586, 'Soil_Type27')
48 (0.00010745256745145929, 'Soil_Type9')
49 (8.916452586339112e-05, 'Soil_Type36')
50 (7.186961540098499e-05, 'Soil_Type28')
51 (3.003375547567885e-05, 'Soil_Type25')
52 (2.4745461639670084e-06, 'Soil_Type8')
53 (0.0, 'Soil_Type7')
54 (0.0, 'Soil_Type15')
55 (0.0, 'Has_Soil_Type')
</code></pre></div></div>

<p>The above list shows several feature which do no impact the model (Soil_Type8, 7 and 15). Therefore, in the final tuning of our model, the number of selected features will be integreted as a tunable hyperparameter.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">X_train_new_features</span> <span class="o">=</span> <span class="nc">NewNumericalFeatureGenerator</span><span class="p">(</span><span class="n">add_new_features</span><span class="o">=</span><span class="bp">True</span><span class="p">).</span><span class="nf">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Compute the correlation matrix
</span><span class="n">corr</span> <span class="o">=</span> <span class="n">X_train_new_features</span><span class="p">[</span><span class="n">new_numerical_features</span><span class="p">].</span><span class="nf">corr</span><span class="p">()</span>
<span class="n">corr</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">around</span><span class="p">(</span><span class="n">corr</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Generate a mask for the upper triangle
</span><span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros_like</span><span class="p">(</span><span class="n">corr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="nb">bool</span><span class="p">)</span>
<span class="n">mask</span><span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="nf">triu_indices_from</span><span class="p">(</span><span class="n">mask</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">True</span>

<span class="c1"># Set up the matplotlib figure
</span><span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">))</span>

<span class="c1"># Generate a custom diverging colormap
</span><span class="n">cmap</span> <span class="o">=</span> <span class="n">sns</span><span class="p">.</span><span class="nf">diverging_palette</span><span class="p">(</span><span class="mi">220</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">as_cmap</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1"># Draw the heatmap with the mask and correct aspect ratio
</span><span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="p">.</span><span class="nf">heatmap</span><span class="p">(</span><span class="n">corr</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">vmin</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">annot</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
            <span class="n">square</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="n">cbar_kws</span><span class="o">=</span><span class="p">{</span><span class="sh">"</span><span class="s">shrink</span><span class="sh">"</span><span class="p">:</span> <span class="p">.</span><span class="mi">2</span><span class="p">})</span>
<span class="n">g</span><span class="p">.</span><span class="nf">set_xticklabels</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="nf">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">9</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="sh">'</span><span class="s">right</span><span class="sh">'</span><span class="p">)</span>
<span class="n">g</span><span class="p">.</span><span class="nf">set_yticklabels</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="nf">get_yticklabels</span><span class="p">(),</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">9</span><span class="p">);</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-07-15-Forest-Cover/output_95_0.png" />
</figure>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># add feature selection to grid search
</span><span class="k">def</span> <span class="nf">indices_of_top_k</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="p">.</span><span class="nf">sort</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">argpartition</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span><span class="n">arr</span><span class="p">),</span><span class="o">-</span><span class="n">k</span><span class="p">)[</span><span class="o">-</span><span class="n">k</span><span class="p">:])</span>

<span class="k">class</span> <span class="nc">TopFeatureSelector</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span><span class="p">):</span>
    <span class="sh">'''</span><span class="s">Select the k best feature from dataset</span><span class="sh">'''</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">feature_importances</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">feature_importances</span> <span class="o">=</span> <span class="n">feature_importances</span>
        <span class="n">self</span><span class="p">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">k</span>
        
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">feature_indices_</span> <span class="o">=</span> <span class="nf">indices_of_top_k</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">feature_importances</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">k</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">self</span>
    
    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">X</span><span class="p">[:,</span> <span class="n">self</span><span class="p">.</span><span class="n">feature_indices_</span><span class="p">]</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># first example
</span><span class="n">k</span> <span class="o">=</span> <span class="mi">45</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># pipeline
</span><span class="n">preparation_and_feature_selection_pipeline_with</span> <span class="o">=</span> <span class="nc">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="sh">'</span><span class="s">preparation</span><span class="sh">'</span><span class="p">,</span><span class="n">full_pipeline_with_new_features</span><span class="p">),</span>
    <span class="p">(</span><span class="sh">'</span><span class="s">feature_selection</span><span class="sh">'</span><span class="p">,</span><span class="nc">TopFeatureSelector</span><span class="p">(</span><span class="n">feature_importances_with</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<span class="p">])</span>

<span class="n">preparation_and_feature_selection_pipeline_without</span> <span class="o">=</span> <span class="nc">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="sh">'</span><span class="s">preparation</span><span class="sh">'</span><span class="p">,</span><span class="n">full_pipeline_without_new_features</span><span class="p">),</span>
    <span class="p">(</span><span class="sh">'</span><span class="s">feature_selection</span><span class="sh">'</span><span class="p">,</span><span class="nc">TopFeatureSelector</span><span class="p">(</span><span class="n">feature_importances_without</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<span class="p">])</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">preparation_and_feature_selection_pipeline_with</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">preparation_and_feature_selection_pipeline_without</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>

<span class="n">X_train_prepared_with</span> <span class="o">=</span> <span class="n">preparation_and_feature_selection_pipeline_with</span><span class="p">.</span><span class="nf">transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">X_train_prepared_without</span> <span class="o">=</span> <span class="n">preparation_and_feature_selection_pipeline_without</span><span class="p">.</span><span class="nf">transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
</code></pre></div></div>

<hr />
<p><a id="Section_5"></a></p>
<h2 id="5-models">5. Models</h2>

<p>The following classifiers are used to predict the forest types:</p>
<ol>
  <li>Logistic Regression (Classification)</li>
  <li>K-Nearest Neighbors</li>
  <li>Support Vector Machines</li>
  <li>Gaussian Naive Bayes</li>
  <li>Decision Tree Classifier</li>
  <li>Bagging</li>
  <li>Random Forest Classifier</li>
  <li>Gradient Boosting Classifier</li>
  <li>Linear Discriminant Analysis</li>
  <li>NN</li>
  <li>Adaboost</li>
  <li>Extra Trees</li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># import modules
# Models
</span><span class="kn">from</span> <span class="n">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeClassifier</span><span class="p">,</span> <span class="n">DecisionTreeRegressor</span>
<span class="kn">from</span> <span class="n">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_val_score</span><span class="p">,</span><span class="n">GridSearchCV</span><span class="p">,</span> <span class="n">StratifiedKFold</span><span class="p">,</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="n">sklearn.naive_bayes</span> <span class="kn">import</span> <span class="n">GaussianNB</span>
<span class="kn">from</span> <span class="n">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeClassifier</span>
<span class="kn">from</span> <span class="n">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span><span class="p">,</span> <span class="n">GradientBoostingClassifier</span><span class="p">,</span> <span class="n">BaggingClassifier</span>
<span class="kn">from</span> <span class="n">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVC</span>
<span class="kn">from</span> <span class="n">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="n">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span><span class="p">,</span> <span class="n">SGDClassifier</span>
<span class="kn">from</span> <span class="n">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsClassifier</span>
<span class="kn">from</span> <span class="n">sklearn.discriminant_analysis</span> <span class="kn">import</span> <span class="n">LinearDiscriminantAnalysis</span>
<span class="kn">from</span> <span class="n">sklearn.neural_network</span> <span class="kn">import</span> <span class="n">MLPClassifier</span>
<span class="kn">from</span> <span class="n">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">AdaBoostClassifier</span><span class="p">,</span> <span class="n">VotingClassifier</span><span class="p">,</span> <span class="n">ExtraTreesClassifier</span>

<span class="kn">from</span> <span class="n">xgboost</span> <span class="kn">import</span> <span class="n">XGBClassifier</span>

<span class="c1"># cross validation
</span><span class="kn">from</span> <span class="n">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span><span class="p">,</span> <span class="n">cross_val_score</span>
<span class="kn">from</span> <span class="n">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># cross validate model with Kfold stratified cross val
</span><span class="n">kfold</span> <span class="o">=</span> <span class="nc">StratifiedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># random state used for all models 
</span><span class="n">random_state</span> <span class="o">=</span> <span class="mi">42</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># store models in list
</span><span class="n">classifiers_list</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">classifiers_list</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nc">LogisticRegression</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">))</span>
<span class="n">classifiers_list</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nc">KNeighborsClassifier</span><span class="p">())</span>
<span class="n">classifiers_list</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nc">SVC</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">))</span>
<span class="n">classifiers_list</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nc">GaussianNB</span><span class="p">())</span>
<span class="n">classifiers_list</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nc">DecisionTreeClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">))</span>
<span class="n">classifiers_list</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nc">BaggingClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">))</span>
<span class="n">classifiers_list</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nc">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">))</span>
<span class="n">classifiers_list</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nc">GradientBoostingClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">))</span>
<span class="n">classifiers_list</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nc">LinearDiscriminantAnalysis</span><span class="p">())</span>
<span class="n">classifiers_list</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nc">MLPClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">))</span>
<span class="n">classifiers_list</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nc">AdaBoostClassifier</span><span class="p">(</span><span class="nc">DecisionTreeClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">),</span><span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">))</span>
<span class="n">classifiers_list</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nc">ExtraTreesClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">))</span>
<span class="n">classifiers_list</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nc">SGDClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">))</span>
<span class="n">classifiers_list</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nc">XGBClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">))</span>

<span class="c1"># store cv results in list
</span><span class="n">cv_results_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">cv_means_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">cv_std_list</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># perform cross-validation
</span><span class="k">for</span> <span class="n">clf</span> <span class="ow">in</span> <span class="n">classifiers_list</span><span class="p">:</span>
    <span class="n">cv_results_list</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nf">cross_val_score</span><span class="p">(</span><span class="n">clf</span><span class="p">,</span>
                                           <span class="n">X_train_prepared_with</span><span class="p">,</span>
                                           <span class="n">y_train</span><span class="p">,</span>
                                           <span class="n">scoring</span> <span class="o">=</span> <span class="sh">"</span><span class="s">accuracy</span><span class="sh">"</span><span class="p">,</span>
                                           <span class="n">cv</span> <span class="o">=</span> <span class="n">kfold</span><span class="p">,</span>
                                           <span class="n">n_jobs</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
    
    <span class="n">cv_results_list</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nf">cross_val_score</span><span class="p">(</span><span class="n">clf</span><span class="p">,</span>
                                           <span class="n">X_train_prepared_without</span><span class="p">,</span>
                                           <span class="n">y_train</span><span class="p">,</span>
                                           <span class="n">scoring</span> <span class="o">=</span> <span class="sh">"</span><span class="s">accuracy</span><span class="sh">"</span><span class="p">,</span>
                                           <span class="n">cv</span> <span class="o">=</span> <span class="n">kfold</span><span class="p">,</span>
                                           <span class="n">n_jobs</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
        
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Training {}: Done</span><span class="sh">"</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="nf">type</span><span class="p">(</span><span class="n">clf</span><span class="p">).</span><span class="n">__name__</span><span class="p">))</span>

<span class="c1"># store mean and std accuracy
</span><span class="k">for</span> <span class="n">cv_result</span> <span class="ow">in</span> <span class="n">cv_results_list</span><span class="p">:</span>
    <span class="n">cv_means_list</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">cv_result</span><span class="p">.</span><span class="nf">mean</span><span class="p">())</span>
    <span class="n">cv_std_list</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">cv_result</span><span class="p">.</span><span class="nf">std</span><span class="p">())</span>
                      
<span class="n">cv_res_df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">({</span><span class="sh">"</span><span class="s">CrossValMeans</span><span class="sh">"</span><span class="p">:</span><span class="n">cv_means_list</span><span class="p">,</span>
                          <span class="sh">"</span><span class="s">CrossValerrors</span><span class="sh">"</span><span class="p">:</span> <span class="n">cv_std_list</span><span class="p">,</span>
                          <span class="sh">"</span><span class="s">Algorithm</span><span class="sh">"</span><span class="p">:[</span><span class="sh">"</span><span class="s">LogReg_with</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">LogReg</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">KNN_with</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">KNN</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">SVC_with</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">SVC</span><span class="sh">"</span><span class="p">,</span>
                                       <span class="sh">"</span><span class="s">GaussianNB_with</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">GaussianNB</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">DecisionTree_with</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">DecisionTree</span><span class="sh">"</span><span class="p">,</span>
                                       <span class="sh">"</span><span class="s">Bagging_with</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">Bagging</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">RdmForest_with</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">RdmForest</span><span class="sh">"</span><span class="p">,</span>
                                       <span class="sh">"</span><span class="s">GradientBoost_with</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">GradientBoost</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">LDA_with</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">LDA</span><span class="sh">"</span><span class="p">,</span>
                                       <span class="sh">"</span><span class="s">NN_with</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">NN</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">AdaBoost_with</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">AdaBoost</span><span class="sh">"</span><span class="p">,</span>
                                       <span class="sh">"</span><span class="s">ExtraTrees</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">ExtraTrees_with</span><span class="sh">"</span><span class="p">,</span><span class="sh">'</span><span class="s">SGDC</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">SGDC_with</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">XGBC_with</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">XGBC</span><span class="sh">'</span><span class="p">]})</span>                    

<span class="n">cv_res_df</span> <span class="o">=</span> <span class="n">cv_res_df</span><span class="p">.</span><span class="nf">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="sh">'</span><span class="s">CrossValMeans</span><span class="sh">'</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Training LogisticRegression: Done
Training KNeighborsClassifier: Done
Training SVC: Done
Training GaussianNB: Done
Training DecisionTreeClassifier: Done
Training BaggingClassifier: Done
Training RandomForestClassifier: Done
Training GradientBoostingClassifier: Done
Training LinearDiscriminantAnalysis: Done
Training MLPClassifier: Done
Training AdaBoostClassifier: Done
Training ExtraTreesClassifier: Done
Training SGDClassifier: Done
Training XGBClassifier: Done
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># plot results
</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">16</span><span class="p">))</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="p">.</span><span class="nf">barplot</span><span class="p">(</span><span class="sh">"</span><span class="s">CrossValMeans</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">Algorithm</span><span class="sh">"</span><span class="p">,</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">cv_res_df</span><span class="p">,</span>
                <span class="n">palette</span><span class="o">=</span><span class="sh">"</span><span class="s">Set3</span><span class="sh">"</span><span class="p">,</span>
                <span class="n">orient</span> <span class="o">=</span> <span class="sh">"</span><span class="s">h</span><span class="sh">"</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                <span class="o">**</span><span class="p">{</span><span class="sh">'</span><span class="s">xerr</span><span class="sh">'</span><span class="p">:</span><span class="n">cv_std_list</span><span class="p">})</span>
<span class="n">g</span><span class="p">.</span><span class="nf">set_xlabel</span><span class="p">(</span><span class="sh">"</span><span class="s">Mean Accuracy</span><span class="sh">"</span><span class="p">)</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="nf">set_title</span><span class="p">(</span><span class="sh">"</span><span class="s">Cross validation scores</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-07-15-Forest-Cover/output_106_0.png" />
</figure>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">prepare_select_and_predict_pipeline</span> <span class="o">=</span> <span class="nc">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="sh">'</span><span class="s">preparation</span><span class="sh">'</span><span class="p">,</span><span class="n">full_pipeline_with_new_features</span><span class="p">),</span>
    <span class="p">(</span><span class="sh">'</span><span class="s">feature_selection</span><span class="sh">'</span><span class="p">,</span><span class="nc">TopFeatureSelector</span><span class="p">(</span><span class="n">feature_importances_with</span><span class="p">,</span><span class="n">k</span><span class="p">)),</span>
    <span class="p">(</span><span class="sh">'</span><span class="s">extra_tree</span><span class="sh">'</span><span class="p">,</span><span class="nc">ExtraTreesClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">))</span>
<span class="p">])</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">extra_tree_clf</span> <span class="o">=</span> <span class="nc">ExtraTreesClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="n">param_grid</span> <span class="o">=</span> <span class="p">[{</span><span class="sh">'</span><span class="s">extra_tree__n_estimators</span><span class="sh">'</span><span class="p">:[</span><span class="mi">50</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">150</span><span class="p">],</span>
               <span class="sh">'</span><span class="s">extra_tree__criterion</span><span class="sh">'</span><span class="p">:[</span><span class="sh">'</span><span class="s">gini</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">entropy</span><span class="sh">'</span><span class="p">],</span>
               <span class="sh">'</span><span class="s">extra_tree__max_depth</span><span class="sh">'</span><span class="p">:[</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">20</span><span class="p">],</span>
               <span class="sh">'</span><span class="s">extra_tree__min_samples_split</span><span class="sh">'</span><span class="p">:[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span>
               <span class="sh">'</span><span class="s">extra_tree__min_samples_leaf</span><span class="sh">'</span><span class="p">:[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span>
               <span class="sh">'</span><span class="s">extra_tree__max_features</span><span class="sh">'</span><span class="p">:[</span><span class="sh">'</span><span class="s">auto</span><span class="sh">'</span><span class="p">,</span><span class="bp">None</span><span class="p">],</span>
               <span class="sh">'</span><span class="s">feature_selection__feature_importances</span><span class="sh">'</span><span class="p">:[</span><span class="n">feature_importances_with</span><span class="p">],</span>
               <span class="sh">'</span><span class="s">feature_selection__k</span><span class="sh">'</span><span class="p">:[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">45</span><span class="p">],</span>
               <span class="sh">'</span><span class="s">preparation__num_pipeline__feature_adder__add_new_features</span><span class="sh">'</span><span class="p">:[</span><span class="bp">True</span><span class="p">]},</span>
              <span class="p">{</span><span class="sh">'</span><span class="s">extra_tree__n_estimators</span><span class="sh">'</span><span class="p">:[</span><span class="mi">50</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">150</span><span class="p">],</span>
               <span class="sh">'</span><span class="s">extra_tree__criterion</span><span class="sh">'</span><span class="p">:[</span><span class="sh">'</span><span class="s">gini</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">entropy</span><span class="sh">'</span><span class="p">],</span>
               <span class="sh">'</span><span class="s">extra_tree__max_depth</span><span class="sh">'</span><span class="p">:[</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">20</span><span class="p">],</span>
               <span class="sh">'</span><span class="s">extra_tree__min_samples_split</span><span class="sh">'</span><span class="p">:[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span>
               <span class="sh">'</span><span class="s">extra_tree__min_samples_leaf</span><span class="sh">'</span><span class="p">:[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span>
               <span class="sh">'</span><span class="s">extra_tree__max_features</span><span class="sh">'</span><span class="p">:[</span><span class="sh">'</span><span class="s">auto</span><span class="sh">'</span><span class="p">,</span><span class="bp">None</span><span class="p">],</span>
               <span class="sh">'</span><span class="s">feature_selection__feature_importances</span><span class="sh">'</span><span class="p">:[</span><span class="n">feature_importances_without</span><span class="p">],</span>
               <span class="sh">'</span><span class="s">feature_selection__k</span><span class="sh">'</span><span class="p">:[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">45</span><span class="p">],</span>
               <span class="sh">'</span><span class="s">preparation__num_pipeline__feature_adder__add_new_features</span><span class="sh">'</span><span class="p">:[</span><span class="bp">False</span><span class="p">]}</span>
             <span class="p">]</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">grid_search_pipeline</span> <span class="o">=</span> <span class="nc">GridSearchCV</span><span class="p">(</span><span class="n">prepare_select_and_predict_pipeline</span><span class="p">,</span><span class="n">param_grid</span><span class="p">,</span><span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">scoring</span><span class="o">=</span><span class="sh">'</span><span class="s">accuracy</span><span class="sh">'</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">n_jobs</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">grid_search_pipeline</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Fitting 5 folds for each of 4320 candidates, totalling 21600 fits


[Parallel(n_jobs=4)]: Using backend LokyBackend with 4 concurrent workers.
[Parallel(n_jobs=4)]: Done  42 tasks      | elapsed:   15.5s
[Parallel(n_jobs=4)]: Done 192 tasks      | elapsed:   42.9s
[Parallel(n_jobs=4)]: Done 442 tasks      | elapsed:  1.4min
[Parallel(n_jobs=4)]: Done 792 tasks      | elapsed:  3.2min
[Parallel(n_jobs=4)]: Done 1242 tasks      | elapsed:  5.9min
[Parallel(n_jobs=4)]: Done 1792 tasks      | elapsed:  8.5min
[Parallel(n_jobs=4)]: Done 2442 tasks      | elapsed: 14.0min
[Parallel(n_jobs=4)]: Done 3192 tasks      | elapsed: 24.8min
[Parallel(n_jobs=4)]: Done 4042 tasks      | elapsed: 34.1min
[Parallel(n_jobs=4)]: Done 4992 tasks      | elapsed: 50.1min
[Parallel(n_jobs=4)]: Done 6042 tasks      | elapsed: 59.8min
[Parallel(n_jobs=4)]: Done 7192 tasks      | elapsed: 65.2min
[Parallel(n_jobs=4)]: Done 8442 tasks      | elapsed: 75.0min
[Parallel(n_jobs=4)]: Done 9792 tasks      | elapsed: 91.2min
[Parallel(n_jobs=4)]: Done 11242 tasks      | elapsed: 105.9min
[Parallel(n_jobs=4)]: Done 12792 tasks      | elapsed: 111.4min
[Parallel(n_jobs=4)]: Done 14442 tasks      | elapsed: 121.0min
[Parallel(n_jobs=4)]: Done 16192 tasks      | elapsed: 138.0min
[Parallel(n_jobs=4)]: Done 18042 tasks      | elapsed: 143.8min
[Parallel(n_jobs=4)]: Done 19992 tasks      | elapsed: 155.7min
[Parallel(n_jobs=4)]: Done 21600 out of 21600 | elapsed: 172.5min finished





GridSearchCV(cv=5, error_score='raise-deprecating',
             estimator=Pipeline(memory=None,
                                steps=[('preparation',
                                        FeatureUnion(n_jobs=None,
                                                     transformer_list=[('num_pipeline',
                                                                        Pipeline(memory=None,
                                                                                 steps=[('selector',
                                                                                         DataFrameSelector(['Elevation', 'Aspect', 'Slope', 'Horizontal_Distance_To_Hydrology', 'Vertical_Distance_To_Hydrology', 'Horizontal_Distance_To_Roadways...
       1.13334934e-02, 1.25837139e-03, 2.89517375e-03, 0.00000000e+00,
       2.47454616e-06, 1.07452567e-04, 2.04572339e-02, 5.26710462e-03,
       2.13483816e-02, 5.73607277e-02, 0.00000000e+00])],
                          'feature_selection__k': [10, 20, 30, 45],
                          'preparation__num_pipeline__feature_adder__add_new_features': [False]}],
             pre_dispatch='2*n_jobs', refit=True, return_train_score=False,
             scoring='accuracy', verbose=1)
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">grid_search_pipeline</span><span class="p">.</span><span class="n">best_score_</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.8001322751322751
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">grid_search_pipeline</span><span class="p">.</span><span class="n">best_params_</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{'extra_tree__criterion': 'entropy',
 'extra_tree__max_depth': 20,
 'extra_tree__max_features': None,
 'extra_tree__min_samples_leaf': 2,
 'extra_tree__min_samples_split': 2,
 'extra_tree__n_estimators': 100,
 'feature_selection__feature_importances': array([1.41523511e-01, 2.02002013e-02, 8.51921509e-03, 1.56212613e-02,
        1.37709291e-02, 2.96957596e-02, 2.26389019e-02, 1.50867742e-02,
        1.62875079e-02, 2.22356815e-02, 1.56844080e-02, 1.15848931e-02,
        8.04974467e-03, 1.31905189e-01, 1.94445287e-02, 1.79818095e-02,
        1.68129036e-02, 2.84149390e-02, 2.08167442e-02, 1.42512862e-02,
        2.03004291e-02, 8.83439889e-03, 8.82473168e-03, 2.38347608e-02,
        1.96604819e-02, 2.87196863e-02, 3.46582003e-02, 3.87881686e-02,
        2.50569469e-02, 1.38580956e-02, 7.53088397e-04, 1.87575575e-02,
        9.59022088e-04, 2.91778379e-03, 3.44976770e-03, 1.84359855e-04,
        0.00000000e+00, 4.45398977e-04, 1.94153646e-03, 2.21836682e-04,
        9.60855200e-05, 2.71574403e-03, 6.79970757e-04, 4.37142555e-05,
        2.70398173e-03, 2.65450457e-03, 7.82308914e-04, 3.43710411e-06,
        1.31883174e-04, 4.55575897e-05, 4.94934522e-05, 2.79295252e-03,
        1.57679082e-02, 5.91836799e-03, 7.85856673e-04, 2.76960993e-03,
        1.61435854e-03, 5.02796014e-05, 9.31061373e-04, 1.78439104e-05,
        1.40598958e-04, 1.44865868e-02, 1.35904215e-02, 8.40600196e-03,
        7.41842732e-03, 5.74701560e-04, 1.27677572e-03, 0.00000000e+00,
        1.07472632e-08, 3.91611180e-05, 1.53367059e-02, 3.02623670e-03,
        1.55771233e-02, 3.68798884e-02, 0.00000000e+00]),
 'feature_selection__k': 30,
 'preparation__num_pipeline__feature_adder__add_new_features': True}
</code></pre></div></div>

<hr />
<p><a id="Section_6"></a></p>
<h2 id="6-submission">6. Submission</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">submission_pipeline</span> <span class="o">=</span> <span class="nc">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="sh">'</span><span class="s">preparation</span><span class="sh">'</span><span class="p">,</span><span class="n">full_pipeline_with_new_features</span><span class="p">),</span>
    <span class="p">(</span><span class="sh">'</span><span class="s">feature_selection</span><span class="sh">'</span><span class="p">,</span><span class="nc">TopFeatureSelector</span><span class="p">(</span><span class="n">feature_importances_with</span><span class="p">,</span><span class="mi">30</span><span class="p">))</span>
<span class="p">])</span>

<span class="n">X_train_prep</span> <span class="o">=</span> <span class="n">submission_pipeline</span><span class="p">.</span><span class="nf">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">final_model</span> <span class="o">=</span> <span class="nc">ExtraTreesClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">criterion</span><span class="o">=</span><span class="sh">'</span><span class="s">entropy</span><span class="sh">'</span><span class="p">,</span>
<span class="n">max_depth</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
<span class="n">max_features</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
<span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<span class="n">min_samples_split</span><span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
<span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

<span class="n">final_model</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">X_train_prep</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ExtraTreesClassifier(bootstrap=False, class_weight=None, criterion='entropy',
                     max_depth=20, max_features=None, max_leaf_nodes=None,
                     min_impurity_decrease=0.0, min_impurity_split=None,
                     min_samples_leaf=2, min_samples_split=2,
                     min_weight_fraction_leaf=0.0, n_estimators=100,
                     n_jobs=None, oob_score=False, random_state=42, verbose=0,
                     warm_start=False)
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">X_test_prep</span> <span class="o">=</span> <span class="n">submission_pipeline</span><span class="p">.</span><span class="nf">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># make prediction on test set
</span><span class="n">y_test_pred</span> <span class="o">=</span> <span class="n">final_model</span><span class="p">.</span><span class="nf">predict</span><span class="p">(</span><span class="n">X_test_prep</span><span class="p">).</span><span class="nf">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># generate submission file 
</span><span class="n">submission_df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">({</span><span class="sh">'</span><span class="s">Id</span><span class="sh">'</span><span class="p">:</span> <span class="n">test_ID</span><span class="p">,</span>
                            <span class="sh">'</span><span class="s">Cover_Type</span><span class="sh">'</span><span class="p">:</span> <span class="n">y_test_pred</span><span class="p">})</span>
<span class="n">submission_df</span><span class="p">.</span><span class="nf">to_csv</span><span class="p">(</span><span class="sh">"</span><span class="s">extra_tree_full_pipe.csv</span><span class="sh">"</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>Conclusion</strong>: The accuracy on the test set is computed by Kaggle. Our model obtained an accuracy of 77%. This approximately ranks in the top 10% of the competition.</p>
