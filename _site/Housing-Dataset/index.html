<footer id="attribution" style="float:right; color:#999; background:#fff;">
Created by Thibault Dody, 09/09/2019.
</footer>

<h1 id="housing-price-dataset">Housing Price Dataset</h1>

<figure>
<img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/banner.jpg" style="height=288px;" />
</figure>

<h2 id="table-of-content">Table of Content</h2>

<p><a href="#Section_1">1. Introduction</a></p>

<p><a href="#Section_2">2. Data Import and EDA</a><br />
    <a href="#Section_21">2.1. Import Libraries</a><br />
    <a href="#Section_22">2.2. Data Import</a><br />
    <a href="#Section_23">2.3. Exploratory Data Analysis</a><br />
      <a href="#Section_231">2.3.1 Interior</a><br />
      <a href="#Section_232">2.3.2 Exterior</a><br />
      <a href="#Section_233">2.3.3 Miscellaneous</a></p>

<p><a href="#Section_3">3. Pre-Processing</a></p>

<p><a href="#Section_4">4. Models</a><br />
    <a href="#Section_41">4.1. Benchmarking</a><br />
    <a href="#Section_42">4.2. Feature Importances</a><br />
    <a href="#Section_43">4.3. Result Correlation and Model Behaviors</a><br />
    <a href="#Section_44">4.4. Ensembling</a><br />
    <a href="#Section_45">4.5. Fine Tuning</a><br />
    <a href="#Section_46">4.6. Predictions</a></p>

<hr />
<p><a id="Section_1"></a></p>
<h2 id="1-introduction">1. Introduction</h2>

<p>Ask a home buyer to describe their dream house, and they probably won’t begin with the height of the basement ceiling or the proximity to an east-west railroad. But this playground competition’s dataset proves that much more influences price negotiations than the number of bedrooms or a white-picket fence.</p>

<p>With 79 explanatory variables describing (almost) every aspect of residential homes in Ames, Iowa, this competition challenges you to predict the final price of each home.</p>

<hr />
<p><a id="Section_2"></a></p>
<h2 id="2-dataset-import-and-eda">2. Dataset Import and EDA</h2>
<p><a id="Section_21"></a></p>
<h3 id="21-import-libraries">2.1 Import Libraries</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># import libraries
</span><span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="n">np</span><span class="p">.</span><span class="nf">set_printoptions</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
<span class="n">pd</span><span class="p">.</span><span class="nf">set_option</span><span class="p">(</span><span class="sh">'</span><span class="s">display.max_columns</span><span class="sh">'</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
<span class="n">pd</span><span class="p">.</span><span class="nf">set_option</span><span class="p">(</span><span class="sh">'</span><span class="s">display.max_rows</span><span class="sh">'</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

<span class="kn">import</span> <span class="n">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="n">seaborn</span> <span class="k">as</span> <span class="n">sns</span>
<span class="kn">import</span> <span class="n">matplotlib.ticker</span> <span class="k">as</span> <span class="n">plticker</span>
<span class="n">sns</span><span class="p">.</span><span class="nf">set_style</span><span class="p">(</span><span class="sh">"</span><span class="s">whitegrid</span><span class="sh">"</span><span class="p">)</span>
<span class="n">mycols</span> <span class="o">=</span> <span class="p">[</span><span class="sh">"</span><span class="s">#66c2ff</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">#5cd6d6</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">#00cc99</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">#85e085</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">#ffd966</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">#ffb366</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">#ffb3b3</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">#dab3ff</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">#c2c2d6</span><span class="sh">"</span><span class="p">]</span>
<span class="n">sns</span><span class="p">.</span><span class="nf">set_palette</span><span class="p">(</span><span class="n">palette</span> <span class="o">=</span> <span class="n">mycols</span><span class="p">,</span> <span class="n">n_colors</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span>

<span class="kn">from</span> <span class="n">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="kn">from</span> <span class="n">scipy.stats</span> <span class="kn">import</span> <span class="n">skew</span><span class="p">,</span> <span class="n">norm</span><span class="p">,</span> <span class="n">probplot</span><span class="p">,</span> <span class="n">boxcox_normmax</span>
<span class="kn">from</span> <span class="n">scipy.special</span> <span class="kn">import</span> <span class="n">boxcox1p</span>
<span class="kn">from</span> <span class="n">scipy.stats.stats</span> <span class="kn">import</span> <span class="n">pearsonr</span>

<span class="kn">from</span> <span class="n">sklearn.feature_selection</span> <span class="kn">import</span> <span class="n">SelectFromModel</span>
<span class="kn">from</span> <span class="n">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span><span class="p">,</span> <span class="n">cross_val_score</span><span class="p">,</span> <span class="n">KFold</span>
<span class="kn">from</span> <span class="n">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">ElasticNet</span><span class="p">,</span> <span class="n">Lasso</span><span class="p">,</span> <span class="n">Ridge</span><span class="p">,</span> <span class="n">RidgeCV</span><span class="p">,</span> <span class="n">LassoCV</span><span class="p">,</span> <span class="n">ElasticNetCV</span><span class="p">,</span> <span class="n">BayesianRidge</span><span class="p">,</span> <span class="n">LinearRegression</span>
<span class="kn">from</span> <span class="n">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeRegressor</span>
<span class="kn">from</span> <span class="n">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVR</span>
<span class="kn">from</span> <span class="n">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span><span class="p">,</span>  <span class="n">GradientBoostingRegressor</span><span class="p">,</span> <span class="n">ExtraTreesRegressor</span>
<span class="kn">from</span> <span class="n">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsRegressor</span>
<span class="kn">from</span> <span class="n">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span><span class="p">,</span> <span class="n">ShuffleSplit</span>
<span class="kn">from</span> <span class="n">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">RobustScaler</span>
<span class="kn">from</span> <span class="n">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">make_pipeline</span>
<span class="kn">from</span> <span class="n">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>

<span class="kn">from</span> <span class="n">lightgbm</span> <span class="kn">import</span> <span class="n">LGBMRegressor</span>
<span class="kn">from</span> <span class="n">xgboost</span> <span class="kn">import</span> <span class="n">XGBRegressor</span>

<span class="kn">from</span> <span class="n">mlxtend.regressor</span> <span class="kn">import</span> <span class="n">StackingCVRegressor</span>

<span class="kn">import</span> <span class="n">warnings</span>
<span class="n">warnings</span><span class="p">.</span><span class="nf">simplefilter</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="sh">'</span><span class="s">ignore</span><span class="sh">'</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="nb">FutureWarning</span><span class="p">)</span>

<span class="n">decimals</span> <span class="o">=</span> <span class="mi">2</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
</code></pre></div></div>

<p><a id="Section_22"></a></p>
<h3 id="22-data-import">2.2 Data Import</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># load data
</span><span class="n">train</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_csv</span><span class="p">(</span><span class="sh">'</span><span class="s">./data/train.csv</span><span class="sh">'</span><span class="p">)</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_csv</span><span class="p">(</span><span class="sh">'</span><span class="s">./data/test.csv</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">Datasets are loaded.</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Datasets are loaded.
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">print </span><span class="p">(</span><span class="sh">"</span><span class="s">Train: </span><span class="sh">"</span><span class="p">,</span><span class="n">train</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="sh">"</span><span class="s">sales and </span><span class="sh">"</span><span class="p">,</span><span class="n">train</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="sh">"</span><span class="s">features</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print </span><span class="p">(</span><span class="sh">"</span><span class="s">Test: </span><span class="sh">"</span><span class="p">,</span><span class="n">test</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="sh">"</span><span class="s">sales and </span><span class="sh">"</span><span class="p">,</span><span class="n">test</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="sh">"</span><span class="s">features</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Train:  1460 sales and  81 features
Test:  1459 sales and  80 features
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># explore data
</span><span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Here are a few observations: </span><span class="sh">"</span><span class="p">)</span>
<span class="n">train</span><span class="p">.</span><span class="nf">head</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Here are a few observations: 
</code></pre></div></div>

<div style="overflow-x:auto;">
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Id</th>
      <th>MSSubClass</th>
      <th>MSZoning</th>
      <th>LotFrontage</th>
      <th>LotArea</th>
      <th>Street</th>
      <th>Alley</th>
      <th>LotShape</th>
      <th>LandContour</th>
      <th>Utilities</th>
      <th>LotConfig</th>
      <th>LandSlope</th>
      <th>Neighborhood</th>
      <th>Condition1</th>
      <th>Condition2</th>
      <th>BldgType</th>
      <th>HouseStyle</th>
      <th>OverallQual</th>
      <th>OverallCond</th>
      <th>YearBuilt</th>
      <th>YearRemodAdd</th>
      <th>RoofStyle</th>
      <th>RoofMatl</th>
      <th>Exterior1st</th>
      <th>Exterior2nd</th>
      <th>MasVnrType</th>
      <th>MasVnrArea</th>
      <th>ExterQual</th>
      <th>ExterCond</th>
      <th>Foundation</th>
      <th>BsmtQual</th>
      <th>BsmtCond</th>
      <th>BsmtExposure</th>
      <th>BsmtFinType1</th>
      <th>BsmtFinSF1</th>
      <th>BsmtFinType2</th>
      <th>BsmtFinSF2</th>
      <th>BsmtUnfSF</th>
      <th>TotalBsmtSF</th>
      <th>Heating</th>
      <th>HeatingQC</th>
      <th>CentralAir</th>
      <th>Electrical</th>
      <th>1stFlrSF</th>
      <th>2ndFlrSF</th>
      <th>LowQualFinSF</th>
      <th>GrLivArea</th>
      <th>BsmtFullBath</th>
      <th>BsmtHalfBath</th>
      <th>FullBath</th>
      <th>HalfBath</th>
      <th>BedroomAbvGr</th>
      <th>KitchenAbvGr</th>
      <th>KitchenQual</th>
      <th>TotRmsAbvGrd</th>
      <th>Functional</th>
      <th>Fireplaces</th>
      <th>FireplaceQu</th>
      <th>GarageType</th>
      <th>GarageYrBlt</th>
      <th>GarageFinish</th>
      <th>GarageCars</th>
      <th>GarageArea</th>
      <th>GarageQual</th>
      <th>GarageCond</th>
      <th>PavedDrive</th>
      <th>WoodDeckSF</th>
      <th>OpenPorchSF</th>
      <th>EnclosedPorch</th>
      <th>3SsnPorch</th>
      <th>ScreenPorch</th>
      <th>PoolArea</th>
      <th>PoolQC</th>
      <th>Fence</th>
      <th>MiscFeature</th>
      <th>MiscVal</th>
      <th>MoSold</th>
      <th>YrSold</th>
      <th>SaleType</th>
      <th>SaleCondition</th>
      <th>SalePrice</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>60</td>
      <td>RL</td>
      <td>65.0</td>
      <td>8450</td>
      <td>Pave</td>
      <td>NaN</td>
      <td>Reg</td>
      <td>Lvl</td>
      <td>AllPub</td>
      <td>Inside</td>
      <td>Gtl</td>
      <td>CollgCr</td>
      <td>Norm</td>
      <td>Norm</td>
      <td>1Fam</td>
      <td>2Story</td>
      <td>7</td>
      <td>5</td>
      <td>2003</td>
      <td>2003</td>
      <td>Gable</td>
      <td>CompShg</td>
      <td>VinylSd</td>
      <td>VinylSd</td>
      <td>BrkFace</td>
      <td>196.0</td>
      <td>Gd</td>
      <td>TA</td>
      <td>PConc</td>
      <td>Gd</td>
      <td>TA</td>
      <td>No</td>
      <td>GLQ</td>
      <td>706</td>
      <td>Unf</td>
      <td>0</td>
      <td>150</td>
      <td>856</td>
      <td>GasA</td>
      <td>Ex</td>
      <td>Y</td>
      <td>SBrkr</td>
      <td>856</td>
      <td>854</td>
      <td>0</td>
      <td>1710</td>
      <td>1</td>
      <td>0</td>
      <td>2</td>
      <td>1</td>
      <td>3</td>
      <td>1</td>
      <td>Gd</td>
      <td>8</td>
      <td>Typ</td>
      <td>0</td>
      <td>NaN</td>
      <td>Attchd</td>
      <td>2003.0</td>
      <td>RFn</td>
      <td>2</td>
      <td>548</td>
      <td>TA</td>
      <td>TA</td>
      <td>Y</td>
      <td>0</td>
      <td>61</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>2</td>
      <td>2008</td>
      <td>WD</td>
      <td>Normal</td>
      <td>208500</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>20</td>
      <td>RL</td>
      <td>80.0</td>
      <td>9600</td>
      <td>Pave</td>
      <td>NaN</td>
      <td>Reg</td>
      <td>Lvl</td>
      <td>AllPub</td>
      <td>FR2</td>
      <td>Gtl</td>
      <td>Veenker</td>
      <td>Feedr</td>
      <td>Norm</td>
      <td>1Fam</td>
      <td>1Story</td>
      <td>6</td>
      <td>8</td>
      <td>1976</td>
      <td>1976</td>
      <td>Gable</td>
      <td>CompShg</td>
      <td>MetalSd</td>
      <td>MetalSd</td>
      <td>None</td>
      <td>0.0</td>
      <td>TA</td>
      <td>TA</td>
      <td>CBlock</td>
      <td>Gd</td>
      <td>TA</td>
      <td>Gd</td>
      <td>ALQ</td>
      <td>978</td>
      <td>Unf</td>
      <td>0</td>
      <td>284</td>
      <td>1262</td>
      <td>GasA</td>
      <td>Ex</td>
      <td>Y</td>
      <td>SBrkr</td>
      <td>1262</td>
      <td>0</td>
      <td>0</td>
      <td>1262</td>
      <td>0</td>
      <td>1</td>
      <td>2</td>
      <td>0</td>
      <td>3</td>
      <td>1</td>
      <td>TA</td>
      <td>6</td>
      <td>Typ</td>
      <td>1</td>
      <td>TA</td>
      <td>Attchd</td>
      <td>1976.0</td>
      <td>RFn</td>
      <td>2</td>
      <td>460</td>
      <td>TA</td>
      <td>TA</td>
      <td>Y</td>
      <td>298</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>5</td>
      <td>2007</td>
      <td>WD</td>
      <td>Normal</td>
      <td>181500</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>60</td>
      <td>RL</td>
      <td>68.0</td>
      <td>11250</td>
      <td>Pave</td>
      <td>NaN</td>
      <td>IR1</td>
      <td>Lvl</td>
      <td>AllPub</td>
      <td>Inside</td>
      <td>Gtl</td>
      <td>CollgCr</td>
      <td>Norm</td>
      <td>Norm</td>
      <td>1Fam</td>
      <td>2Story</td>
      <td>7</td>
      <td>5</td>
      <td>2001</td>
      <td>2002</td>
      <td>Gable</td>
      <td>CompShg</td>
      <td>VinylSd</td>
      <td>VinylSd</td>
      <td>BrkFace</td>
      <td>162.0</td>
      <td>Gd</td>
      <td>TA</td>
      <td>PConc</td>
      <td>Gd</td>
      <td>TA</td>
      <td>Mn</td>
      <td>GLQ</td>
      <td>486</td>
      <td>Unf</td>
      <td>0</td>
      <td>434</td>
      <td>920</td>
      <td>GasA</td>
      <td>Ex</td>
      <td>Y</td>
      <td>SBrkr</td>
      <td>920</td>
      <td>866</td>
      <td>0</td>
      <td>1786</td>
      <td>1</td>
      <td>0</td>
      <td>2</td>
      <td>1</td>
      <td>3</td>
      <td>1</td>
      <td>Gd</td>
      <td>6</td>
      <td>Typ</td>
      <td>1</td>
      <td>TA</td>
      <td>Attchd</td>
      <td>2001.0</td>
      <td>RFn</td>
      <td>2</td>
      <td>608</td>
      <td>TA</td>
      <td>TA</td>
      <td>Y</td>
      <td>0</td>
      <td>42</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>9</td>
      <td>2008</td>
      <td>WD</td>
      <td>Normal</td>
      <td>223500</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>70</td>
      <td>RL</td>
      <td>60.0</td>
      <td>9550</td>
      <td>Pave</td>
      <td>NaN</td>
      <td>IR1</td>
      <td>Lvl</td>
      <td>AllPub</td>
      <td>Corner</td>
      <td>Gtl</td>
      <td>Crawfor</td>
      <td>Norm</td>
      <td>Norm</td>
      <td>1Fam</td>
      <td>2Story</td>
      <td>7</td>
      <td>5</td>
      <td>1915</td>
      <td>1970</td>
      <td>Gable</td>
      <td>CompShg</td>
      <td>Wd Sdng</td>
      <td>Wd Shng</td>
      <td>None</td>
      <td>0.0</td>
      <td>TA</td>
      <td>TA</td>
      <td>BrkTil</td>
      <td>TA</td>
      <td>Gd</td>
      <td>No</td>
      <td>ALQ</td>
      <td>216</td>
      <td>Unf</td>
      <td>0</td>
      <td>540</td>
      <td>756</td>
      <td>GasA</td>
      <td>Gd</td>
      <td>Y</td>
      <td>SBrkr</td>
      <td>961</td>
      <td>756</td>
      <td>0</td>
      <td>1717</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>3</td>
      <td>1</td>
      <td>Gd</td>
      <td>7</td>
      <td>Typ</td>
      <td>1</td>
      <td>Gd</td>
      <td>Detchd</td>
      <td>1998.0</td>
      <td>Unf</td>
      <td>3</td>
      <td>642</td>
      <td>TA</td>
      <td>TA</td>
      <td>Y</td>
      <td>0</td>
      <td>35</td>
      <td>272</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>2</td>
      <td>2006</td>
      <td>WD</td>
      <td>Abnorml</td>
      <td>140000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>60</td>
      <td>RL</td>
      <td>84.0</td>
      <td>14260</td>
      <td>Pave</td>
      <td>NaN</td>
      <td>IR1</td>
      <td>Lvl</td>
      <td>AllPub</td>
      <td>FR2</td>
      <td>Gtl</td>
      <td>NoRidge</td>
      <td>Norm</td>
      <td>Norm</td>
      <td>1Fam</td>
      <td>2Story</td>
      <td>8</td>
      <td>5</td>
      <td>2000</td>
      <td>2000</td>
      <td>Gable</td>
      <td>CompShg</td>
      <td>VinylSd</td>
      <td>VinylSd</td>
      <td>BrkFace</td>
      <td>350.0</td>
      <td>Gd</td>
      <td>TA</td>
      <td>PConc</td>
      <td>Gd</td>
      <td>TA</td>
      <td>Av</td>
      <td>GLQ</td>
      <td>655</td>
      <td>Unf</td>
      <td>0</td>
      <td>490</td>
      <td>1145</td>
      <td>GasA</td>
      <td>Ex</td>
      <td>Y</td>
      <td>SBrkr</td>
      <td>1145</td>
      <td>1053</td>
      <td>0</td>
      <td>2198</td>
      <td>1</td>
      <td>0</td>
      <td>2</td>
      <td>1</td>
      <td>4</td>
      <td>1</td>
      <td>Gd</td>
      <td>9</td>
      <td>Typ</td>
      <td>1</td>
      <td>TA</td>
      <td>Attchd</td>
      <td>2000.0</td>
      <td>RFn</td>
      <td>3</td>
      <td>836</td>
      <td>TA</td>
      <td>TA</td>
      <td>Y</td>
      <td>192</td>
      <td>84</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>12</td>
      <td>2008</td>
      <td>WD</td>
      <td>Normal</td>
      <td>250000</td>
    </tr>
  </tbody>
</table>
</div>

<p><a id="Section_23"></a></p>
<h3 id="23-exploratory-data-analysis">2.3 Exploratory Data Analysis</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># list features
</span><span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">List of features:</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">train</span><span class="p">.</span><span class="n">columns</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>List of features:
Index(['Id', 'MSSubClass', 'MSZoning', 'LotFrontage', 'LotArea', 'Street',
       'Alley', 'LotShape', 'LandContour', 'Utilities', 'LotConfig',
       'LandSlope', 'Neighborhood', 'Condition1', 'Condition2', 'BldgType',
       'HouseStyle', 'OverallQual', 'OverallCond', 'YearBuilt', 'YearRemodAdd',
       'RoofStyle', 'RoofMatl', 'Exterior1st', 'Exterior2nd', 'MasVnrType',
       'MasVnrArea', 'ExterQual', 'ExterCond', 'Foundation', 'BsmtQual',
       'BsmtCond', 'BsmtExposure', 'BsmtFinType1', 'BsmtFinSF1',
       'BsmtFinType2', 'BsmtFinSF2', 'BsmtUnfSF', 'TotalBsmtSF', 'Heating',
       'HeatingQC', 'CentralAir', 'Electrical', '1stFlrSF', '2ndFlrSF',
       'LowQualFinSF', 'GrLivArea', 'BsmtFullBath', 'BsmtHalfBath', 'FullBath',
       'HalfBath', 'BedroomAbvGr', 'KitchenAbvGr', 'KitchenQual',
       'TotRmsAbvGrd', 'Functional', 'Fireplaces', 'FireplaceQu', 'GarageType',
       'GarageYrBlt', 'GarageFinish', 'GarageCars', 'GarageArea', 'GarageQual',
       'GarageCond', 'PavedDrive', 'WoodDeckSF', 'OpenPorchSF',
       'EnclosedPorch', '3SsnPorch', 'ScreenPorch', 'PoolArea', 'PoolQC',
       'Fence', 'MiscFeature', 'MiscVal', 'MoSold', 'YrSold', 'SaleType',
       'SaleCondition', 'SalePrice'],
      dtype='object')
</code></pre></div></div>

<p>The features are defined as:</p>
<ul>
  <li>Order (Discrete): Observation number</li>
  <li>PID (Nominal): Parcel identification number  - can be used with city web site for parcel review.</li>
  <li>MS SubClass (Nominal): Identifies the type of dwelling involved in the sale.</li>
  <li>MS Zoning (Nominal): Identifies the general zoning classification of the sale.</li>
  <li>Lot Frontage (Continuous): Linear feet of street connected to property</li>
  <li>Lot Area (Continuous): Lot size in square feet</li>
  <li>Street (Nominal): Type of road access to property</li>
  <li>Alley (Nominal): Type of alley access to property</li>
  <li>Lot Shape (Ordinal): General shape of property</li>
  <li>Land Contour (Nominal): Flatness of the property</li>
  <li>Utilities (Ordinal): Type of utilities available</li>
  <li>Lot Config (Nominal): Lot configuration</li>
  <li>Land Slope (Ordinal): Slope of property</li>
  <li>Neighborhood (Nominal): Physical locations within Ames city limits (map available)</li>
  <li>Condition 1 (Nominal): Proximity to various conditions</li>
  <li>Condition 2 (Nominal): Proximity to various conditions (if more than one is present)</li>
  <li>Bldg Type (Nominal): Type of dwelling</li>
  <li>House Style (Nominal): Style of dwelling</li>
  <li>Overall Qual (Ordinal): Rates the overall material and finish of the house</li>
  <li>Overall Cond (Ordinal): Rates the overall condition of the house</li>
  <li>Year Built (Discrete): Original construction date</li>
  <li>Year Remod/Add (Discrete): Remodel date (same as construction date if no remodeling or additions)</li>
  <li>Roof Style (Nominal): Type of roof</li>
  <li>Roof Matl (Nominal): Roof material</li>
  <li>Exterior 1 (Nominal): Exterior covering on house</li>
  <li>Exterior 2 (Nominal): Exterior covering on house (if more than one material)</li>
  <li>Mas Vnr Type (Nominal): Masonry veneer type</li>
  <li>Mas Vnr Area (Continuous): Masonry veneer area in square feet</li>
  <li>Exter Qual (Ordinal): Evaluates the quality of the material on the exterior</li>
  <li>Exter Cond (Ordinal): Evaluates the present condition of the material on the exterior</li>
  <li>Foundation (Nominal): Type of foundation</li>
  <li>Bsmt Qual (Ordinal): Evaluates the height of the basement</li>
  <li>Bsmt Cond (Ordinal): Evaluates the general condition of the basement</li>
  <li>Bsmt Exposure	(Ordinal): Refers to walkout or garden level walls</li>
  <li>BsmtFin Type 1	(Ordinal): Rating of basement finished area</li>
  <li>BsmtFin SF 1 (Continuous): Type 1 finished square feet</li>
  <li>BsmtFinType 2	(Ordinal): Rating of basement finished area (if multiple types)</li>
  <li>BsmtFin SF 2 (Continuous): Type 2 finished square feet</li>
  <li>Bsmt Unf SF (Continuous): Unfinished square feet of basement area</li>
  <li>Total Bsmt SF (Continuous): Total square feet of basement area</li>
  <li>Heating	(Nominal): Type of heating</li>
  <li>HeatingQC (Ordinal): Heating quality and condition</li>
  <li>Central Air (Nominal): Central air conditioning</li>
  <li>Electrical (Ordinal): Electrical system</li>
  <li>1st Flr SF (Continuous): First Floor square feet</li>
  <li>2nd Flr SF (Continuous)	: Second floor square feet</li>
  <li>Low Qual Fin SF (Continuous): Low quality finished square feet (all floors)</li>
  <li>Gr Liv Area (Continuous): Above grade (ground) living area square feet</li>
  <li>Bsmt Full Bath (Discrete): Basement full bathrooms</li>
  <li>Bsmt Half Bath (Discrete): Basement half bathrooms</li>
  <li>Full Bath (Discrete): Full bathrooms above grade</li>
  <li>Half Bath (Discrete): Half baths above grade</li>
  <li>Bedroom (Discrete): Bedrooms above grade (does NOT include basement bedrooms)</li>
  <li>Kitchen (Discrete): Kitchens above grade</li>
  <li>KitchenQual (Ordinal): Kitchen quality</li>
  <li>TotRmsAbvGrd	(Discrete): Total rooms above grade (does not include bathrooms)</li>
  <li>Functional (Ordinal): Home functionality (Assume typical unless deductions are warranted)</li>
  <li>Fireplaces (Discrete): Number of fireplaces</li>
  <li>FireplaceQu (Ordinal): Fireplace quality</li>
  <li>Garage Type (Nominal): Garage location</li>
  <li>Garage Yr Blt (Discrete): Year garage was built</li>
  <li>Garage Finish (Ordinal)	: Interior finish of the garage</li>
  <li>Garage Cars (Discrete): Size of garage in car capacity</li>
  <li>Garage Area (Continuous): Size of garage in square feet</li>
  <li>Garage Qual (Ordinal): Garage quality</li>
  <li>Garage Cond (Ordinal): Garage condition</li>
  <li>Paved Drive (Ordinal): Paved driveway</li>
  <li>Wood Deck SF (Continuous): Wood deck area in square feet</li>
  <li>Open Porch SF (Continuous): Open porch area in square feet</li>
  <li>Enclosed Porch (Continuous): Enclosed porch area in square feet</li>
  <li>3-Ssn Porch (Continuous): Three season porch area in square feet</li>
  <li>Screen Porch (Continuous): Screen porch area in square feet</li>
  <li>Pool Area (Continuous): Pool area in square feet</li>
  <li>Pool QC (Ordinal): Pool quality</li>
  <li>Fence (Ordinal): Fence quality</li>
  <li>Misc Feature (Nominal): Miscellaneous feature not covered in other categories</li>
  <li>Misc Val (Continuous): $$Value of miscellaneous feature</li>
  <li>Mo Sold (Discrete): Month Sold (MM)</li>
  <li>Yr Sold (Discrete): Year Sold (YYYY)</li>
  <li>Sale Type (Nominal): Type of sale</li>
  <li>Sale Condition (Nominal): Condition of sale</li>
  <li>SalePrice (Continuous): Sale price $$</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># explore data
</span><span class="n">train</span><span class="p">.</span><span class="nf">info</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 1460 entries, 0 to 1459
Data columns (total 81 columns):
Id               1460 non-null int64
MSSubClass       1460 non-null int64
MSZoning         1460 non-null object
LotFrontage      1201 non-null float64
LotArea          1460 non-null int64
Street           1460 non-null object
Alley            91 non-null object
LotShape         1460 non-null object
LandContour      1460 non-null object
Utilities        1460 non-null object
LotConfig        1460 non-null object
LandSlope        1460 non-null object
Neighborhood     1460 non-null object
Condition1       1460 non-null object
Condition2       1460 non-null object
BldgType         1460 non-null object
HouseStyle       1460 non-null object
OverallQual      1460 non-null int64
OverallCond      1460 non-null int64
YearBuilt        1460 non-null int64
YearRemodAdd     1460 non-null int64
RoofStyle        1460 non-null object
RoofMatl         1460 non-null object
Exterior1st      1460 non-null object
Exterior2nd      1460 non-null object
MasVnrType       1452 non-null object
MasVnrArea       1452 non-null float64
ExterQual        1460 non-null object
ExterCond        1460 non-null object
Foundation       1460 non-null object
BsmtQual         1423 non-null object
BsmtCond         1423 non-null object
BsmtExposure     1422 non-null object
BsmtFinType1     1423 non-null object
BsmtFinSF1       1460 non-null int64
BsmtFinType2     1422 non-null object
BsmtFinSF2       1460 non-null int64
BsmtUnfSF        1460 non-null int64
TotalBsmtSF      1460 non-null int64
Heating          1460 non-null object
HeatingQC        1460 non-null object
CentralAir       1460 non-null object
Electrical       1459 non-null object
1stFlrSF         1460 non-null int64
2ndFlrSF         1460 non-null int64
LowQualFinSF     1460 non-null int64
GrLivArea        1460 non-null int64
BsmtFullBath     1460 non-null int64
BsmtHalfBath     1460 non-null int64
FullBath         1460 non-null int64
HalfBath         1460 non-null int64
BedroomAbvGr     1460 non-null int64
KitchenAbvGr     1460 non-null int64
KitchenQual      1460 non-null object
TotRmsAbvGrd     1460 non-null int64
Functional       1460 non-null object
Fireplaces       1460 non-null int64
FireplaceQu      770 non-null object
GarageType       1379 non-null object
GarageYrBlt      1379 non-null float64
GarageFinish     1379 non-null object
GarageCars       1460 non-null int64
GarageArea       1460 non-null int64
GarageQual       1379 non-null object
GarageCond       1379 non-null object
PavedDrive       1460 non-null object
WoodDeckSF       1460 non-null int64
OpenPorchSF      1460 non-null int64
EnclosedPorch    1460 non-null int64
3SsnPorch        1460 non-null int64
ScreenPorch      1460 non-null int64
PoolArea         1460 non-null int64
PoolQC           7 non-null object
Fence            281 non-null object
MiscFeature      54 non-null object
MiscVal          1460 non-null int64
MoSold           1460 non-null int64
YrSold           1460 non-null int64
SaleType         1460 non-null object
SaleCondition    1460 non-null object
SalePrice        1460 non-null int64
dtypes: float64(3), int64(35), object(43)
memory usage: 924.0+ KB
</code></pre></div></div>

<p>As listed above, certain features contain outliers. We can plot a bar plot of the proportion of missing values. This inspection will help target the specific features which require some additional work.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># count missing values per features
</span><span class="n">missing_fraction</span> <span class="o">=</span> <span class="n">train</span><span class="p">.</span><span class="nf">isnull</span><span class="p">().</span><span class="nf">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">train</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># filter to keep only features with missing values
</span><span class="n">missing_fraction</span> <span class="o">=</span> <span class="n">missing_fraction</span><span class="p">[</span><span class="n">missing_fraction</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>

<span class="c1"># sort by highest ratio
</span><span class="n">missing_fraction</span> <span class="o">=</span> <span class="n">missing_fraction</span><span class="p">.</span><span class="nf">sort_values</span><span class="p">()</span>

<span class="c1"># plot
</span><span class="n">missing_fraction</span><span class="p">.</span><span class="n">plot</span><span class="p">.</span><span class="nf">bar</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="sh">'</span><span class="s">Fraction of missing values</span><span class="sh">'</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">There are {} features with missing values.</span><span class="sh">"</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">missing_fraction</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>There are 19 features with missing values.
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_17_1.png" />
</figure>

<p>We now inspect the distribution of our target feature. Indeed, most machine learning model perform well is the target feature is normally distributed. To check if it is the case, we can plot the distribution of the sale prices against standard distribution (Normal, Log…).</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">y</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="sh">'</span><span class="s">SalePrice</span><span class="sh">'</span><span class="p">]</span>

<span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">norm</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="n">sns</span><span class="p">.</span><span class="nf">distplot</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">legend</span><span class="p">([</span><span class="sh">'</span><span class="s">Normal distribution ($$\mu=$$ {:.2f} and $$\sigma=$$ {:.2f} )</span><span class="sh">'</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)],</span> <span class="n">loc</span> <span class="o">=</span> <span class="sh">'</span><span class="s">best</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">ylabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Frequency</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">title</span><span class="p">(</span><span class="sh">'</span><span class="s">Histogram of SalePrice</span><span class="sh">'</span><span class="p">);</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">figure</span><span class="p">()</span>
<span class="n">res</span> <span class="o">=</span> <span class="nf">probplot</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="n">plt</span><span class="p">);</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_19_0.png" />
</figure>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_19_1.png" />
</figure>

<p>The above plots show that the sale price does cannot be approximated by a normal distribution. Indeed, the distribution plot and quantile-quantile plots are too different from the ones of a normal distribution.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="nf">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">title</span><span class="p">(</span><span class="sh">'</span><span class="s">Normal</span><span class="sh">'</span><span class="p">)</span>
<span class="n">sns</span><span class="p">.</span><span class="nf">distplot</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">kde</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="n">stats</span><span class="p">.</span><span class="n">norm</span><span class="p">)</span>

<span class="n">plt</span><span class="p">.</span><span class="nf">figure</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">title</span><span class="p">(</span><span class="sh">'</span><span class="s">Log Normal</span><span class="sh">'</span><span class="p">)</span>
<span class="n">sns</span><span class="p">.</span><span class="nf">distplot</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">kde</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="n">stats</span><span class="p">.</span><span class="n">lognorm</span><span class="p">)</span>

<span class="n">plt</span><span class="p">.</span><span class="nf">figure</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">title</span><span class="p">(</span><span class="sh">'</span><span class="s">Johnson SU</span><span class="sh">'</span><span class="p">)</span>
<span class="n">sns</span><span class="p">.</span><span class="nf">distplot</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">kde</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="n">stats</span><span class="p">.</span><span class="n">johnsonsu</span><span class="p">)</span>

<span class="n">plt</span><span class="p">.</span><span class="nf">figure</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">title</span><span class="p">(</span><span class="sh">'</span><span class="s">Johnson SB</span><span class="sh">'</span><span class="p">)</span>
<span class="n">sns</span><span class="p">.</span><span class="nf">distplot</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">kde</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="n">stats</span><span class="p">.</span><span class="n">johnsonsb</span><span class="p">);</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_21_0.png" />
</figure>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_21_1.png" />
</figure>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_21_2.png" />
</figure>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_21_3.png" />
</figure>

<p>From the above figures, it appears that the sale prices are not normally distributed. Indeed, the log-normal, Johnson SU, and Johnson SB are the best fit. By visual inspection, the best fit is obtained with the <strong>Johnson SU</strong> distribution. We can now modify the target feature accordingly.</p>

<p>We can also test the numerical features to determine if they are approximately normally distributed.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">numerical_features</span> <span class="o">=</span> <span class="p">[</span><span class="n">feature</span> <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">train</span><span class="p">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">train</span><span class="p">.</span><span class="n">dtypes</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span><span class="o">!=</span><span class="sh">'</span><span class="s">object</span><span class="sh">'</span><span class="p">]</span> 
<span class="n">qualitive_features</span> <span class="o">=</span> <span class="p">[</span><span class="n">feature</span> <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">train</span><span class="p">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">train</span><span class="p">.</span><span class="n">dtypes</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span><span class="o">==</span><span class="sh">'</span><span class="s">object</span><span class="sh">'</span><span class="p">]</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">shapiro_test</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">stats</span><span class="p">.</span><span class="nf">shapiro</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="nf">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">))[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.05</span>
<span class="n">shapiro_test_results</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="n">numerical_features</span><span class="p">]).</span><span class="nf">apply</span><span class="p">(</span><span class="n">shapiro_test</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">{} feature distributions can be considered as drawn from a normal distribution.</span><span class="sh">"</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">shapiro_test_results</span><span class="p">.</span><span class="nf">sum</span><span class="p">()))</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Shapiro test significance level set to 0.05.</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0 feature distributions can be considered as drawn from a normal distribution.
Shapiro test significance level set to 0.05.
</code></pre></div></div>

<p>In addition to the target feature, none of the other numerical feature can be considered normally distributed.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Compute the correlation matrix
</span><span class="n">corr</span> <span class="o">=</span> <span class="n">train</span><span class="p">.</span><span class="nf">corr</span><span class="p">()</span>
<span class="n">corr</span> <span class="o">=</span> <span class="n">corr</span><span class="p">.</span><span class="nf">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Generate a mask for the upper triangle
</span><span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros_like</span><span class="p">(</span><span class="n">corr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="nb">bool</span><span class="p">)</span>
<span class="n">mask</span><span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="nf">triu_indices_from</span><span class="p">(</span><span class="n">mask</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">True</span>

<span class="c1"># Set up the matplotlib figure
</span><span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">22</span><span class="p">,</span> <span class="mi">22</span><span class="p">))</span>

<span class="c1"># Generate a custom diverging colormap
</span><span class="n">cmap</span> <span class="o">=</span> <span class="n">sns</span><span class="p">.</span><span class="nf">diverging_palette</span><span class="p">(</span><span class="mi">220</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">as_cmap</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1"># Draw the heatmap with the mask and correct aspect ratio
</span><span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Correlation Map:</span><span class="sh">"</span><span class="p">)</span>
<span class="n">sns</span><span class="p">.</span><span class="nf">heatmap</span><span class="p">(</span><span class="n">corr</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">vmin</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">annot</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
            <span class="n">square</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span><span class="n">cbar_kws</span><span class="o">=</span><span class="p">{</span><span class="sh">"</span><span class="s">shrink</span><span class="sh">"</span><span class="p">:</span> <span class="p">.</span><span class="mi">3</span><span class="p">},</span><span class="n">annot_kws</span><span class="o">=</span><span class="p">{</span><span class="sh">"</span><span class="s">size</span><span class="sh">"</span><span class="p">:</span><span class="mi">9</span><span class="p">},</span><span class="n">fmt</span><span class="o">=</span><span class="sh">'</span><span class="s">.2g</span><span class="sh">'</span><span class="p">,)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="sh">'</span><span class="s">both</span><span class="sh">'</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="sh">'</span><span class="s">major</span><span class="sh">'</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">11</span><span class="p">);</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Correlation Map:
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_27_1.png" />
</figure>

<p><a id="Section_231"></a></p>
<h3 id="231-interior">2.3.1 Interior</h3>
<p>The following variables are assigned to the “Interior” group.</p>
<ul>
  <li>Bsmt Qual (Ordinal): Evaluates the height of the basement</li>
  <li>Bsmt Cond (Ordinal): Evaluates the general condition of the basement</li>
  <li>Bsmt Exposure	(Ordinal): Refers to walkout or garden level walls</li>
  <li>BsmtFin Type 1	(Ordinal): Rating of basement finished area</li>
  <li>BsmtFin SF 1 (Continuous): Type 1 finished square feet</li>
  <li>BsmtFinType 2	(Ordinal): Rating of basement finished area (if multiple types)</li>
  <li>BsmtFin SF 2 (Continuous): Type 2 finished square feet</li>
  <li>Bsmt Unf SF (Continuous): Unfinished square feet of basement area</li>
  <li>Total Bsmt SF (Continuous): Total square feet of basement area</li>
  <li>1st Flr SF (Continuous): First Floor square feet</li>
  <li>2nd Flr SF (Continuous)	: Second floor square feet</li>
  <li>Low Qual Fin SF (Continuous): Low quality finished square feet (all floors)</li>
  <li>Bsmt Full Bath (Discrete): Basement full bathrooms</li>
  <li>Bsmt Half Bath (Discrete): Basement half bathrooms</li>
  <li>Full Bath (Discrete): Full bathrooms above grade</li>
  <li>Half Bath (Discrete): Half baths above grade</li>
  <li>Bedroom (Discrete): Bedrooms above grade (does NOT include basement bedrooms)</li>
  <li>Kitchen (Discrete): Kitchens above grade</li>
  <li>KitchenQual (Ordinal): Kitchen quality</li>
  <li>TotRmsAbvGrd	(Discrete): Total rooms above grade (does not include bathrooms)</li>
  <li>Fireplaces (Discrete): Number of fireplaces</li>
  <li>FireplaceQu (Ordinal): Fireplace quality</li>
  <li>Gr Liv Area (Continuous): Above grade (ground) living area square feet</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sns</span><span class="p">.</span><span class="nf">set</span><span class="p">()</span>
<span class="n">sns</span><span class="p">.</span><span class="nf">set_style</span><span class="p">(</span><span class="sh">"</span><span class="s">whitegrid</span><span class="sh">"</span><span class="p">)</span>
<span class="n">sns</span><span class="p">.</span><span class="nf">set_palette</span><span class="p">(</span><span class="n">palette</span> <span class="o">=</span> <span class="n">mycols</span><span class="p">,</span> <span class="n">n_colors</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">plot_cat_feature_eda</span><span class="p">(</span><span class="n">featureName</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axarr</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="n">figsize</span> <span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span><span class="n">sharey</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    
    <span class="c1"># plot
</span>    <span class="c1">#plt.subplot(1,4,1)
</span>    <span class="n">sns</span><span class="p">.</span><span class="nf">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">featureName</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="sh">'</span><span class="s">SalePrice</span><span class="sh">'</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">train</span><span class="p">,</span><span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">axarr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">axarr</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">set_xticklabels</span><span class="p">(</span><span class="n">axarr</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>  
    
    <span class="c1">#plt.subplot(1,4,2)
</span>    <span class="n">plot</span> <span class="o">=</span> <span class="n">sns</span><span class="p">.</span><span class="nf">violinplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">featureName</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="sh">'</span><span class="s">SalePrice</span><span class="sh">'</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">train</span><span class="p">,</span> <span class="n">showmeans</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                          <span class="n">showmedians</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">showextrema</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">axarr</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">axarr</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nf">set_ylabel</span><span class="p">(</span><span class="sh">""</span><span class="p">)</span>
    <span class="n">axarr</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nf">set_xticklabels</span><span class="p">(</span><span class="n">axarr</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nf">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>  
    
    <span class="c1">#plt.subplot(1,4,3)
</span>    <span class="n">plot</span> <span class="o">=</span> <span class="n">sns</span><span class="p">.</span><span class="nf">swarmplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">featureName</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="sh">'</span><span class="s">SalePrice</span><span class="sh">'</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">train</span><span class="p">,</span><span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">axarr</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">axarr</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="nf">set_ylabel</span><span class="p">(</span><span class="sh">""</span><span class="p">)</span>
    <span class="n">axarr</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="nf">set_xticklabels</span><span class="p">(</span><span class="n">axarr</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="nf">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>  
    
    <span class="c1">#plt.subplot(1,4,4)
</span>    <span class="n">sns</span><span class="p">.</span><span class="nf">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">featureName</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="sh">'</span><span class="s">SalePrice</span><span class="sh">'</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">train</span><span class="p">,</span>
                <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">axarr</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
    <span class="n">axarr</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="nf">set_ylabel</span><span class="p">(</span><span class="sh">""</span><span class="p">)</span>
    <span class="n">axarr</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">train</span><span class="p">[</span><span class="sh">'</span><span class="s">SalePrice</span><span class="sh">'</span><span class="p">].</span><span class="nf">max</span><span class="p">()</span><span class="o">*</span><span class="mf">1.05</span><span class="p">)</span>
    <span class="n">axarr</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="nf">set_xticklabels</span><span class="p">(</span><span class="n">axarr</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="nf">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>  
    <span class="n">plt</span><span class="p">.</span><span class="nf">suptitle</span><span class="p">(</span><span class="n">featureName</span><span class="p">);</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">BsmtQual</span><span class="sh">'</span>
<span class="n">order</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">Fa</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">TA</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Gd</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Ex</span><span class="sh">'</span><span class="p">]</span>
<span class="nf">plot_cat_feature_eda</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_31_0.png" />
</figure>

<p><strong>COMMENT</strong>: We found an order of the classes for BsmtQual that produces an increase in the sale price. We will use this to create a ordinal feature. Most of the data is contained within the “TA” and “Gd” groups.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">BsmtCond</span><span class="sh">'</span>
<span class="n">order</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">Po</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Fa</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">TA</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Gd</span><span class="sh">'</span><span class="p">]</span>
<span class="nf">plot_cat_feature_eda</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_33_0.png" />
</figure>

<p><strong>COMMENT</strong>: We found an order of the classes for BsmtCond that produces an increase in the sale price. We will use this to create a ordinal feature. Most of the data is contained within the “TA” group.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">BsmtExposure</span><span class="sh">'</span>
<span class="n">order</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">No</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Mn</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Av</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Gd</span><span class="sh">'</span><span class="p">]</span>
<span class="nf">plot_cat_feature_eda</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_35_0.png" />
</figure>

<p><strong>COMMENT</strong>: We found an order of the classes for BsmtExposure that produces an increase in the sale price. We will use this to create a ordinal feature. Most of the data is contained within the “No” group.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">BsmtFinType1</span><span class="sh">'</span>
<span class="n">order</span> <span class="o">=</span> <span class="p">[</span><span class="sh">"</span><span class="s">Unf</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">LwQ</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Rec</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">BLQ</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">ALQ</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">GLQ</span><span class="sh">"</span><span class="p">]</span>
<span class="nf">plot_cat_feature_eda</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_37_0.png" />
</figure>

<p><strong>COMMENT</strong>: From the above data, it seems that a house with an unfinished basement has more value than any other type of basement except for the ones with a good quality. Since the order of the categories is not obvious, we will create dummy features.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">plot_num_feature_eda</span><span class="p">(</span><span class="n">featureName</span><span class="p">):</span>
    <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>
    <span class="n">grid</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nc">GridSpec</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.15</span><span class="p">)</span>
    
    <span class="c1"># plot
</span>    <span class="n">plt</span><span class="p">.</span><span class="nf">subplot</span><span class="p">(</span><span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="p">.</span><span class="nf">regplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">train</span><span class="p">[</span><span class="n">feature</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">train</span><span class="p">[</span><span class="sh">'</span><span class="s">SalePrice</span><span class="sh">'</span><span class="p">],</span> <span class="n">fit_reg</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">g</span><span class="p">.</span><span class="n">axes</span><span class="p">.</span><span class="nf">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,)</span>
    <span class="n">g</span><span class="p">.</span><span class="n">axes</span><span class="p">.</span><span class="nf">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,)</span>
    
    <span class="c1"># plot
</span>    <span class="n">plt</span><span class="p">.</span><span class="nf">subplot</span><span class="p">(</span><span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:])</span>
    <span class="n">sns</span><span class="p">.</span><span class="nf">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="sh">'</span><span class="s">Neighborhood</span><span class="sh">'</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">feature</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">train</span><span class="p">,</span> <span class="n">palette</span> <span class="o">=</span> <span class="n">mycols</span><span class="p">)</span>
    
    <span class="c1"># plot
</span>    <span class="n">plt</span><span class="p">.</span><span class="nf">subplot</span><span class="p">(</span><span class="n">grid</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]);</span>
    <span class="n">sns</span><span class="p">.</span><span class="nf">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="sh">'</span><span class="s">BldgType</span><span class="sh">'</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">feature</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">train</span><span class="p">,</span> <span class="n">palette</span> <span class="o">=</span> <span class="n">mycols</span><span class="p">)</span>
    
    <span class="c1"># plot
</span>    <span class="n">plt</span><span class="p">.</span><span class="nf">subplot</span><span class="p">(</span><span class="n">grid</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]);</span>
    <span class="n">sns</span><span class="p">.</span><span class="nf">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="sh">'</span><span class="s">HouseStyle</span><span class="sh">'</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">feature</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">train</span><span class="p">,</span> <span class="n">palette</span> <span class="o">=</span> <span class="n">mycols</span><span class="p">)</span>
    
    <span class="c1"># plot
</span>    <span class="n">plt</span><span class="p">.</span><span class="nf">subplot</span><span class="p">(</span><span class="n">grid</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]);</span>
    <span class="n">sns</span><span class="p">.</span><span class="nf">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="sh">'</span><span class="s">LotShape</span><span class="sh">'</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">feature</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">train</span><span class="p">,</span> <span class="n">palette</span> <span class="o">=</span> <span class="n">mycols</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">featureName</span><span class="p">);</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">BsmtFinSF1</span><span class="sh">'</span>
<span class="nf">plot_num_feature_eda</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>BsmtFinSF1
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_40_1.png" />
</figure>

<p><strong>COMMENT</strong>:</p>
<ul>
  <li>From the first plot, we observe a positive correlation between the sale prince and the Type 1 finished sft.</li>
  <li>From the box plot, we notice that the distribution of the sale price as function of the Type 1 finished sft is strongly linked to the neighborhood.</li>
  <li>The last three boxplots also show a strong dependence to the architecture (Building type, house style, and lot shape).</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">BsmtFinType2</span><span class="sh">'</span>
<span class="n">order</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">Unf</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">BLQ</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">ALQ</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Rec</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">LwQ</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">GLQ</span><span class="sh">'</span><span class="p">]</span>
<span class="nf">plot_cat_feature_eda</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_42_0.png" />
</figure>

<p><strong>COMMENT</strong>:</p>
<ul>
  <li>Most of the data is contained in the “Unfinished” group.</li>
  <li>The distribution of the data does not indicate that the sale price increases with the quality of the finish for the second basement.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">BsmtFinSF2</span><span class="sh">'</span>
<span class="nf">plot_num_feature_eda</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>BsmtFinSF2
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_44_1.png" />
</figure>

<p><strong>COMMENT</strong>:</p>
<ul>
  <li>A large portion of the data is associated to the value 0.</li>
  <li>There is no clear correlation between the sale price and this feature.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">BsmtUnfSF</span><span class="sh">'</span>
<span class="nf">plot_num_feature_eda</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>BsmtUnfSF
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_46_1.png" />
</figure>

<p><strong>COMMENT</strong></p>
<ul>
  <li>This feature is positively correlated to the sale price. A fraction of the data is assigned a 0 value.</li>
  <li>The area of unfinished basement varies greatly from one neighborhood to the other.</li>
  <li>The same conclusion can be made when looking at the type of house.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">TotalBsmtSF</span><span class="sh">'</span>
<span class="nf">plot_num_feature_eda</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>TotalBsmtSF
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_48_1.png" />
</figure>

<p><strong>COMMENT</strong></p>
<ul>
  <li>This feature is strongly positively correlated to the sale price. A small fraction of the data is assigned a 0 value.</li>
  <li>The area of unfinished basement varies greatly from one neighborhood to the other.</li>
  <li>However, the type of the house does not have a large impact on this feature.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">1stFlrSF</span><span class="sh">'</span>
<span class="nf">plot_num_feature_eda</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1stFlrSF
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_50_1.png" />
</figure>

<p><strong>COMMENT</strong></p>
<ul>
  <li>This feature is strongly positively correlated to the sale price.</li>
  <li>The surface of the first floor varies greatly from one neighborhood to the other.</li>
  <li>However, the type of the house does not have a large impact on this feature.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">2ndFlrSF</span><span class="sh">'</span>
<span class="nf">plot_num_feature_eda</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2ndFlrSF
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_52_1.png" />
</figure>

<p><strong>COMMENT</strong></p>
<ul>
  <li>This feature is strongly positively correlated to the sale price. Moreover, a large number of data points are assigned to the value 0. This can be explained because a large number of individual houses are only built with one floor.</li>
  <li>The surface of the second floor varies greatly from one neighborhood to the other.</li>
  <li>However, the type of the house does not have a large impact on this feature.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">LowQualFinSF</span><span class="sh">'</span>
<span class="nf">plot_num_feature_eda</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>LowQualFinSF
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_54_1.png" />
</figure>

<p><strong>COMMENT</strong></p>
<ul>
  <li>Most of the data is assigned the value 0.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">BedroomAbvGr</span><span class="sh">'</span>
<span class="nf">plot_cat_feature_eda</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_56_0.png" />
</figure>

<p><strong>COMMENT</strong></p>
<ul>
  <li>Most houses have between two and four bedrooms above grade level.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">KitchenAbvGr</span><span class="sh">'</span>
<span class="nf">plot_cat_feature_eda</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_58_0.png" />
</figure>

<p><strong>COMMENT</strong></p>
<ul>
  <li>Most houses have one single kitchen.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">KitchenQual</span><span class="sh">'</span>
<span class="n">order</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">Fa</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">TA</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Gd</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Ex</span><span class="sh">'</span><span class="p">]</span>
<span class="nf">plot_cat_feature_eda</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_60_0.png" />
</figure>

<p><strong>COMMENT</strong>: We found an order of the classes for KitchenQual that produces an increase in the sale price. We will use this to create a ordinal feature.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">TotRmsAbvGrd</span><span class="sh">'</span>
<span class="nf">plot_cat_feature_eda</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_62_0.png" />
</figure>

<p><strong>COMMENT</strong></p>
<ul>
  <li>There seems to be a positive correlation between the number of rooms and the sale prince.</li>
  <li>The extreme classes (2, 12, and 14) do not have enough data for to be reliable.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">Fireplaces</span><span class="sh">'</span>
<span class="nf">plot_cat_feature_eda</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_64_0.png" />
</figure>

<p><strong>COMMENT</strong></p>
<ul>
  <li>There seems to be a positive correlation between the number of fireplaces and the sale prince.</li>
  <li>The extreme class (3) do not have enough data for to be reliable.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">train</span><span class="p">[</span><span class="sh">'</span><span class="s">FireplaceQu</span><span class="sh">'</span><span class="p">].</span><span class="nf">unique</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>array([nan, 'TA', 'Gd', 'Fa', 'Ex', 'Po'], dtype=object)
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">FireplaceQu</span><span class="sh">'</span>
<span class="n">order</span> <span class="o">=</span> <span class="p">[</span><span class="sh">"</span><span class="s">Po</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Fa</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">TA</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Gd</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Ex</span><span class="sh">"</span><span class="p">]</span>
<span class="nf">plot_cat_feature_eda</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_67_0.png" />
</figure>

<p><strong>COMMENT</strong>: We found an order of the classes for FireplaceQu that produces an increase in the sale price. We will use this to create a ordinal feature.</p>

<p><strong>GrLivArea</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">GrLivArea</span><span class="sh">'</span>
<span class="nf">plot_num_feature_eda</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GrLivArea
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_70_1.png" />
</figure>

<p><strong>COMMENT</strong></p>
<ul>
  <li>This feature is strongly positively correlated to the sale price. Moreover, a large number of data points are assigned to the value 0. This can be explained because a large number of individual houses are only built with one floor.</li>
  <li>This feature varies greatly from one neighborhood to the other.</li>
  <li>However, the type of the house does not have a large impact on this feature.</li>
</ul>

<p><a id="Section_232"></a></p>
<h3 id="232-exterior">2.3.2 Exterior</h3>
<p>The following variables are assigned to the “Exterior” group.</p>
<ul>
  <li>MS SubClass (Nominal): Identifies the type of dwelling involved in the sale.</li>
  <li>Bldg Type (Nominal): Type of dwelling</li>
  <li>House Style (Nominal): Style of dwelling</li>
  <li>Overall Qual (Ordinal): Rates the overall material and finish of the house</li>
  <li>Overall Cond (Ordinal): Rates the overall condition of the house</li>
  <li>Year Built (Discrete): Original construction date</li>
  <li>Year Remod/Add (Discrete): Remodel date (same as construction date if no remodeling or additions)</li>
  <li>Foundation (Nominal): Type of foundation</li>
  <li>Functional (Ordinal): Home functionality (Assume typical unless deductions are warranted)</li>
  <li>Roof Style (Nominal): Type of roof</li>
  <li>Roof Matl (Nominal): Roof material</li>
  <li>Exterior 1 (Nominal): Exterior covering on house</li>
  <li>Exterior 2 (Nominal): Exterior covering on house (if more than one material)</li>
  <li>Mas Vnr Type (Nominal): Masonry veneer type</li>
  <li>Mas Vnr Area (Continuous): Masonry veneer area in square feet</li>
  <li>Exter Qual (Ordinal): Evaluates the quality of the material on the exterior</li>
  <li>Exter Cond (Ordinal): Evaluates the present condition of the material on the exterior</li>
  <li>Garage Type (Nominal): Garage location</li>
  <li>Garage Yr Blt (Discrete): Year garage was built</li>
  <li>Garage Finish (Ordinal)	: Interior finish of the garage</li>
  <li>Garage Cars (Discrete): Size of garage in car capacity</li>
  <li>Garage Area (Continuous): Size of garage in square feet</li>
  <li>Garage Qual (Ordinal): Garage quality</li>
  <li>Garage Cond (Ordinal): Garage condition</li>
  <li>Wood Deck SF (Continuous): Wood deck area in square feet</li>
  <li>Open Porch SF (Continuous): Open porch area in square feet</li>
  <li>Enclosed Porch (Continuous): Enclosed porch area in square feet</li>
  <li>3-Ssn Porch (Continuous): Three season porch area in square feet</li>
  <li>Screen Porch (Continuous): Screen porch area in square feet</li>
  <li>Pool Area (Continuous): Pool area in square feet</li>
  <li>Pool QC (Ordinal): Pool quality</li>
  <li>Fence (Ordinal): Fence quality</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">MSSubClass</span><span class="sh">'</span>
<span class="nf">plot_cat_feature_eda</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_73_0.png" />
</figure>

<p><strong>COMMENT</strong></p>
<ul>
  <li>Although this feature contains numerical value, it is meant to describe building style. We therefore turn the data into strings.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">BldgType</span><span class="sh">'</span>
<span class="nf">plot_cat_feature_eda</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_75_0.png" />
</figure>

<p><strong>COMMENT</strong></p>
<ul>
  <li>The feature is transformed using dummies.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">HouseStyle</span><span class="sh">'</span>
<span class="nf">plot_cat_feature_eda</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_77_0.png" />
</figure>

<p><strong>COMMENT</strong></p>
<ul>
  <li>The first two categories present a large number of extremely high values.</li>
  <li>This feature is turned into a set of dummy variables.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">OverallQual</span><span class="sh">'</span>
<span class="nf">plot_cat_feature_eda</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_79_0.png" />
</figure>

<p><strong>COMMENT</strong></p>
<ul>
  <li>As expected, the overall quality is strongly positively correlated to the sale price.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">OverallCond</span><span class="sh">'</span>
<span class="nf">plot_cat_feature_eda</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_81_0.png" />
</figure>

<p><strong>COMMENT</strong></p>
<ul>
  <li>As expected, the overall condition is correlated to the sale price. However, the class corresponding to a value of 5 has a higher meadian sale price than the class corresponding to the value 9.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">matplotlib.ticker</span> <span class="k">as</span> <span class="n">ticker</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">plot_date_feature</span><span class="p">(</span><span class="n">featureName</span><span class="p">,</span> <span class="n">stepsize</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axarr</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span> <span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>
    
    <span class="c1"># plot
</span>    <span class="c1">#plt.subplot(1,4,1)
</span>    <span class="n">sns</span><span class="p">.</span><span class="nf">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">feature</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="sh">'</span><span class="s">SalePrice</span><span class="sh">'</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">train</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">axarr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">axarr</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">set_xticklabels</span><span class="p">(</span><span class="n">axarr</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>  
    
    <span class="c1"># plot
</span>    <span class="c1">#plt.subplot(1,4,3)
</span>    <span class="n">plot</span> <span class="o">=</span> <span class="n">sns</span><span class="p">.</span><span class="nf">swarmplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">feature</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="sh">'</span><span class="s">SalePrice</span><span class="sh">'</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">train</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">axarr</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">axarr</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nf">set_ylabel</span><span class="p">(</span><span class="sh">""</span><span class="p">)</span>
    <span class="n">axarr</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nf">set_xticklabels</span><span class="p">(</span><span class="n">axarr</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nf">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
    
    <span class="c1"># purpose
</span>    <span class="c1">#plt.subplot(1,4,4)
</span>    <span class="n">sns</span><span class="p">.</span><span class="nf">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">feature</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="sh">'</span><span class="s">SalePrice</span><span class="sh">'</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">train</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">axarr</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">axarr</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="nf">set_ylabel</span><span class="p">(</span><span class="sh">""</span><span class="p">)</span>
    <span class="n">axarr</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">train</span><span class="p">[</span><span class="sh">'</span><span class="s">SalePrice</span><span class="sh">'</span><span class="p">].</span><span class="nf">max</span><span class="p">()</span><span class="o">*</span><span class="mf">1.05</span><span class="p">)</span>
    <span class="n">axarr</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="nf">set_xticklabels</span><span class="p">(</span><span class="n">axarr</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="nf">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">axarr</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">get_xticklabels</span><span class="p">():</span>
        <span class="n">label</span><span class="p">.</span><span class="nf">set_visible</span><span class="p">(</span><span class="nf">float</span><span class="p">(</span><span class="n">label</span><span class="p">.</span><span class="n">_text</span><span class="p">)</span> <span class="o">%</span> <span class="n">stepsize</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">axarr</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nf">get_xticklabels</span><span class="p">():</span>
        <span class="n">label</span><span class="p">.</span><span class="nf">set_visible</span><span class="p">(</span><span class="nf">float</span><span class="p">(</span><span class="n">label</span><span class="p">.</span><span class="n">_text</span><span class="p">)</span> <span class="o">%</span> <span class="n">stepsize</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">axarr</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="nf">get_xticklabels</span><span class="p">():</span>
        <span class="n">label</span><span class="p">.</span><span class="nf">set_visible</span><span class="p">(</span><span class="nf">float</span><span class="p">(</span><span class="n">label</span><span class="p">.</span><span class="n">_text</span><span class="p">)</span> <span class="o">%</span> <span class="n">stepsize</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="p">.</span><span class="nf">suptitle</span><span class="p">(</span><span class="n">featureName</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="nf">tight_layout</span><span class="p">();</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">YearRemodAdd</span><span class="sh">'</span>
<span class="nf">plot_date_feature</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_85_0.png" />
</figure>

<p><strong>COMMENT</strong></p>
<ul>
  <li>The newer the remodeling the higher the sale price.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">YearBuilt</span><span class="sh">'</span>
<span class="nf">plot_date_feature</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">stepsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_87_0.png" />
</figure>

<p><strong>COMMENT</strong></p>
<ul>
  <li>The general trend seems to depict a higher sale price for newer constructions.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">Foundation</span><span class="sh">'</span>
<span class="nf">plot_cat_feature_eda</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_89_0.png" />
</figure>

<p><strong>COMMENT</strong></p>
<ul>
  <li>The data is mostly gathered into the first three classes.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">Functional</span><span class="sh">'</span>
<span class="nf">plot_cat_feature_eda</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_91_0.png" />
</figure>

<p><strong>COMMENT</strong></p>
<ul>
  <li>Most of the data is stored under the “Typ” class.</li>
  <li>From the information about the dataset, we can identify an order with which the classes can be organized. The “Typ” class corresponds to the highest rank within this ordinal feature.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">RoofStyle</span><span class="sh">'</span>
<span class="nf">plot_cat_feature_eda</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_93_0.png" />
</figure>

<p><strong>COMMENT</strong></p>
<ul>
  <li>Most of the data is stored under the “Gable” and “Hip” classes.</li>
  <li>We create dummy variables to store the data.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">RoofMatl</span><span class="sh">'</span>
<span class="nf">plot_cat_feature_eda</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_95_0.png" />
</figure>

<p><strong>COMMENT</strong></p>
<ul>
  <li>Almost the entire dataset is stored under “CompShg” class.</li>
</ul>

<p><strong>Exterior1st and Exterior2nd</strong>
After inspection, it appears that most of the houses have the same class for the exterior features. We will use this to minimize the redundancy of the stored information.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">Exterior1st</span><span class="sh">'</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axarr</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span> <span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span><span class="n">sharey</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1"># plot
</span><span class="n">sns</span><span class="p">.</span><span class="nf">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">feature</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="sh">'</span><span class="s">SalePrice</span><span class="sh">'</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">train</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">axarr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="c1"># plot
</span><span class="n">plot</span> <span class="o">=</span> <span class="n">sns</span><span class="p">.</span><span class="nf">swarmplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">feature</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="sh">'</span><span class="s">SalePrice</span><span class="sh">'</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">train</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">axarr</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">axarr</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nf">set_ylabel</span><span class="p">(</span><span class="sh">""</span><span class="p">)</span>

<span class="c1"># purpose
</span><span class="n">sns</span><span class="p">.</span><span class="nf">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">feature</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="sh">'</span><span class="s">SalePrice</span><span class="sh">'</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">train</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">axarr</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">axarr</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="nf">set_ylabel</span><span class="p">(</span><span class="sh">""</span><span class="p">)</span>
<span class="n">axarr</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">train</span><span class="p">[</span><span class="sh">'</span><span class="s">SalePrice</span><span class="sh">'</span><span class="p">].</span><span class="nf">max</span><span class="p">()</span><span class="o">*</span><span class="mf">1.05</span><span class="p">);</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_98_0.png" />
</figure>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">Exterior2nd</span><span class="sh">'</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axarr</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span> <span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span><span class="n">sharey</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1"># plot
</span><span class="n">sns</span><span class="p">.</span><span class="nf">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">feature</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="sh">'</span><span class="s">SalePrice</span><span class="sh">'</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">train</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">axarr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="c1"># plot
</span><span class="n">plot</span> <span class="o">=</span> <span class="n">sns</span><span class="p">.</span><span class="nf">swarmplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">feature</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="sh">'</span><span class="s">SalePrice</span><span class="sh">'</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">train</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">axarr</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">axarr</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nf">set_ylabel</span><span class="p">(</span><span class="sh">""</span><span class="p">)</span>

<span class="c1"># purpose
</span><span class="n">sns</span><span class="p">.</span><span class="nf">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">feature</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="sh">'</span><span class="s">SalePrice</span><span class="sh">'</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">train</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">axarr</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">axarr</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="nf">set_ylabel</span><span class="p">(</span><span class="sh">""</span><span class="p">)</span>
<span class="n">axarr</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">train</span><span class="p">[</span><span class="sh">'</span><span class="s">SalePrice</span><span class="sh">'</span><span class="p">].</span><span class="nf">max</span><span class="p">()</span><span class="o">*</span><span class="mf">1.05</span><span class="p">);</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_99_0.png" />
</figure>

<p><strong>COMMMENT</strong></p>
<ul>
  <li>Most records have the save value for both exterior features.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">MasVnrType</span><span class="sh">'</span>
<span class="nf">plot_cat_feature_eda</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_101_0.png" />
</figure>

<p><strong>COMMENT</strong></p>
<ul>
  <li>Each class leads to a different average sale price.</li>
  <li>Most of the data is stored in the first three classes.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">train</span><span class="p">[</span><span class="sh">'</span><span class="s">MasVnrArea</span><span class="sh">'</span><span class="p">].</span><span class="nf">isnull</span><span class="p">().</span><span class="nf">count</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1460
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">MasVnrArea</span><span class="sh">'</span>
<span class="nf">plot_num_feature_eda</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MasVnrArea
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_104_1.png" />
</figure>

<p><strong>COMMENT</strong></p>
<ul>
  <li>There is no clear correlation between this feature and the sale price.</li>
  <li>Most of the data is assigned a value of 0.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">ExterQual</span><span class="sh">'</span>
<span class="n">order</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">Fa</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">TA</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Gd</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Ex</span><span class="sh">'</span><span class="p">]</span>
<span class="nf">plot_cat_feature_eda</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_106_0.png" />
</figure>

<p><strong>COMMENT</strong></p>
<ul>
  <li>This is an ordinal feature. The classes are arrange to create an increase in sale price from one feature to another.</li>
  <li>Most of the data is stored in the two central classes.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">ExterCond</span><span class="sh">'</span>
<span class="n">order</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">Po</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Fa</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">TA</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Gd</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Ex</span><span class="sh">'</span><span class="p">]</span>
<span class="nf">plot_cat_feature_eda</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_108_0.png" />
</figure>

<p><strong>COMMENT</strong></p>
<ul>
  <li>This is an ordinal feature but the sale price does not reflect the feature order.</li>
  <li>Most of the data is stored in the two central classes.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">GarageType</span><span class="sh">'</span>
<span class="nf">plot_cat_feature_eda</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_110_0.png" />
</figure>

<p><strong>COMMENT</strong></p>
<ul>
  <li>There is no real order within this categorical feature.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">GarageYrBlt</span><span class="sh">'</span>
<span class="nf">plot_date_feature</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_112_0.png" />
</figure>

<p><strong>COMMENT</strong></p>
<ul>
  <li>For recent constructions, it seems that there is an upward trend. For older constructions, the average sale price seems to be fairly constant.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">GarageFinish</span><span class="sh">'</span>
<span class="nf">plot_cat_feature_eda</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_114_0.png" />
</figure>

<p><strong>COMMENT</strong></p>
<ul>
  <li>The data is evenly distributed amongst the three classes.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">GarageCars</span><span class="sh">'</span>
<span class="nf">plot_cat_feature_eda</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_116_0.png" />
</figure>

<p><strong>COMMENT</strong></p>
<ul>
  <li>There is a clear increase in sale price from class 0 to class 3. However, class 4 does not follow this trend. This can be explained by the low number of records with 4 car spaces.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">GarageArea</span><span class="sh">'</span>
<span class="nf">plot_num_feature_eda</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GarageArea
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_118_1.png" />
</figure>

<p><strong>COMMENT</strong></p>
<ul>
  <li>The sale price is strongly correlated to this feature (positive correlation).</li>
  <li>There is a high variation of this feature when looking at the neighborhoods.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">GarageQual</span><span class="sh">'</span>
<span class="n">order</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">Po</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Fa</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">TA</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Gd</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Ex</span><span class="sh">"</span><span class="p">]</span>
<span class="nf">plot_cat_feature_eda</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_120_0.png" />
</figure>

<p><strong>COMMENT</strong></p>
<ul>
  <li>We found a sequence that leads to an increase in sale price. Only the Ex feature does not really match the ranking but the small number of Ex records is the reason for such a behavior.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">GarageCond</span><span class="sh">'</span>
<span class="n">order</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">Po</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Fa</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">TA</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Gd</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Ex</span><span class="sh">"</span><span class="p">]</span>
<span class="nf">plot_cat_feature_eda</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_122_0.png" />
</figure>

<p><strong>COMMENT</strong></p>
<ul>
  <li>We found a sequence that leads to an increase in sale price. Only the Ex feature does not really match the ranking but the small number of Ex records is the reason for such a behavior.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">WoodDeckSF</span><span class="sh">'</span>
<span class="nf">plot_num_feature_eda</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>WoodDeckSF
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_124_1.png" />
</figure>

<p><strong>COMMENT</strong></p>
<ul>
  <li>There is a good positive correlation between the sale price and this feature..</li>
  <li>The neighborhood and location feature have a great impact on this feature.</li>
  <li>A large number of data points are assigned the value 0.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">PoolArea</span><span class="sh">'</span>
<span class="nf">plot_num_feature_eda</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PoolArea
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_126_1.png" />
</figure>

<p><strong>COMMENT</strong></p>
<ul>
  <li>Most of the data is stored as 0. This feature may be dropped.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">Fence</span><span class="sh">'</span>
<span class="n">order</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">MnWw</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">GdWo</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">MnPrv</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">GdPrv</span><span class="sh">'</span><span class="p">]</span>
<span class="nf">plot_cat_feature_eda</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_128_0.png" />
</figure>

<p><strong>COMMENT</strong></p>
<ul>
  <li>The data is mostly stored in a single class.</li>
  <li>It is possibly to arrange the classes to create an ordinal sequence.</li>
</ul>

<p><a id="Section_233"></a></p>
<h3 id="233-miscellaneous">2.3.3. Miscellaneous</h3>
<p>The following variables are assigned to the “Miscellaneous” group.</p>
<ul>
  <li>Order (Discrete): Observation number</li>
  <li>PID (Nominal): Parcel identification number  - can be used with city web site for parcel review.</li>
  <li>MS Zoning (Nominal): Identifies the general zoning classification of the sale.</li>
  <li>Lot Frontage (Continuous): Linear feet of street connected to property</li>
  <li>Lot Area (Continuous): Lot size in square feet</li>
  <li>Street (Nominal): Type of road access to property</li>
  <li>Alley (Nominal): Type of alley access to property</li>
  <li>Lot Shape (Ordinal): General shape of property</li>
  <li>Land Contour (Nominal): Flatness of the property</li>
  <li>Utilities (Ordinal): Type of utilities available</li>
  <li>Lot Config (Nominal): Lot configuration</li>
  <li>Land Slope (Ordinal): Slope of property</li>
  <li>Neighborhood (Nominal): Physical locations within Ames city limits (map available)</li>
  <li>Condition 1 (Nominal): Proximity to various conditions</li>
  <li>Condition 2 (Nominal): Proximity to various conditions (if more than one is present)</li>
  <li>Heating	(Nominal): Type of heating</li>
  <li>HeatingQC (Ordinal): Heating quality and condition</li>
  <li>Central Air (Nominal): Central air conditioning</li>
  <li>Electrical (Ordinal): Electrical system</li>
  <li>Paved Drive (Ordinal): Paved driveway</li>
  <li>Misc Feature (Nominal): Miscellaneous feature not covered in other categories</li>
  <li>Misc Val (Continuous): $$Value of miscellaneous feature</li>
  <li>Mo Sold (Discrete): Month Sold (MM)</li>
  <li>Yr Sold (Discrete): Year Sold (YYYY)</li>
  <li>Sale Type (Nominal): Type of sale</li>
  <li>Sale Condition (Nominal): Condition of sale</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">MSZoning</span><span class="sh">'</span>
<span class="nf">plot_cat_feature_eda</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_131_0.png" />
</figure>

<p><strong>COMMENT</strong></p>
<ul>
  <li>The data is mostly contained is a single class.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">Neighborhood</span><span class="sh">'</span>
<span class="n">order</span><span class="o">=</span><span class="bp">None</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axarr</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span> <span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span><span class="n">sharey</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1"># plot
</span><span class="n">sns</span><span class="p">.</span><span class="nf">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">feature</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="sh">'</span><span class="s">SalePrice</span><span class="sh">'</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">train</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">axarr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">)</span>

<span class="c1"># plot
</span><span class="n">plot</span> <span class="o">=</span> <span class="n">sns</span><span class="p">.</span><span class="nf">swarmplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">feature</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="sh">'</span><span class="s">SalePrice</span><span class="sh">'</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">train</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">axarr</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">)</span>
<span class="n">axarr</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nf">set_ylabel</span><span class="p">(</span><span class="sh">""</span><span class="p">)</span>

<span class="c1"># purpose
</span><span class="n">sns</span><span class="p">.</span><span class="nf">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">feature</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="sh">'</span><span class="s">SalePrice</span><span class="sh">'</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">train</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">axarr</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">)</span>
<span class="n">axarr</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="nf">set_ylabel</span><span class="p">(</span><span class="sh">""</span><span class="p">)</span>
<span class="n">axarr</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">train</span><span class="p">[</span><span class="sh">'</span><span class="s">SalePrice</span><span class="sh">'</span><span class="p">].</span><span class="nf">max</span><span class="p">()</span><span class="o">*</span><span class="mf">1.05</span><span class="p">);</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_133_0.png" />
</figure>

<p><strong>COMMENT</strong></p>
<ul>
  <li>The location is obviously a key feature when predicting the price of an estate.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">Condition1</span><span class="sh">'</span>
<span class="nf">plot_cat_feature_eda</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_135_0.png" />
</figure>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">Condition2</span><span class="sh">'</span>
<span class="nf">plot_cat_feature_eda</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_136_0.png" />
</figure>

<p><strong>COMMENT</strong></p>
<ul>
  <li>For both features, the data is concentrated into a single class.</li>
  <li>The distribution between the two features is similar.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">LotFrontage</span><span class="sh">'</span>
<span class="nf">plot_num_feature_eda</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>LotFrontage
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_138_1.png" />
</figure>

<p><strong>COMMENT</strong></p>
<ul>
  <li>The original set presents a large number of null values.</li>
  <li>The neighborhoods and the house type do not seem to play a significant role for this feature.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">LotArea</span><span class="sh">'</span>
<span class="nf">plot_num_feature_eda</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>LotArea
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_140_1.png" />
</figure>

<p><strong>COMMENT</strong></p>
<ul>
  <li>As expected, this feature is strongly positively correlated to the sale price.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">LotShape</span><span class="sh">'</span>
<span class="nf">plot_cat_feature_eda</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_142_0.png" />
</figure>

<p><strong>COMMENT</strong></p>
<ul>
  <li>The data is concentrated into two classes.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">LandContour</span><span class="sh">'</span>
<span class="nf">plot_cat_feature_eda</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_144_0.png" />
</figure>

<p><strong>COMMENT</strong></p>
<ul>
  <li>The data is concentrated into a single class.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">LotConfig</span><span class="sh">'</span>
<span class="nf">plot_cat_feature_eda</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_146_0.png" />
</figure>

<p><strong>COMMENT</strong></p>
<ul>
  <li>The data is concentrated into three classes.</li>
  <li>FR2 and FR3 are merged.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">LandSlope</span><span class="sh">'</span>
<span class="nf">plot_cat_feature_eda</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_148_0.png" />
</figure>

<p><strong>COMMENT</strong></p>
<ul>
  <li>This feature does not have a clear impact on the sale price.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">Street</span><span class="sh">'</span>
<span class="nf">plot_cat_feature_eda</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_150_0.png" />
</figure>

<p><strong>COMMENT</strong></p>
<ul>
  <li>The vast majority of the data is stored under the same class.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">Alley</span><span class="sh">'</span>
<span class="nf">plot_cat_feature_eda</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_152_0.png" />
</figure>

<p><strong>COMMENT</strong></p>
<ul>
  <li>There is a slight difference in the sale price between the two classes.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">PavedDrive</span><span class="sh">'</span>
<span class="nf">plot_cat_feature_eda</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_154_0.png" />
</figure>

<p><strong>COMMENT</strong></p>
<ul>
  <li>Most of the data is contained in the Y class.</li>
  <li>There is a slight difference in the sale price between the three classes.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">Heating</span><span class="sh">'</span>
<span class="nf">plot_cat_feature_eda</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_156_0.png" />
</figure>

<p><strong>COMMENT</strong></p>
<ul>
  <li>The vast majority of the data is contained in the GasA class.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">HeatingQC</span><span class="sh">'</span>
<span class="n">order</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">Po</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Fa</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">TA</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Gd</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Ex</span><span class="sh">"</span><span class="p">]</span>
<span class="nf">plot_cat_feature_eda</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_158_0.png" />
</figure>

<p><strong>COMMENT</strong></p>
<ul>
  <li>We were able to find a order that corresponds to an increase in sale price.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">CentralAir</span><span class="sh">'</span>
<span class="nf">plot_cat_feature_eda</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_160_0.png" />
</figure>

<p><strong>COMMENT</strong></p>
<ul>
  <li>The data is mostly stored under the “Y” class. Since this feature is a boolean feature, we simply map “Y” to the value 1 and “No” to the value 0.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">Utilities</span><span class="sh">'</span>
<span class="nf">plot_cat_feature_eda</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_162_0.png" />
</figure>

<p><strong>COMMENT</strong></p>
<ul>
  <li>The utilities feature can be dropped since the data is mostly assigned to a single class.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">Electrical</span><span class="sh">'</span>
<span class="nf">plot_cat_feature_eda</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_164_0.png" />
</figure>

<p><strong>COMMENT</strong></p>
<ul>
  <li>As seen before, the date is mostly contained in a single class.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">MiscFeature</span><span class="sh">'</span>
<span class="nf">plot_cat_feature_eda</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_166_0.png" />
</figure>

<p><strong>COMMENT</strong></p>
<ul>
  <li>Only a small fraction of the dataset has a MiscFeature assigned.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">MoSold</span><span class="sh">'</span>
<span class="nf">plot_cat_feature_eda</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_168_0.png" />
</figure>

<p><strong>COMMENT</strong></p>
<ul>
  <li>The data is mostly homogeneously distributed although a few months (summer) are more proned to sales.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">YrSold</span><span class="sh">'</span>
<span class="nf">plot_cat_feature_eda</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_170_0.png" />
</figure>

<p><strong>COMMENT</strong></p>
<ul>
  <li>It does not appear to be a large correlation between the year of the sale and the selling price.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">SaleType</span><span class="sh">'</span>
<span class="nf">plot_cat_feature_eda</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_172_0.png" />
</figure>

<p><strong>COMMENT</strong></p>
<ul>
  <li>Most of the sales are contained in the “WD” features.</li>
  <li>The “New” feature has an higher average sale price.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature</span> <span class="o">=</span> <span class="sh">'</span><span class="s">SaleCondition</span><span class="sh">'</span>
<span class="nf">plot_cat_feature_eda</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_174_0.png" />
</figure>

<p><strong>COMMENT</strong></p>
<ul>
  <li>Most of the data is contained in the “Normal” class.</li>
  <li>The sale condition seems to have a significant impact on the sale price as the sale price for each class differs from the ones of the other classes.</li>
</ul>

<hr />
<p><a id="Section_3"></a></p>
<h2 id="3-pre-processing">3. Pre-Processing</h2>

<p>The first step consists of isolating the target label from the dataset.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># clean import
</span><span class="n">train</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_csv</span><span class="p">(</span><span class="sh">'</span><span class="s">./data/train.csv</span><span class="sh">'</span><span class="p">)</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_csv</span><span class="p">(</span><span class="sh">'</span><span class="s">./data/test.csv</span><span class="sh">'</span><span class="p">)</span>

<span class="c1"># isolate ID's
</span><span class="n">test_id</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="sh">'</span><span class="s">Id</span><span class="sh">'</span><span class="p">]</span>
<span class="n">train_id</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="sh">'</span><span class="s">Id</span><span class="sh">'</span><span class="p">]</span>

<span class="c1"># remove ID from sets
</span><span class="n">train</span> <span class="o">=</span> <span class="n">train</span><span class="p">.</span><span class="nf">drop</span><span class="p">([</span><span class="sh">'</span><span class="s">Id</span><span class="sh">'</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">test</span><span class="p">.</span><span class="nf">drop</span><span class="p">([</span><span class="sh">'</span><span class="s">Id</span><span class="sh">'</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Train:</span><span class="sh">"</span><span class="p">,</span> <span class="n">train</span><span class="p">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Test</span><span class="sh">"</span><span class="p">,</span> <span class="n">test</span><span class="p">.</span><span class="n">shape</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Train: (1460, 80)
Test (1459, 79)
</code></pre></div></div>

<p>We have previously seen that the sale price was not normally distributed and that it required a transformation.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">train</span><span class="p">[</span><span class="sh">'</span><span class="s">SalePrice</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">log1p</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="sh">'</span><span class="s">SalePrice</span><span class="sh">'</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Deleting outliers
</span><span class="n">train</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="n">train</span><span class="p">.</span><span class="n">GrLivArea</span> <span class="o">&lt;</span> <span class="mi">4500</span><span class="p">]</span>
<span class="n">train_end</span> <span class="o">=</span> <span class="n">train</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">train</span><span class="p">.</span><span class="nf">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="n">y_train</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="sh">'</span><span class="s">SalePrice</span><span class="sh">'</span><span class="p">]</span>
<span class="n">train</span> <span class="o">=</span> <span class="n">train</span><span class="p">.</span><span class="nf">drop</span><span class="p">([</span><span class="sh">'</span><span class="s">SalePrice</span><span class="sh">'</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">full_set</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">concat</span><span class="p">([</span><span class="n">train</span><span class="p">,</span> <span class="n">test</span><span class="p">]).</span><span class="nf">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">Shape of the entire dataset is {}</span><span class="sh">'</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">full_set</span><span class="p">.</span><span class="n">shape</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Shape of the entire dataset is (2917, 79)
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># plot new distribution after transformation
</span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">norm</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">y_train</span><span class="p">)</span>
<span class="n">sns</span><span class="p">.</span><span class="nf">distplot</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">legend</span><span class="p">([</span><span class="sh">'</span><span class="s">Normal distribution ($$\mu=$$ {:.2f} and $$\sigma=$$ {:.2f} )</span><span class="sh">'</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)],</span> <span class="n">loc</span> <span class="o">=</span> <span class="sh">'</span><span class="s">best</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">ylabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Frequency</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">title</span><span class="p">(</span><span class="sh">'</span><span class="s">Histogram of SalePrice</span><span class="sh">'</span><span class="p">);</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">figure</span><span class="p">()</span>
<span class="n">res</span> <span class="o">=</span> <span class="nf">probplot</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="n">plt</span><span class="p">);</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_183_0.png" />
</figure>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_183_1.png" />
</figure>

<p>As shown above, the transformed label has a distribution closer to the normal distribution. The tails of the sale price features are still larger but at least, we have a better fit for our model.</p>

<p>Identify the list of features with missing values:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">nulls</span> <span class="o">=</span> <span class="n">full_set</span><span class="p">.</span><span class="nf">isnull</span><span class="p">().</span><span class="nf">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">nulls</span><span class="p">[</span><span class="n">nulls</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">].</span><span class="nf">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PoolQC          2908
MiscFeature     2812
Alley           2719
Fence           2346
FireplaceQu     1420
LotFrontage      486
GarageFinish     159
GarageYrBlt      159
GarageQual       159
GarageCond       159
GarageType       157
BsmtExposure      82
BsmtCond          82
BsmtQual          81
BsmtFinType2      80
BsmtFinType1      79
MasVnrType        24
MasVnrArea        23
MSZoning           4
BsmtFullBath       2
BsmtHalfBath       2
Utilities          2
Functional         2
Exterior2nd        1
Exterior1st        1
SaleType           1
BsmtFinSF1         1
BsmtFinSF2         1
BsmtUnfSF          1
Electrical         1
KitchenQual        1
GarageCars         1
GarageArea         1
TotalBsmtSF        1
dtype: int64
</code></pre></div></div>

<p>We previously saw that our features have distributions that cannot be approximated by the normal distribution. We compute the skew of each feature to see which ones can be corrected.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Isolate numerical feature names
</span><span class="n">numerical</span> <span class="o">=</span> <span class="n">full_set</span><span class="p">.</span><span class="n">dtypes</span><span class="p">[</span><span class="n">full_set</span><span class="p">.</span><span class="n">dtypes</span> <span class="o">!=</span> <span class="sh">'</span><span class="s">object</span><span class="sh">'</span><span class="p">].</span><span class="n">index</span>

<span class="c1">#compute skew and sort
</span><span class="n">skewness</span> <span class="o">=</span> <span class="n">full_set</span><span class="p">[</span><span class="n">numerical</span><span class="p">].</span><span class="nf">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nf">skew</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="nf">dropna</span><span class="p">())).</span><span class="nf">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">skewness</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MiscVal          21.939672
PoolArea         17.688664
LotArea          13.109495
LowQualFinSF     12.084539
3SsnPorch        11.372080
KitchenAbvGr      4.300550
BsmtFinSF2        4.143683
EnclosedPorch     4.002344
ScreenPorch       3.945101
BsmtHalfBath      3.928397
MasVnrArea        2.609358
OpenPorchSF       2.529358
WoodDeckSF        1.844792
MSSubClass        1.375131
1stFlrSF          1.257286
LotFrontage       1.121322
GrLivArea         1.068750
BsmtFinSF1        0.980283
BsmtUnfSF         0.919699
2ndFlrSF          0.861556
TotRmsAbvGrd      0.749232
Fireplaces        0.725278
HalfBath          0.696666
TotalBsmtSF       0.676200
BsmtFullBath      0.621322
OverallCond       0.569314
BedroomAbvGr      0.326568
GarageArea        0.218752
MoSold            0.197345
OverallQual       0.189591
FullBath          0.165514
YrSold            0.131996
GarageCars       -0.217977
GarageYrBlt      -0.380955
YearRemodAdd     -0.450134
YearBuilt        -0.599194
dtype: float64
</code></pre></div></div>

<p>The Box-Cox transformation can be used to adjust feature with high skewness. Several values of the parameter lambda are tested and a threshold of 0.5 is used to determine which feature needs to be transformed.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">FeatureEngineering</span><span class="p">(</span><span class="n">input_df</span><span class="p">,</span> <span class="n">train_df</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.50</span><span class="p">):</span>
    
    <span class="n">df</span> <span class="o">=</span> <span class="n">input_df</span><span class="p">.</span><span class="nf">copy</span><span class="p">()</span>
    
    <span class="c1"># Change data-type
</span>    <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">MSSubClass</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">MSSubClass</span><span class="sh">'</span><span class="p">].</span><span class="nf">apply</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">YrSold</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">YrSold</span><span class="sh">'</span><span class="p">].</span><span class="nf">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">MoSold</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">MoSold</span><span class="sh">'</span><span class="p">].</span><span class="nf">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    
    <span class="c1"># Fill empty records with generic class
</span>    <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">Functional</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">Functional</span><span class="sh">'</span><span class="p">].</span><span class="nf">fillna</span><span class="p">(</span><span class="sh">'</span><span class="s">Typ</span><span class="sh">'</span><span class="p">)</span> 
    <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">Electrical</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">Electrical</span><span class="sh">'</span><span class="p">].</span><span class="nf">fillna</span><span class="p">(</span><span class="sh">"</span><span class="s">SBrkr</span><span class="sh">"</span><span class="p">)</span> 
    <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">KitchenQual</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">KitchenQual</span><span class="sh">'</span><span class="p">].</span><span class="nf">fillna</span><span class="p">(</span><span class="sh">"</span><span class="s">TA</span><span class="sh">"</span><span class="p">)</span> 
    
    <span class="c1"># Fill empty records with new None class
</span>    <span class="n">df</span><span class="p">[</span><span class="sh">"</span><span class="s">PoolQC</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sh">"</span><span class="s">PoolQC</span><span class="sh">"</span><span class="p">].</span><span class="nf">fillna</span><span class="p">(</span><span class="sh">"</span><span class="s">None</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="n">df</span><span class="p">[</span><span class="sh">"</span><span class="s">GarageType</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sh">"</span><span class="s">GarageType</span><span class="sh">"</span><span class="p">].</span><span class="nf">fillna</span><span class="p">(</span><span class="sh">"</span><span class="s">None</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="sh">"</span><span class="s">GarageFinish</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sh">"</span><span class="s">GarageFinish</span><span class="sh">"</span><span class="p">].</span><span class="nf">fillna</span><span class="p">(</span><span class="sh">"</span><span class="s">None</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="sh">"</span><span class="s">GarageQual</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sh">"</span><span class="s">GarageQual</span><span class="sh">"</span><span class="p">].</span><span class="nf">fillna</span><span class="p">(</span><span class="sh">"</span><span class="s">None</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="sh">"</span><span class="s">GarageCond</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sh">"</span><span class="s">GarageCond</span><span class="sh">"</span><span class="p">].</span><span class="nf">fillna</span><span class="p">(</span><span class="sh">"</span><span class="s">None</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="n">df</span><span class="p">[</span><span class="sh">"</span><span class="s">BsmtQual</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sh">"</span><span class="s">BsmtQual</span><span class="sh">"</span><span class="p">].</span><span class="nf">fillna</span><span class="p">(</span><span class="sh">"</span><span class="s">None</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="sh">"</span><span class="s">BsmtCond</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sh">"</span><span class="s">BsmtCond</span><span class="sh">"</span><span class="p">].</span><span class="nf">fillna</span><span class="p">(</span><span class="sh">"</span><span class="s">None</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="sh">"</span><span class="s">BsmtExposure</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sh">"</span><span class="s">BsmtExposure</span><span class="sh">"</span><span class="p">].</span><span class="nf">fillna</span><span class="p">(</span><span class="sh">"</span><span class="s">None</span><span class="sh">"</span><span class="p">)</span>    
    
    <span class="c1"># Fill records with mode
</span>    <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">Exterior1st</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">Exterior1st</span><span class="sh">'</span><span class="p">].</span><span class="nf">fillna</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">Exterior1st</span><span class="sh">'</span><span class="p">].</span><span class="nf">mode</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span> 
    <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">Exterior2nd</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">Exterior2nd</span><span class="sh">'</span><span class="p">].</span><span class="nf">fillna</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">Exterior2nd</span><span class="sh">'</span><span class="p">].</span><span class="nf">mode</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">SaleType</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">SaleType</span><span class="sh">'</span><span class="p">].</span><span class="nf">fillna</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">SaleType</span><span class="sh">'</span><span class="p">].</span><span class="nf">mode</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
    
    <span class="c1"># Fill numerical feature with 0
</span>    <span class="n">df</span><span class="p">[</span><span class="sh">"</span><span class="s">GarageYrBlt</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sh">"</span><span class="s">GarageYrBlt</span><span class="sh">"</span><span class="p">].</span><span class="nf">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="sh">"</span><span class="s">GarageArea</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sh">"</span><span class="s">GarageArea</span><span class="sh">"</span><span class="p">].</span><span class="nf">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="sh">"</span><span class="s">GarageCars</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sh">"</span><span class="s">GarageCars</span><span class="sh">"</span><span class="p">].</span><span class="nf">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="c1"># Fill connected features using groups
</span>    <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">MSZoning</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">groupby</span><span class="p">(</span><span class="sh">'</span><span class="s">MSSubClass</span><span class="sh">'</span><span class="p">)[</span><span class="sh">'</span><span class="s">MSZoning</span><span class="sh">'</span><span class="p">].</span><span class="nf">transform</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">.</span><span class="nf">fillna</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="nf">mode</span><span class="p">()[</span><span class="mi">0</span><span class="p">]))</span>
           
    <span class="c1"># Process remaining features
</span>    <span class="n">objects</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="p">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">].</span><span class="n">dtype</span> <span class="o">==</span> <span class="nb">object</span><span class="p">:</span>
            <span class="n">objects</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
    <span class="n">df</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">objects</span><span class="p">].</span><span class="nf">fillna</span><span class="p">(</span><span class="sh">'</span><span class="s">None</span><span class="sh">'</span><span class="p">))</span> 
    
    <span class="c1"># Fill connected features using groups
</span>    <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">LotFrontage</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">groupby</span><span class="p">(</span><span class="sh">'</span><span class="s">Neighborhood</span><span class="sh">'</span><span class="p">)[</span><span class="sh">'</span><span class="s">LotFrontage</span><span class="sh">'</span><span class="p">].</span><span class="nf">transform</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">.</span><span class="nf">fillna</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="nf">median</span><span class="p">()))</span>
    
    <span class="c1"># Process remaining features
</span>    <span class="n">numeric_dtypes</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">int16</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">int32</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">int64</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">float16</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">float32</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">float64</span><span class="sh">'</span><span class="p">]</span>
    <span class="n">numeric_features</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="p">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">].</span><span class="n">dtype</span> <span class="ow">in</span> <span class="n">numeric_dtypes</span><span class="p">:</span>
            <span class="n">numeric_features</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>   
    <span class="n">df</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">numeric_features</span><span class="p">].</span><span class="nf">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> 
    
    <span class="c1"># drop features
</span>    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">drop</span><span class="p">([</span><span class="sh">'</span><span class="s">Utilities</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Street</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">PoolQC</span><span class="sh">'</span><span class="p">,],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        
    <span class="c1"># Use log of data to reduce the impact of outliers
</span>    <span class="n">continuous_features</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="p">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">].</span><span class="n">dtype</span> <span class="ow">in</span> <span class="n">numeric_dtypes</span><span class="p">:</span>
            <span class="n">continuous_features</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
    
    <span class="n">categorical_features</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="p">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">continuous_features</span><span class="p">]</span>
    
    <span class="c1"># Skewness correction
</span>    <span class="n">skewness</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">continuous_features</span><span class="p">].</span><span class="nf">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nf">skew</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="nf">dropna</span><span class="p">())).</span><span class="nf">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">boxcox_features</span> <span class="o">=</span> <span class="n">skewness</span><span class="p">[</span><span class="n">skewness</span><span class="o">&gt;</span><span class="n">threshold</span><span class="p">].</span><span class="n">index</span>
    
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">boxcox_features</span><span class="p">:</span>
        <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="nf">boxcox1p</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="nf">boxcox_normmax</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
                
    <span class="c1"># New features
</span>    <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">TotalSF</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">TotalBsmtSF</span><span class="sh">'</span><span class="p">]</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">1stFlrSF</span><span class="sh">'</span><span class="p">]</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">2ndFlrSF</span><span class="sh">'</span><span class="p">]</span>
    <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">YrBltAndRemod</span><span class="sh">'</span><span class="p">]</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">YearBuilt</span><span class="sh">'</span><span class="p">]</span><span class="o">+</span><span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">YearRemodAdd</span><span class="sh">'</span><span class="p">]</span>
    
    <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">Total_sqr_footage</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">BsmtFinSF1</span><span class="sh">'</span><span class="p">]</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">BsmtFinSF2</span><span class="sh">'</span><span class="p">]</span> <span class="o">+</span>
                                 <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">1stFlrSF</span><span class="sh">'</span><span class="p">]</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">2ndFlrSF</span><span class="sh">'</span><span class="p">])</span>
    
    <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">Total_Bathrooms</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">FullBath</span><span class="sh">'</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">HalfBath</span><span class="sh">'</span><span class="p">])</span> <span class="o">+</span>
                               <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">BsmtFullBath</span><span class="sh">'</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">BsmtHalfBath</span><span class="sh">'</span><span class="p">]))</span>
    
    <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">Total_porch_sf</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">OpenPorchSF</span><span class="sh">'</span><span class="p">]</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">3SsnPorch</span><span class="sh">'</span><span class="p">]</span> <span class="o">+</span>
                              <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">EnclosedPorch</span><span class="sh">'</span><span class="p">]</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">ScreenPorch</span><span class="sh">'</span><span class="p">]</span> <span class="o">+</span>
                              <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">WoodDeckSF</span><span class="sh">'</span><span class="p">])</span>
    
    <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">haspool</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">PoolArea</span><span class="sh">'</span><span class="p">].</span><span class="nf">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">has2ndfloor</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">2ndFlrSF</span><span class="sh">'</span><span class="p">].</span><span class="nf">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">hasgarage</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">GarageArea</span><span class="sh">'</span><span class="p">].</span><span class="nf">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">hasbsmt</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">TotalBsmtSF</span><span class="sh">'</span><span class="p">].</span><span class="nf">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">hasfireplace</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">Fireplaces</span><span class="sh">'</span><span class="p">].</span><span class="nf">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
        
    <span class="c1"># generate dummy features
</span>    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">get_dummies</span><span class="p">(</span><span class="n">df</span><span class="p">).</span><span class="nf">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    
    <span class="c1"># filtering data by removing columns made almost entirely of one value
</span>    <span class="n">overfit</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df</span><span class="p">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">counts</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="nf">value_counts</span><span class="p">()</span>
        <span class="n">most_common</span> <span class="o">=</span> <span class="n">counts</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">most_common</span> <span class="o">/</span> <span class="nf">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">&gt;</span> <span class="mf">99.94</span><span class="p">:</span>
            <span class="n">overfit</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    
    <span class="n">overfit</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sh">'</span><span class="s">MSZoning_C (all)</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">drop</span><span class="p">(</span><span class="n">overfit</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># transform entire dataset
</span><span class="n">transformed_full_set</span> <span class="o">=</span> <span class="nc">FeatureEngineering</span><span class="p">(</span><span class="n">full_set</span><span class="p">,</span> <span class="n">train</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">transformed_full_set</span><span class="p">.</span><span class="n">shape</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(2917, 321)
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Split full dataset using train and test set
</span><span class="n">train</span> <span class="o">=</span> <span class="n">transformed_full_set</span><span class="p">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">train_end</span><span class="p">,</span> <span class="p">:]</span>
<span class="n">test</span>  <span class="o">=</span> <span class="n">transformed_full_set</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_end</span><span class="p">:,</span> <span class="p">:]</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">train</span><span class="sh">'</span><span class="p">,</span> <span class="n">train</span><span class="p">.</span><span class="n">shape</span><span class="p">,</span> <span class="sh">'</span><span class="s">y_train</span><span class="sh">'</span><span class="p">,</span> <span class="n">y_train</span><span class="p">.</span><span class="n">shape</span><span class="p">,</span> <span class="sh">'</span><span class="s">test</span><span class="sh">'</span><span class="p">,</span><span class="n">test</span><span class="p">.</span><span class="n">shape</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>train (1458, 321) y_train (1458,) test (1459, 321)
</code></pre></div></div>

<p>The training and test sets are ready to be used to train our models.</p>

<hr />
<p><a id="Section_4"></a></p>
<h2 id="4-models">4. Models</h2>

<p><a id="Section_41"></a></p>
<h3 id="41-benchmarking">4.1. Benchmarking</h3>

<p>The prediction of the sale price is a regression problem. Our strategy will consists of performing a cross-validation on the train model (using a K-fold approach). The initial step consists of training a set of regression models (using default hyper-parameters). The objectives of this first training step are to select and identify models with good performances. These models can then be further trained. <br />
The following models are used during the first training phase:
Ridge Regression</p>
<ul>
  <li>Lasso Regression</li>
  <li>ElasticNet Regression</li>
  <li>KNN Reggressor</li>
  <li>Bayesian Regressor</li>
  <li>Decision Tree</li>
  <li>SVM</li>
  <li>Gradient Boosting</li>
  <li>ExtraTree</li>
  <li>Random Forest</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># scaler
</span><span class="n">robust</span> <span class="o">=</span> <span class="nc">RobustScaler</span><span class="p">()</span>

<span class="c1"># scale training set
</span><span class="n">train_normalized</span> <span class="o">=</span> <span class="n">robust</span><span class="p">.</span><span class="nf">fit_transform</span><span class="p">(</span><span class="n">train</span><span class="p">)</span>

<span class="c1"># scalre test set
</span><span class="n">test_normalized</span> <span class="o">=</span> <span class="n">robust</span><span class="p">.</span><span class="nf">transform</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">train_normalized</span><span class="p">.</span><span class="n">shape</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(1458, 321)
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">models</span> <span class="o">=</span> <span class="p">[</span><span class="nc">Lasso</span><span class="p">(),</span> <span class="nc">ElasticNet</span><span class="p">(),</span> <span class="nc">KNeighborsRegressor</span><span class="p">(),</span>
          <span class="nc">BayesianRidge</span><span class="p">(),</span> <span class="nc">DecisionTreeRegressor</span><span class="p">(),</span> <span class="nc">SVR</span><span class="p">(),</span>
          <span class="nc">GradientBoostingRegressor</span><span class="p">(),</span> <span class="nc">ExtraTreesRegressor</span><span class="p">(),</span> <span class="nc">RandomForestRegressor</span><span class="p">(),</span>
          <span class="nc">LGBMRegressor</span><span class="p">(),</span> <span class="nc">XGBRegressor</span><span class="p">(</span><span class="n">objective</span><span class="o">=</span><span class="sh">'</span><span class="s">reg:squarederror</span><span class="sh">'</span><span class="p">)]</span>

<span class="n">kfolds</span> <span class="o">=</span> <span class="nc">KFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="c1"># results summary
</span><span class="n">summary_cols</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">Model</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Parameters (Pre)</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">CV_results</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">CV_mean</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">CV_std</span><span class="sh">'</span><span class="p">]</span>
<span class="n">summary_df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">summary_cols</span><span class="p">)</span>

<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">algo</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">models</span><span class="p">):</span>
    
    <span class="c1"># identify the model
</span>    <span class="n">name</span> <span class="o">=</span> <span class="n">algo</span><span class="p">.</span><span class="n">__class__</span><span class="p">.</span><span class="n">__name__</span>
    <span class="n">summary_df</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="sh">'</span><span class="s">Model</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
    <span class="n">summary_df</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="sh">'</span><span class="s">Parameters (Pre)</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="nf">str</span><span class="p">(</span><span class="n">algo</span><span class="p">.</span><span class="nf">get_params</span><span class="p">())</span>
      
    <span class="c1"># cross-valudation
</span>    <span class="n">scores</span> <span class="o">=</span> <span class="nf">cross_val_score</span><span class="p">(</span><span class="n">algo</span><span class="p">,</span> <span class="n">train_normalized</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="sh">'</span><span class="s">neg_mean_squared_error</span><span class="sh">'</span><span class="p">)</span>
    
    <span class="c1"># compute metrics   
</span>    <span class="n">summary_df</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="sh">'</span><span class="s">CV_results</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="sh">"</span><span class="s">RMSE: %0.2f (+/- %0.3f)</span><span class="sh">"</span> <span class="o">%</span> <span class="p">(</span><span class="n">scores</span><span class="p">.</span><span class="nf">mean</span><span class="p">(),</span> <span class="n">scores</span><span class="p">.</span><span class="nf">std</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">summary_df</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="sh">'</span><span class="s">CV_mean</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">scores</span><span class="p">.</span><span class="nf">mean</span><span class="p">()</span>
    <span class="n">summary_df</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="sh">'</span><span class="s">CV_std</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">scores</span><span class="p">.</span><span class="nf">std</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">algo</span><span class="p">.</span><span class="n">__class__</span><span class="p">.</span><span class="n">__name__</span><span class="p">,</span> <span class="sh">'</span><span class="s">trained...</span><span class="sh">'</span><span class="p">)</span>

<span class="c1">#summary_df['Training accuracy (Pre)'] = summary_df['Training accuracy (Pre)'].apply(lambda x: round(x, decimals))
#summary_df['Testing accuracy (Pre)'] = summary_df['Testing accuracy (Pre)'].apply(lambda x: round(x, decimals))
</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n\n</span><span class="s">Summary without hyper-parameter tuning:</span><span class="sh">"</span><span class="p">)</span>

<span class="n">summary_df</span> <span class="o">=</span> <span class="n">summary_df</span><span class="p">.</span><span class="nf">sort_values</span><span class="p">([</span><span class="sh">'</span><span class="s">CV_mean</span><span class="sh">'</span><span class="p">])</span>
<span class="n">summary_df</span><span class="p">.</span><span class="nf">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Lasso trained...
ElasticNet trained...
KNeighborsRegressor trained...
BayesianRidge trained...
DecisionTreeRegressor trained...
SVR trained...
GradientBoostingRegressor trained...
ExtraTreesRegressor trained...
RandomForestRegressor trained...
LGBMRegressor trained...
XGBRegressor trained...


Summary without hyper-parameter tuning:
</code></pre></div></div>

<div style="overflow-x:auto;">
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Model</th>
      <th>Parameters (Pre)</th>
      <th>CV_results</th>
      <th>CV_mean</th>
      <th>CV_std</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>BayesianRidge</td>
      <td>{'alpha_1': 1e-06, 'alpha_2': 1e-06, 'compute_...</td>
      <td>RMSE: -0.01 (+/- 0.003)</td>
      <td>0.0128691</td>
      <td>0.00283413</td>
    </tr>
    <tr>
      <th>1</th>
      <td>XGBRegressor</td>
      <td>{'base_score': 0.5, 'booster': 'gbtree', 'cols...</td>
      <td>RMSE: -0.02 (+/- 0.003)</td>
      <td>0.015208</td>
      <td>0.00251774</td>
    </tr>
    <tr>
      <th>2</th>
      <td>GradientBoostingRegressor</td>
      <td>{'alpha': 0.9, 'criterion': 'friedman_mse', 'i...</td>
      <td>RMSE: -0.02 (+/- 0.002)</td>
      <td>0.0153384</td>
      <td>0.00219738</td>
    </tr>
    <tr>
      <th>3</th>
      <td>SVR</td>
      <td>{'C': 1.0, 'cache_size': 200, 'coef0': 0.0, 'd...</td>
      <td>RMSE: -0.02 (+/- 0.004)</td>
      <td>0.0158596</td>
      <td>0.00404555</td>
    </tr>
    <tr>
      <th>4</th>
      <td>LGBMRegressor</td>
      <td>{'boosting_type': 'gbdt', 'class_weight': None...</td>
      <td>RMSE: -0.02 (+/- 0.003)</td>
      <td>0.0158715</td>
      <td>0.00270137</td>
    </tr>
    <tr>
      <th>5</th>
      <td>ExtraTreesRegressor</td>
      <td>{'bootstrap': False, 'criterion': 'mse', 'max_...</td>
      <td>RMSE: -0.02 (+/- 0.006)</td>
      <td>0.0214468</td>
      <td>0.00565928</td>
    </tr>
    <tr>
      <th>6</th>
      <td>RandomForestRegressor</td>
      <td>{'bootstrap': True, 'criterion': 'mse', 'max_d...</td>
      <td>RMSE: -0.02 (+/- 0.004)</td>
      <td>0.0219718</td>
      <td>0.00445915</td>
    </tr>
    <tr>
      <th>7</th>
      <td>KNeighborsRegressor</td>
      <td>{'algorithm': 'auto', 'leaf_size': 30, 'metric...</td>
      <td>RMSE: -0.03 (+/- 0.005)</td>
      <td>0.0333655</td>
      <td>0.00541219</td>
    </tr>
    <tr>
      <th>8</th>
      <td>DecisionTreeRegressor</td>
      <td>{'criterion': 'mse', 'max_depth': None, 'max_f...</td>
      <td>RMSE: -0.04 (+/- 0.010)</td>
      <td>0.038983</td>
      <td>0.0100607</td>
    </tr>
    <tr>
      <th>9</th>
      <td>ElasticNet</td>
      <td>{'alpha': 1.0, 'copy_X': True, 'fit_intercept'...</td>
      <td>RMSE: -0.14 (+/- 0.022)</td>
      <td>0.142879</td>
      <td>0.0217675</td>
    </tr>
    <tr>
      <th>10</th>
      <td>Lasso</td>
      <td>{'alpha': 1.0, 'copy_X': True, 'fit_intercept'...</td>
      <td>RMSE: -0.15 (+/- 0.025)</td>
      <td>0.149546</td>
      <td>0.0248788</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># plot results
</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="p">.</span><span class="nf">barplot</span><span class="p">(</span><span class="sh">"</span><span class="s">CV_mean</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">Model</span><span class="sh">"</span><span class="p">,</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">summary_df</span><span class="p">,</span>
                <span class="n">palette</span><span class="o">=</span><span class="sh">"</span><span class="s">Set3</span><span class="sh">"</span><span class="p">,</span>
                <span class="n">orient</span> <span class="o">=</span> <span class="sh">"</span><span class="s">h</span><span class="sh">"</span><span class="p">,</span>
                <span class="o">**</span><span class="p">{</span><span class="sh">'</span><span class="s">xerr</span><span class="sh">'</span><span class="p">:</span><span class="n">summary_df</span><span class="p">[</span><span class="sh">'</span><span class="s">CV_std</span><span class="sh">'</span><span class="p">].</span><span class="n">values</span><span class="p">})</span>
<span class="n">g</span><span class="p">.</span><span class="nf">set_xlabel</span><span class="p">(</span><span class="sh">"</span><span class="s">Mean Accuracy</span><span class="sh">"</span><span class="p">)</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="nf">set_title</span><span class="p">(</span><span class="sh">"</span><span class="s">Cross validation scores</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_201_0.png" />
</figure>

<p>The models tested above are sorted by RMSE on the cross-validation fold. The top 9 lead to relatively low RMSE. We can now inspect feature importances.</p>

<p><a id="Section_42"></a></p>
<h3 id="42-feature-importances">4.2. Feature Importances</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># create an DecisionTreeRegressor
</span><span class="n">model</span> <span class="o">=</span> <span class="nc">DecisionTreeRegressor</span><span class="p">()</span>

<span class="c1"># fit the model
</span><span class="n">model</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">train_normalized</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="c1"># sort features by importances
</span><span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">argsort</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">feature_importances_</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">n_feature</span> <span class="o">=</span> <span class="nf">len</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">feature_importances_</span><span class="p">[</span><span class="n">model</span><span class="p">.</span><span class="n">feature_importances_</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">])</span>

<span class="nf">print</span><span class="p">(</span><span class="n">n_feature</span><span class="p">,</span><span class="sh">"</span><span class="s"> features are important.</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>209  features are important.
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># plot the feature importances
</span><span class="n">top_n</span> <span class="o">=</span> <span class="mi">20</span>

<span class="n">indices</span> <span class="o">=</span> <span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">top_n</span><span class="p">]</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>

<span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="p">.</span><span class="nf">barplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">train</span><span class="p">.</span><span class="n">columns</span><span class="p">[</span><span class="n">indices</span><span class="p">],</span> <span class="n">x</span><span class="o">=</span><span class="n">model</span><span class="p">.</span><span class="n">feature_importances_</span><span class="p">[</span><span class="n">indices</span><span class="p">],</span> <span class="n">palette</span> <span class="o">=</span> <span class="n">mycols</span><span class="p">)</span>
<span class="n">g</span><span class="p">.</span><span class="nf">set_xlabel</span><span class="p">(</span><span class="sh">'</span><span class="s">feature importance</span><span class="sh">'</span><span class="p">)</span>
<span class="n">g</span><span class="p">.</span><span class="nf">set_ylabel</span><span class="p">(</span><span class="sh">'</span><span class="s">feature</span><span class="sh">'</span><span class="p">)</span>
<span class="n">g</span><span class="p">.</span><span class="nf">set_title</span><span class="p">(</span><span class="sh">'</span><span class="s">DecisionTreeRegressor (Top {} features)</span><span class="sh">'</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">top_n</span><span class="p">))</span>
<span class="n">g</span><span class="p">.</span><span class="nf">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">15</span><span class="p">);</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_205_0.png" />
</figure>

<p>As expected, some of the fundamental real-estate features appear as the most important, such as the overall quality, the size of the living area, the number of bathrooms.</p>

<p><a id="Section_43"></a></p>
<h3 id="43-result-correlation-and-model-behaviors">4.3. Result Correlation and Model Behaviors</h3>

<p>Before performing any ensembling, we must evaluate the correlation between the predictions of our models. Indeed, the ensembling works best when the selected models lead to uncorrelated predictions.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">summary_cols</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">Model</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Parameters (Pre)</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">CV results</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">CV mean</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">CV std</span><span class="sh">'</span><span class="p">]</span>
<span class="n">summary_df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">summary_cols</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">predictions_df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">()</span>

<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">algo</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">models</span><span class="p">):</span>
    <span class="n">algo</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">train_normalized</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="n">predictions</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">(</span><span class="n">algo</span><span class="p">.</span><span class="nf">predict</span><span class="p">(</span><span class="n">train_normalized</span><span class="p">))</span>
    
    <span class="n">predictions_df</span><span class="p">[</span><span class="n">algo</span><span class="p">.</span><span class="n">__class__</span><span class="p">.</span><span class="n">__name__</span><span class="p">]</span> <span class="o">=</span> <span class="n">predictions</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Compute the correlation matrix
</span><span class="n">corr</span> <span class="o">=</span> <span class="n">predictions_df</span><span class="p">.</span><span class="nf">corr</span><span class="p">()</span>

<span class="c1"># Generate a mask for the upper triangle
</span><span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros_like</span><span class="p">(</span><span class="n">corr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="nb">bool</span><span class="p">)</span>
<span class="n">mask</span><span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="nf">triu_indices_from</span><span class="p">(</span><span class="n">mask</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">True</span>

<span class="c1"># Set up the matplotlib figure
</span><span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>

<span class="c1"># Generate a custom diverging colormap
</span><span class="n">cmap</span> <span class="o">=</span> <span class="n">sns</span><span class="p">.</span><span class="nf">diverging_palette</span><span class="p">(</span><span class="mi">220</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">as_cmap</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1"># Draw the heatmap with the mask and correct aspect ratio
</span><span class="n">sns</span><span class="p">.</span><span class="nf">heatmap</span><span class="p">(</span><span class="n">corr</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span><span class="n">annot</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
            <span class="n">square</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="n">cbar_kws</span><span class="o">=</span><span class="p">{</span><span class="sh">"</span><span class="s">shrink</span><span class="sh">"</span><span class="p">:</span> <span class="p">.</span><span class="mi">4</span><span class="p">});</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_211_0.png" />
</figure>

<p><a id="Section_44"></a></p>
<h3 id="44-ensembling">4.4. Ensembling</h3>

<p>Now that the basic models have been tested and their results assessed, an ensemble of tuned model is created. First, each one of the selected model has its hyperparameters tuned.</p>

<p>Each of the model is trained using a k-fold validation method (using 10 folds).</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># create k-fold
</span><span class="n">kfolds</span> <span class="o">=</span> <span class="nc">KFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</code></pre></div></div>

<p>In addition, we create a stacking cross-validation regressor. This ensemble technique consists of combining several regressors, train them using CV, add the predictions to the dataset as new features and train a meta-regressor with the new dataset.</p>

<figure>
<img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/stacking_cv_regressor_overview.png" style="height:500px;" />
</figure>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># setup models   
</span>
<span class="c1"># Ridge parameters
</span><span class="n">alphas_alt</span> <span class="o">=</span> <span class="p">[</span><span class="mf">14.5</span><span class="p">,</span> <span class="mf">14.6</span><span class="p">,</span> <span class="mf">14.7</span><span class="p">,</span> <span class="mf">14.8</span><span class="p">,</span> <span class="mf">14.9</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mf">15.1</span><span class="p">,</span> <span class="mf">15.2</span><span class="p">,</span> <span class="mf">15.3</span><span class="p">,</span> <span class="mf">15.4</span><span class="p">,</span> <span class="mf">15.5</span><span class="p">]</span>

<span class="c1"># Lasso parameters
</span><span class="n">alphas2</span> <span class="o">=</span> <span class="p">[</span><span class="mf">5e-05</span><span class="p">,</span> <span class="mf">0.0001</span><span class="p">,</span> <span class="mf">0.0002</span><span class="p">,</span> <span class="mf">0.0003</span><span class="p">,</span> <span class="mf">0.0004</span><span class="p">,</span> <span class="mf">0.0005</span><span class="p">,</span> <span class="mf">0.0006</span><span class="p">,</span> <span class="mf">0.0007</span><span class="p">,</span> <span class="mf">0.0008</span><span class="p">]</span>

<span class="c1"># ElasticNet
</span><span class="n">e_alphas</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0001</span><span class="p">,</span> <span class="mf">0.0002</span><span class="p">,</span> <span class="mf">0.0003</span><span class="p">,</span> <span class="mf">0.0004</span><span class="p">,</span> <span class="mf">0.0005</span><span class="p">,</span> <span class="mf">0.0006</span><span class="p">,</span> <span class="mf">0.0007</span><span class="p">]</span>
<span class="n">e_l1ratio</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

<span class="n">ridge</span> <span class="o">=</span> <span class="nc">RidgeCV</span><span class="p">(</span><span class="n">alphas</span><span class="o">=</span><span class="n">alphas_alt</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">kfolds</span><span class="p">)</span>

<span class="n">lasso</span> <span class="o">=</span> <span class="nc">LassoCV</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mf">1e7</span><span class="p">,</span> <span class="n">alphas</span><span class="o">=</span><span class="n">alphas2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">kfolds</span><span class="p">)</span>

<span class="n">elasticnet</span> <span class="o">=</span> <span class="nc">ElasticNetCV</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mf">1e7</span><span class="p">,</span> <span class="n">alphas</span><span class="o">=</span><span class="n">e_alphas</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">kfolds</span><span class="p">,</span> <span class="n">l1_ratio</span><span class="o">=</span><span class="n">e_l1ratio</span><span class="p">)</span>
                                        
<span class="n">svr</span> <span class="o">=</span> <span class="nc">SVR</span><span class="p">(</span><span class="n">C</span><span class="o">=</span> <span class="mi">20</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span> <span class="mf">0.008</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mf">0.0003</span><span class="p">,)</span>


<span class="n">gbr</span> <span class="o">=</span> <span class="nc">GradientBoostingRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">3000</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
                                   <span class="n">max_depth</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">max_features</span><span class="o">=</span><span class="sh">'</span><span class="s">sqrt</span><span class="sh">'</span><span class="p">,</span>
                                   <span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">min_samples_split</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> 
                                   <span class="n">loss</span><span class="o">=</span><span class="sh">'</span><span class="s">huber</span><span class="sh">'</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span><span class="mi">42</span><span class="p">)</span>
                                   
<span class="n">lightgbm</span> <span class="o">=</span> <span class="nc">LGBMRegressor</span><span class="p">(</span><span class="n">objective</span><span class="o">=</span><span class="sh">'</span><span class="s">regression</span><span class="sh">'</span><span class="p">,</span> 
                                       <span class="n">num_leaves</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                                       <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> 
                                       <span class="n">n_estimators</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span>
                                       <span class="n">max_bin</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> 
                                       <span class="n">bagging_fraction</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span>
                                       <span class="n">bagging_freq</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> 
                                       <span class="n">bagging_seed</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
                                       <span class="n">feature_fraction</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
                                       <span class="n">feature_fraction_seed</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
                                       <span class="n">verbose</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
                                       
<span class="n">xgboost</span> <span class="o">=</span> <span class="nc">XGBRegressor</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">n_estimators</span><span class="o">=</span><span class="mi">3460</span><span class="p">,</span>
                                     <span class="n">max_depth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">min_child_weight</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                     <span class="n">gamma</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">subsample</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
                                     <span class="n">colsample_bytree</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
                                     <span class="n">nthread</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
                                     <span class="n">scale_pos_weight</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">27</span><span class="p">,</span>
                                     <span class="n">objective</span><span class="o">=</span><span class="sh">'</span><span class="s">reg:squarederror</span><span class="sh">'</span><span class="p">,</span>
                                     <span class="n">reg_alpha</span><span class="o">=</span><span class="mf">0.00006</span><span class="p">)</span>

<span class="n">stack_gen</span> <span class="o">=</span> <span class="nc">StackingCVRegressor</span><span class="p">(</span><span class="n">regressors</span><span class="o">=</span><span class="p">(</span><span class="n">ridge</span><span class="p">,</span> <span class="n">lasso</span><span class="p">,</span> <span class="n">elasticnet</span><span class="p">,</span>
                                            <span class="n">gbr</span><span class="p">,</span> <span class="n">xgboost</span><span class="p">,</span> <span class="n">lightgbm</span><span class="p">),</span>
                                <span class="n">meta_regressor</span><span class="o">=</span><span class="n">xgboost</span><span class="p">,</span>
                                <span class="n">use_features_in_secondary</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div>

<p>Once the tunable models have been defined, they are trained using the training set.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ridge_model_full_data</span> <span class="o">=</span> <span class="n">ridge</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">train_normalized</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">Ridge trained...</span><span class="sh">'</span><span class="p">)</span>
<span class="n">lasso_model_full_data</span> <span class="o">=</span> <span class="n">lasso</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">train_normalized</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">Lasso trained...</span><span class="sh">'</span><span class="p">)</span>
<span class="n">elastic_model_full_data</span> <span class="o">=</span> <span class="n">elasticnet</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">train_normalized</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">Elastic trained...</span><span class="sh">'</span><span class="p">)</span>
<span class="n">svr_model_full_data</span> <span class="o">=</span> <span class="n">svr</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">train_normalized</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">SVR trained...</span><span class="sh">'</span><span class="p">)</span>
<span class="n">gbr_model_full_data</span> <span class="o">=</span> <span class="n">gbr</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">train_normalized</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">GBR trained...</span><span class="sh">'</span><span class="p">)</span>
<span class="n">lgb_model_full_data</span> <span class="o">=</span> <span class="n">lightgbm</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">train_normalized</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">LGB trained...</span><span class="sh">'</span><span class="p">)</span>
<span class="n">xgb_model_full_data</span> <span class="o">=</span> <span class="n">xgboost</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">train_normalized</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">XGB trained...</span><span class="sh">'</span><span class="p">)</span>
<span class="n">stack_gen_model</span> <span class="o">=</span> <span class="n">stack_gen</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">train_normalized</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">Stack trained...</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Ridge trained...
Lasso trained...
Elastic trained...
SVR trained...
GBR trained...
LGB trained...
XGB trained...
Stack trained...
</code></pre></div></div>

<p>The Kaggle competition defines the key metric as the root-mean-squared error. Since our data has been transformed using a log function, our corresponding metric is the root-mean-squared logarithmic error (RMSLE).</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># rmsle
</span><span class="k">def</span> <span class="nf">rmsle</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="p">.</span><span class="nf">sqrt</span><span class="p">(</span><span class="nf">mean_squared_error</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>


<span class="c1"># scoring function
</span><span class="k">def</span> <span class="nf">cv_rmse</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">train_normalized</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_train</span><span class="p">):</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">sqrt</span><span class="p">(</span><span class="o">-</span><span class="nf">cross_val_score</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span>
                                    <span class="n">scoring</span><span class="o">=</span><span class="sh">"</span><span class="s">neg_mean_squared_error</span><span class="sh">"</span><span class="p">,</span>
                                    <span class="n">cv</span><span class="o">=</span><span class="n">kfolds</span><span class="p">))</span>
    <span class="nf">return </span><span class="p">(</span><span class="n">rmse</span><span class="p">)</span>
</code></pre></div></div>

<p>The RMSLE (means and standard deviation) is computed for each of the tuned model.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">score</span> <span class="o">=</span> <span class="nf">cv_rmse</span><span class="p">(</span><span class="n">ridge</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Kernel Ridge score: {:.4f} ({:.4f})</span><span class="sh">"</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">score</span><span class="p">.</span><span class="nf">mean</span><span class="p">(),</span> <span class="n">score</span><span class="p">.</span><span class="nf">std</span><span class="p">()))</span>

<span class="n">score</span> <span class="o">=</span> <span class="nf">cv_rmse</span><span class="p">(</span><span class="n">lasso</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Lasso score: {:.4f} ({:.4f})</span><span class="sh">"</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">score</span><span class="p">.</span><span class="nf">mean</span><span class="p">(),</span> <span class="n">score</span><span class="p">.</span><span class="nf">std</span><span class="p">()),)</span>

<span class="n">score</span> <span class="o">=</span> <span class="nf">cv_rmse</span><span class="p">(</span><span class="n">elasticnet</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">ElasticNet score: {:.4f} ({:.4f})</span><span class="sh">"</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">score</span><span class="p">.</span><span class="nf">mean</span><span class="p">(),</span> <span class="n">score</span><span class="p">.</span><span class="nf">std</span><span class="p">()))</span>

<span class="n">score</span> <span class="o">=</span> <span class="nf">cv_rmse</span><span class="p">(</span><span class="n">svr</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">SVR score: {:.4f} ({:.4f})</span><span class="sh">"</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">score</span><span class="p">.</span><span class="nf">mean</span><span class="p">(),</span> <span class="n">score</span><span class="p">.</span><span class="nf">std</span><span class="p">()))</span>

<span class="n">score</span> <span class="o">=</span> <span class="nf">cv_rmse</span><span class="p">(</span><span class="n">lightgbm</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Lightgbm score: {:.4f} ({:.4f})</span><span class="sh">"</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">score</span><span class="p">.</span><span class="nf">mean</span><span class="p">(),</span> <span class="n">score</span><span class="p">.</span><span class="nf">std</span><span class="p">()))</span>

<span class="n">score</span> <span class="o">=</span> <span class="nf">cv_rmse</span><span class="p">(</span><span class="n">gbr</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">GradientBoosting score: {:.4f} ({:.4f})</span><span class="sh">"</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">score</span><span class="p">.</span><span class="nf">mean</span><span class="p">(),</span> <span class="n">score</span><span class="p">.</span><span class="nf">std</span><span class="p">()))</span>

<span class="n">score</span> <span class="o">=</span> <span class="nf">cv_rmse</span><span class="p">(</span><span class="n">xgboost</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Xgboost score: {:.4f} ({:.4f})</span><span class="sh">"</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">score</span><span class="p">.</span><span class="nf">mean</span><span class="p">(),</span> <span class="n">score</span><span class="p">.</span><span class="nf">std</span><span class="p">()))</span>

<span class="n">score</span> <span class="o">=</span> <span class="nf">cv_rmse</span><span class="p">(</span><span class="n">stack_gen</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Stack score: {:.4f} ({:.4f})</span><span class="sh">"</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">score</span><span class="p">.</span><span class="nf">mean</span><span class="p">(),</span> <span class="n">score</span><span class="p">.</span><span class="nf">std</span><span class="p">()))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Kernel Ridge score: 0.1100 (0.0166)
Lasso score: 0.1104 (0.0165)
ElasticNet score: 0.1103 (0.0165)
SVR score: 0.1091 (0.0185)
Lightgbm score: 0.1139 (0.0156)
GradientBoosting score: 0.1135 (0.0152)
Xgboost score: 0.1155 (0.0165)
Stack score: 0.1133 (0.0143)
</code></pre></div></div>

<p>We now create a new stack combining our models. The new model consists of a simple linear combination of the previous model. More emphasis is put on the stack model. This is done by assigning a larger weight to this model. The definition of the weights of the model are based on trial-and-error. We start with 0.1 for all model except for the stack (0.3 weight).</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">blend_models_predict</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
    <span class="nf">return </span><span class="p">(</span>
        <span class="p">(</span><span class="mf">0.15</span> <span class="o">*</span> <span class="n">ridge_model_full_data</span><span class="p">.</span><span class="nf">predict</span><span class="p">(</span><span class="n">X</span><span class="p">))</span> <span class="o">+</span> \
        <span class="p">(</span><span class="mf">0.1</span> <span class="o">*</span> <span class="n">lasso_model_full_data</span><span class="p">.</span><span class="nf">predict</span><span class="p">(</span><span class="n">X</span><span class="p">))</span> <span class="o">+</span> \
        
        <span class="p">(</span><span class="mf">0.1</span> <span class="o">*</span> <span class="n">elastic_model_full_data</span><span class="p">.</span><span class="nf">predict</span><span class="p">(</span><span class="n">X</span><span class="p">))</span> <span class="o">+</span> \
        <span class="p">(</span><span class="mf">0.1</span> <span class="o">*</span> <span class="n">svr_model_full_data</span><span class="p">.</span><span class="nf">predict</span><span class="p">(</span><span class="n">X</span><span class="p">))</span> <span class="o">+</span> \
            
        <span class="p">(</span><span class="mf">0.1</span> <span class="o">*</span> <span class="n">lgb_model_full_data</span><span class="p">.</span><span class="nf">predict</span><span class="p">(</span><span class="n">X</span><span class="p">))</span> <span class="o">+</span> \
        <span class="p">(</span><span class="mf">0.1</span> <span class="o">*</span> <span class="n">gbr_model_full_data</span><span class="p">.</span><span class="nf">predict</span><span class="p">(</span><span class="n">X</span><span class="p">))</span> <span class="o">+</span> \
            
        <span class="p">(</span><span class="mf">0.1</span> <span class="o">*</span> <span class="n">xgb_model_full_data</span><span class="p">.</span><span class="nf">predict</span><span class="p">(</span><span class="n">X</span><span class="p">))</span> <span class="o">+</span> \
        <span class="p">(</span><span class="mf">0.25</span> <span class="o">*</span> <span class="n">stack_gen_model</span><span class="p">.</span><span class="nf">predict</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span><span class="n">X</span><span class="p">)))</span>
    <span class="p">)</span>
            
<span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">RMSLE score on train data:</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="nf">rmsle</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="nf">blend_models_predict</span><span class="p">(</span><span class="n">train_normalized</span><span class="p">)))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>RMSLE score on train data:
0.0660008865648205
</code></pre></div></div>

<p><a id="Section_45"></a></p>
<h3 id="45-fine-tuning">4.5. Fine Tuning</h3>

<p>The final assessment of our model is based on the residual distribution. The sale prices from the training set are compared to the predicted sale prices. The goal is to determine if the outliers of the training set led to a bias error.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># predictions
</span><span class="n">y_pred</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">floor</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">expm1</span><span class="p">(</span><span class="nf">blend_models_predict</span><span class="p">(</span><span class="n">train_normalized</span><span class="p">)))</span>
<span class="n">y_train_real</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">floor</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">floor</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">expm1</span><span class="p">(</span><span class="n">y_train</span><span class="p">)))</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># create figure
</span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>

<span class="c1"># set axis labels
</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">set_xlabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Sale Price - Real Values</span><span class="sh">'</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">set_ylabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Sale Price - Predicted Values</span><span class="sh">'</span><span class="p">)</span>

<span class="c1"># plot real vs. predicted
</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">scatter</span><span class="p">(</span><span class="n">y_train_real</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="sh">'</span><span class="s">.</span><span class="sh">'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sh">'</span><span class="s">blend model</span><span class="sh">'</span><span class="p">)</span>

<span class="c1"># plot x=y for comparison
</span><span class="n">x_range</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="nf">min</span><span class="p">(</span><span class="n">y_train_real</span><span class="p">),</span> <span class="n">np</span><span class="p">.</span><span class="nf">max</span><span class="p">(</span><span class="n">y_train_real</span><span class="p">)]</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">plot</span><span class="p">(</span><span class="n">x_range</span><span class="p">,</span> <span class="n">x_range</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="sh">'</span><span class="s">k</span><span class="sh">'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sh">"</span><span class="s">x=y</span><span class="sh">"</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">legend</span><span class="p">()</span>

<span class="c1"># plot residuals
</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nf">scatter</span><span class="p">(</span><span class="n">y_train_real</span><span class="p">,</span> <span class="n">y_pred</span><span class="o">-</span><span class="n">y_train_real</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="sh">'</span><span class="s">.</span><span class="sh">'</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nf">set_xlabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Sale Price - Real Values</span><span class="sh">'</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nf">set_ylabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Sale Price - Residuals</span><span class="sh">'</span><span class="p">);</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_230_0.png" />
</figure>

<p>From the above plot, it can be seen that the model tends to under-estimate the price of expensive houses.</p>

<p>In order to re-scale these extreme cases, we group the data by quantiles of the real sale prices. We then inspect the ratio between the predicted values and the real values (grouped by quantiles).</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># create residual dataframe
</span><span class="n">residuals</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">({</span><span class="sh">'</span><span class="s">real_values</span><span class="sh">'</span><span class="p">:</span><span class="n">y_train_real</span><span class="p">,</span> <span class="sh">'</span><span class="s">pred_values</span><span class="sh">'</span><span class="p">:</span><span class="n">y_pred</span><span class="p">,</span> <span class="sh">'</span><span class="s">residuals</span><span class="sh">'</span><span class="p">:</span><span class="n">y_pred</span><span class="o">-</span><span class="n">y_train_real</span><span class="p">})</span>

<span class="c1"># compute residual quantiles
</span><span class="n">residuals</span><span class="p">[</span><span class="sh">'</span><span class="s">quantile_range</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">qcut</span><span class="p">(</span><span class="n">residuals</span><span class="p">[</span><span class="sh">'</span><span class="s">real_values</span><span class="sh">'</span><span class="p">],</span> <span class="n">q</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

<span class="c1"># compute middle value for each quantile
</span><span class="n">residuals</span><span class="p">[</span><span class="sh">'</span><span class="s">middle</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">residuals</span><span class="p">[</span><span class="sh">'</span><span class="s">quantile_range</span><span class="sh">'</span><span class="p">].</span><span class="nf">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">left</span><span class="o">+</span><span class="n">x</span><span class="p">.</span><span class="n">right</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span><span class="p">).</span><span class="nf">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

<span class="c1"># compute ratio between residual value and quantile mid value
</span><span class="n">residuals</span><span class="p">[</span><span class="sh">'</span><span class="s">ratio_res_mid</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">residuals</span><span class="p">[</span><span class="sh">'</span><span class="s">residuals</span><span class="sh">'</span><span class="p">]</span> <span class="o">/</span> <span class="n">residuals</span><span class="p">[</span><span class="sh">'</span><span class="s">middle</span><span class="sh">'</span><span class="p">]</span>

<span class="c1"># compute the ratio between the predicted value and the quantile mid value 
</span><span class="n">residuals</span><span class="p">[</span><span class="sh">'</span><span class="s">ratio_pred_mid</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">residuals</span><span class="p">[</span><span class="sh">'</span><span class="s">pred_values</span><span class="sh">'</span><span class="p">]</span> <span class="o">/</span> <span class="n">residuals</span><span class="p">[</span><span class="sh">'</span><span class="s">real_values</span><span class="sh">'</span><span class="p">]</span> 

<span class="n">residuals</span><span class="p">.</span><span class="nf">head</span><span class="p">()</span>
</code></pre></div></div>

<div style="overflow-x:auto;">
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>real_values</th>
      <th>pred_values</th>
      <th>residuals</th>
      <th>quantile_range</th>
      <th>middle</th>
      <th>ratio_res_mid</th>
      <th>ratio_pred_mid</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>208499.0</td>
      <td>207203.0</td>
      <td>-1296.0</td>
      <td>(198859.1, 214000.0]</td>
      <td>206429.550</td>
      <td>-0.006278</td>
      <td>0.993784</td>
    </tr>
    <tr>
      <th>1</th>
      <td>181500.0</td>
      <td>187525.0</td>
      <td>6025.0</td>
      <td>(179239.8, 187500.0]</td>
      <td>183369.900</td>
      <td>0.032857</td>
      <td>1.033196</td>
    </tr>
    <tr>
      <th>2</th>
      <td>223500.0</td>
      <td>214092.0</td>
      <td>-9408.0</td>
      <td>(214000.0, 230000.0]</td>
      <td>222000.000</td>
      <td>-0.042378</td>
      <td>0.957906</td>
    </tr>
    <tr>
      <th>3</th>
      <td>139999.0</td>
      <td>157285.0</td>
      <td>17286.0</td>
      <td>(135500.0, 140959.05]</td>
      <td>138229.525</td>
      <td>0.125053</td>
      <td>1.123472</td>
    </tr>
    <tr>
      <th>4</th>
      <td>249999.0</td>
      <td>283155.0</td>
      <td>33156.0</td>
      <td>(230000.0, 249999.0]</td>
      <td>239999.500</td>
      <td>0.138150</td>
      <td>1.132625</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">series</span> <span class="o">=</span> <span class="n">residuals</span><span class="p">.</span><span class="nf">groupby</span><span class="p">([</span><span class="sh">'</span><span class="s">quantile_range</span><span class="sh">'</span><span class="p">]).</span><span class="nf">mean</span><span class="p">()[</span><span class="sh">'</span><span class="s">ratio_pred_mid</span><span class="sh">'</span><span class="p">].</span><span class="nf">sort_index</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">series</span><span class="p">);</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>quantile_range
(34898.999, 87999.0]     1.095946
(87999.0, 106424.0]      1.019554
(106424.0, 114999.0]     1.004174
(114999.0, 124000.0]     1.001567
(124000.0, 129925.0]     0.999571
(129925.0, 135500.0]     1.001819
(135500.0, 140959.05]    0.997909
(140959.05, 146999.0]    1.007797
(146999.0, 155000.0]     0.993213
(155000.0, 162999.0]     0.993089
(162999.0, 172499.0]     0.997316
(172499.0, 179239.8]     0.995843
(179239.8, 187500.0]     1.011027
(187500.0, 198859.1]     1.004864
(198859.1, 214000.0]     1.001532
(214000.0, 230000.0]     0.994265
(230000.0, 249999.0]     0.996978
(249999.0, 278000.0]     0.988132
(278000.0, 326300.0]     0.991095
(326300.0, 755000.0]     0.968056
Name: ratio_pred_mid, dtype: float64
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>
<span class="n">series</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="sh">'</span><span class="s">barh</span><span class="sh">'</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">);</span>
</code></pre></div></div>

<figure>
    <img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/output_234_0.png" />
</figure>

<p>From the above plot, we can see that the model performs relatively well for the middle 18 quantiles. However, the predictions for cheap houses are over-estimated while the predictions for expensive houses are under-estimated. We make corrections to the predictions</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># quantile adjustment
</span><span class="n">q1</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">quantile</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
<span class="n">q2</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">quantile</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="mf">0.90</span><span class="p">)</span>

<span class="n">q1_factor</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mf">1.09</span>
<span class="n">q2_factor</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mf">0.95</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Correction
</span><span class="n">f_q1</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">q1</span> <span class="k">else</span> <span class="n">x</span> <span class="o">*</span> <span class="n">q1_factor</span>
<span class="n">f_q2</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">q2</span> <span class="k">else</span> <span class="n">x</span> <span class="o">*</span> <span class="n">q2_factor</span>
</code></pre></div></div>

<p><a id="Section_46"></a></p>
<h3 id="46-predictions">4.6. Predictions</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># make predictions on test set
</span><span class="n">y_test_pred</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">expm1</span><span class="p">(</span><span class="nf">blend_models_predict</span><span class="p">(</span><span class="n">test_normalized</span><span class="p">))</span>

<span class="c1"># correct outliers
</span><span class="n">corrected_y_test</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span><span class="nf">f_q1</span><span class="p">(</span><span class="n">xi</span><span class="p">)</span> <span class="k">for</span> <span class="n">xi</span> <span class="ow">in</span> <span class="n">y_test_pred</span><span class="p">])</span>
<span class="n">y_test_pred_series</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span><span class="nf">f_q2</span><span class="p">(</span><span class="n">xi</span><span class="p">)</span> <span class="k">for</span> <span class="n">xi</span> <span class="ow">in</span> <span class="n">corrected_y_test</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">submission</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_csv</span><span class="p">(</span><span class="sh">"</span><span class="s">./data/sample_submission.csv</span><span class="sh">"</span><span class="p">)</span>
<span class="n">submission</span><span class="p">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">floor</span><span class="p">(</span><span class="n">y_test_pred_series</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">submission</span><span class="p">.</span><span class="nf">to_csv</span><span class="p">(</span><span class="sh">"</span><span class="s">new_submission.csv</span><span class="sh">"</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</code></pre></div></div>
<figure>
<img src="https://tdody.github.io/assets/img/2019-10-03-Housing-Dataset/Results.png" />
</figure>

<p><strong>Conclusion</strong>: This model ranks in the top 5% at the time of the submittal. This is a really good outcome for a relatively simple model without too much feature engineering.</p>
